const OverdueTicketsModal=({show:e,onClose:t,currentUser:a})=>{const[c,s]=React.useState(!0),[r,l]=React.useState([]),[n,m]=React.useState({});React.useEffect(()=>{e&&i()},[e]);const i=async()=>{try{s(!0);const e=await fetch("/api/tickets",{headers:{Authorization:"Bearer "+localStorage.getItem("auth_token")}}),t=await e.json(),a=new Date,c=(t.tickets||[]).filter(e=>{if("completed"===e.status||"cancelled"===e.status||"archived"===e.status)return!1;if(!e.scheduled_date||"null"===e.scheduled_date)return!1;const t=e.scheduled_date.replace(" ","T")+"Z";return new Date(t)<a});if(c.sort((e,t)=>new Date(e.scheduled_date)-new Date(t.scheduled_date)),l(c),c.length>0){const e=c.map(async e=>{const t=new AbortController,a=setTimeout(()=>t.abort(),5e3);try{const c=await fetch("/api/comments/ticket/"+e.id,{headers:{Authorization:"Bearer "+localStorage.getItem("auth_token")},signal:t.signal});clearTimeout(a);const s=await c.json();return{id:e.id,comments:s.comments||[]}}catch(t){return clearTimeout(a),console.warn("Timeout/Error loading comments for ticket "+e.id,t),{id:e.id,comments:[]}}}),t=await Promise.all(e),a={};t.forEach(e=>{a[e.id]=e.comments}),m(a)}}catch(e){console.error("Erreur chargement tickets en retard:",e)}finally{s(!1)}},o=e=>{const t={critical:"bg-red-100 text-red-800 border-red-300",high:"bg-orange-100 text-orange-800 border-orange-300",medium:"bg-yellow-100 text-yellow-800 border-yellow-300",low:"bg-green-100 text-green-800 border-green-300"};return t[e]||t.medium};return e?React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-2 sm:p-4",onClick:t},React.createElement("div",{className:"bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"bg-gradient-to-r from-rose-800 to-rose-900 text-white p-4 sm:p-6"},React.createElement("div",{className:"flex justify-between items-center"},React.createElement("div",{},React.createElement("h2",{className:"text-lg sm:text-2xl font-bold flex items-center gap-2"},React.createElement("i",{className:"fas fa-exclamation-triangle"}),"Tickets en Retard"),React.createElement("p",{className:"text-rose-200 text-xs sm:text-sm mt-1"},"Interventions nécessitant une attention immédiate")),React.createElement("div",{className:"flex gap-2"},React.createElement("button",{className:"text-rose-100 hover:text-white hover:bg-white hover:bg-opacity-20 rounded-full w-8 h-8 flex items-center justify-center transition-colors",onClick:i,title:"Actualiser"},React.createElement("i",{className:"fas fa-sync-alt"})),React.createElement("button",{className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full w-8 h-8 flex items-center justify-center transition-colors",onClick:t},React.createElement("i",{className:"fas fa-times"}))))),React.createElement("div",{className:"p-3 sm:p-6 overflow-y-auto max-h-[calc(90vh-100px)] sm:max-h-[calc(90vh-120px)]"},c?React.createElement("div",{className:"text-center py-12"},React.createElement("i",{className:"fas fa-spinner fa-spin text-4xl text-rose-600 mb-4"}),React.createElement("p",{className:"text-gray-600"},"Chargement des tickets...")):r.length>0?React.createElement("div",{className:"space-y-3 sm:space-y-4"},React.createElement("div",{className:"bg-rose-50 border border-rose-200 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6"},React.createElement("div",{className:"flex items-center gap-2 mb-2"},React.createElement("i",{className:"fas fa-info-circle text-rose-700"}),React.createElement("h4",{className:"font-semibold text-gray-800"},"Résumé")),React.createElement("p",{className:"text-sm text-gray-700"},React.createElement("span",{className:"font-bold text-rose-800"},r.length)," ticket(s) en retard nécessitant une action urgente.")),r.map(e=>{return React.createElement("div",{key:e.id,className:"border-2 border-rose-200 rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow bg-white"},React.createElement("div",{className:"flex flex-col sm:flex-row justify-between items-start mb-3 gap-2"},React.createElement("div",{className:"flex-1"},React.createElement("h3",{className:"font-bold text-gray-800 mb-1"},e.title),React.createElement("p",{className:"text-sm text-gray-600 mb-2"},e.ticket_id)),React.createElement("div",{className:"flex flex-col items-end gap-2"},React.createElement("span",{className:"px-3 py-1 rounded-full text-xs font-bold border-2 "+o(e.priority)},{critical:"Critique",high:"Haute",medium:"Moyenne",low:"Basse"}[t=e.priority]||t),React.createElement("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 border-2 border-red-300"},React.createElement("i",{className:"fas fa-clock mr-1"}),(e=>{const t=new Date,a=new Date(e),c=Math.abs(t-a);return Math.ceil(c/864e5)})(e.scheduled_date)+" jours"))),React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 text-xs sm:text-sm"},React.createElement("div",{className:"flex flex-wrap"},React.createElement("span",{className:"text-gray-500"},"Machine: "),React.createElement("span",{className:"font-medium ml-1"},e.machine_type+" - "+e.model)),React.createElement("div",{className:"flex flex-wrap"},React.createElement("span",{className:"text-gray-500"},"Assigné à: "),React.createElement("span",{className:"font-medium ml-1 break-all"},e.assignee_name||"Non assigné")),React.createElement("div",{className:"flex flex-wrap"},React.createElement("span",{className:"text-gray-500"},"Date prévue: "),React.createElement("span",{className:"font-medium text-red-600 ml-1"},(()=>{const t=e.scheduled_date.replace(" ","T")+(e.scheduled_date.includes("Z")?"":"Z");return new Date(t).toLocaleString("fr-CA",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})())),React.createElement("div",{className:"flex flex-wrap"},React.createElement("span",{className:"text-gray-500"},"Lieu: "),React.createElement("span",{className:"font-medium ml-1"},e.location))),n[e.id]&&n[e.id].length>0&&React.createElement("div",{className:"mt-3 pt-3 border-t border-rose-100"},React.createElement("h4",{className:"text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1"},React.createElement("i",{className:"fas fa-comment text-rose-600"}),"Commentaires ("+n[e.id].length+")"),React.createElement("div",{className:"space-y-2 max-h-32 overflow-y-auto"},n[e.id].map((e,t)=>React.createElement("div",{key:t,className:"bg-gray-50 rounded p-2 text-xs"},React.createElement("div",{className:"font-semibold text-rose-700 mb-1"},"Commentaire de "+e.user_name+":"),React.createElement("div",{className:"text-gray-700"},e.comment))))));var t})):React.createElement("div",{className:"text-center py-12 bg-gray-50 rounded-lg"},React.createElement("i",{className:"fas fa-check-circle text-5xl text-green-500 mb-4"}),React.createElement("p",{className:"text-gray-600 font-medium"},"Aucun ticket en retard !"),React.createElement("p",{className:"text-sm text-gray-500 mt-2"},"Toutes les interventions sont à jour."))))):null};