const TicketAttachments=({ticket:e,currentUser:t,onMediaChange:a})=>{const[l,r]=React.useState(null),[s,c]=React.useState(!1),[i,n]=React.useState([]),[o,m]=React.useState([]),[d,u]=React.useState({show:!1,message:"",onConfirm:null}),p=e=>{const t=Array.from(e.target.files);n(e=>[...e,...t]),t.forEach(e=>{const t=new FileReader;t.onloadend=()=>{m(a=>[...a,{url:t.result,type:e.type,name:e.name,size:e.size}])},t.readAsDataURL(e)})};return React.createElement("div",{},e.media&&e.media.length>0?React.createElement("div",{className:"mb-4 sm:mb-6"},React.createElement("h4",{className:"text-base sm:text-lg font-bold text-gray-800 mb-3 flex items-center"},React.createElement("i",{className:"fas fa-images mr-2 text-blue-700 text-sm sm:text-base"}),"Galerie MÃ©dias (Photos, VidÃ©os, Vocaux) ("+e.media.length+")"),React.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 sm:gap-3"},e.media.map(l=>React.createElement("div",{key:l.id,className:"relative group"},React.createElement("div",{className:"cursor-pointer sm:cursor-pointer",onClick:()=>r(l)},l.file_type.startsWith("image/")?React.createElement("img",{src:API_URL+"/media/"+l.id,alt:l.file_name,className:"w-full h-32 object-cover rounded border-2 border-gray-300 hover:border-igp-blue transition-all pointer-events-none sm:pointer-events-auto"}):l.file_type.startsWith("audio/")?React.createElement("div",{className:"w-full h-32 bg-slate-100 rounded border-2 border-slate-300 hover:border-igp-blue transition-all flex flex-col items-center justify-center pointer-events-none sm:pointer-events-auto p-2"},React.createElement("i",{className:"fas fa-microphone-alt fa-2x text-slate-500 mb-2"}),React.createElement("span",{className:"text-xs text-slate-600 font-semibold text-center truncate w-full"},"Vocal du "+new Date(l.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}))):React.createElement("div",{className:"w-full h-32 bg-gray-200 rounded border-2 border-gray-300 hover:border-igp-blue transition-all flex items-center justify-center pointer-events-none sm:pointer-events-auto"},React.createElement("i",{className:"fas fa-video fa-3x text-gray-500"})),React.createElement("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded flex items-center justify-center pointer-events-none"},React.createElement("i",{className:"fas "+(l.file_type.startsWith("audio/")?"fa-play-circle":"fa-search-plus")+" text-white text-2xl opacity-0 group-hover:opacity-100 transition-all"})),React.createElement("div",{className:"absolute bottom-1 left-1 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded pointer-events-none"},l.file_type.startsWith("image/")?"ðŸ“·":l.file_type.startsWith("audio/")?"ðŸŽ¤":"ðŸŽ¥")),!t||"admin"!==t?.role&&"supervisor"!==t?.role&&"technician"!==t?.role&&e.reported_by!==t.id?null:React.createElement("button",{onClick:e=>{e.stopPropagation(),(async e=>{u({show:!0,message:"Supprimer ce mÃ©dia ?",onConfirm:async()=>{u({show:!1,message:"",onConfirm:null});try{await axios.delete(API_URL+"/media/"+e),a&&a()}catch(e){alert("Erreur lors de la suppression: "+(e.response?.data?.error||"Erreur inconnue"))}}})})(l.id)},className:"absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 sm:w-7 sm:h-7 flex items-center justify-center sm:opacity-0 sm:group-hover:opacity-100 transition-all shadow-lg z-20",style:{opacity:1},title:"Supprimer ce mÃ©dia"},React.createElement("i",{className:"fas fa-trash text-sm"})))))):null,e.media&&0!==e.media.length?null:React.createElement("div",{className:"mb-4 sm:mb-6 text-center py-6 sm:py-8 bg-gray-50 rounded"},React.createElement("i",{className:"fas fa-camera text-gray-400 text-4xl mb-2"}),React.createElement("p",{className:"text-gray-500"},"Aucune photo ou vidÃ©o attachÃ©e Ã  ce ticket")),React.createElement("div",{className:"mb-4 sm:mb-6 border-t-2 border-gray-200 pt-4 sm:pt-6"},React.createElement("h4",{className:"text-base sm:text-lg font-bold text-gray-800 mb-3 sm:mb-4 flex items-center"},React.createElement("i",{className:"fas fa-camera-retro mr-2 text-blue-700 text-sm sm:text-base"}),"Ajouter des photos/vidÃ©os supplÃ©mentaires"),o.length>0?React.createElement("div",{className:"mb-4"},React.createElement("p",{className:"text-sm font-semibold text-gray-700 mb-2"},React.createElement("i",{className:"fas fa-images mr-1"}),o.length+" fichier(s) sÃ©lectionnÃ©(s)"),React.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 sm:gap-3 mb-3"},o.map((e,t)=>React.createElement("div",{key:t,className:"relative group"},e.type.startsWith("image/")?React.createElement("img",{src:e.url,alt:e.name,className:"w-full h-24 object-cover rounded border-2 border-blue-600"}):React.createElement("div",{className:"w-full h-24 bg-gray-200 rounded border-2 border-blue-600 flex items-center justify-center"},React.createElement("i",{className:"fas fa-video fa-2x text-gray-500"})),React.createElement("button",{type:"button",onClick:()=>{n(e=>e.filter((e,a)=>a!==t)),m(e=>e.filter((e,a)=>a!==t))},className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-700 transition-all"},React.createElement("i",{className:"fas fa-times text-xs"})),React.createElement("div",{className:"absolute bottom-1 left-1 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded max-w-full truncate"},e.name)))),React.createElement("button",{onClick:async()=>{if(0!==i.length){c(!0);try{for(let t=0;t<i.length;t++){const a=i[t],l=new FormData;l.append("file",a),l.append("ticket_id",e.id),await axios.post(API_URL+"/media/upload",l,{headers:{"Content-Type":"multipart/form-data"}})}alert("MÃ©dias ajoutÃ©s avec succÃ¨s !"),n([]),m([]),a&&a()}catch(e){alert("Erreur lors de l'upload des mÃ©dias")}finally{c(!1)}}},disabled:s,className:"w-full px-4 py-2 bg-igp-blue text-white rounded-md hover:bg-igp-blue-dark transition-all font-semibold disabled:opacity-50 disabled:cursor-not-allowed"},s?React.createElement("span",{},React.createElement("i",{className:"fas fa-spinner fa-spin mr-2"}),"Upload en cours..."):React.createElement("span",{},React.createElement("i",{className:"fas fa-cloud-upload-alt mr-2"}),"Uploader ces fichiers"))):null,React.createElement("div",{className:"grid grid-cols-3 gap-2 sm:gap-3"},React.createElement("label",{className:"flex flex-col items-center justify-center px-2 py-3 bg-blue-50 border-2 border-dashed border-blue-300 rounded-lg cursor-pointer hover:bg-blue-100 hover:border-blue-500 transition-all text-center h-full"},React.createElement("input",{type:"file",accept:"image/*",capture:"environment",onChange:p,className:"hidden",id:"photo-upload-detail"}),React.createElement("i",{className:"fas fa-camera text-lg sm:text-xl text-blue-600 mb-1 block"}),React.createElement("span",{className:"text-[10px] sm:text-xs font-bold text-blue-700 block leading-tight"},"Photo")),React.createElement("label",{className:"flex flex-col items-center justify-center px-2 py-3 bg-red-50 border-2 border-dashed border-red-300 rounded-lg cursor-pointer hover:bg-red-100 hover:border-red-500 transition-all text-center h-full"},React.createElement("input",{type:"file",accept:"video/*",capture:"environment",onChange:p,className:"hidden",id:"video-upload-detail"}),React.createElement("i",{className:"fas fa-video text-lg sm:text-xl text-red-600 mb-1 block"}),React.createElement("span",{className:"text-[10px] sm:text-xs font-bold text-red-700 block leading-tight"},"VidÃ©o")),React.createElement("label",{className:"flex flex-col items-center justify-center px-2 py-3 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 hover:border-gray-500 transition-all text-center h-full"},React.createElement("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:p,className:"hidden",id:"media-upload-detail"}),React.createElement("i",{className:"fas fa-images text-lg sm:text-xl text-gray-600 mb-1 block"}),React.createElement("span",{className:"text-[10px] sm:text-xs font-bold text-gray-700 block leading-tight"},"Galerie")))),l?React.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-[100000] flex items-center justify-center p-4",onClick:()=>r(null)},React.createElement("div",{className:"relative max-w-6xl max-h-full"},React.createElement("button",{onClick:()=>r(null),className:"absolute top-2 right-2 bg-white text-gray-800 rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-200 transition-all z-10"},React.createElement("i",{className:"fas fa-times fa-lg"})),l.file_type.startsWith("image/")?React.createElement("img",{src:API_URL+"/media/"+l.id,alt:l.file_name,className:"max-w-full max-h-screen object-contain",onClick:e=>e.stopPropagation()}):l.file_type.startsWith("audio/")?React.createElement("div",{className:"bg-white p-8 rounded-xl shadow-2xl flex flex-col items-center gap-4",onClick:e=>e.stopPropagation()},React.createElement("i",{className:"fas fa-microphone-alt text-6xl text-slate-700"}),React.createElement("h3",{className:"text-xl font-bold text-gray-800"},"Lecture du message vocal"),React.createElement("audio",{src:API_URL+"/media/"+l.id,controls:!0,autoPlay:!0,className:"w-full min-w-[300px]"})):React.createElement("video",{src:API_URL+"/media/"+l.id,controls:!0,className:"max-w-full max-h-screen",onClick:e=>e.stopPropagation()}),React.createElement("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-70 text-white px-3 py-2 rounded text-sm"},l.file_name+" - "+Math.round(l.file_size/1024)+" KB"))):null,React.createElement(ConfirmModal,{show:d.show,message:d.message,onConfirm:d.onConfirm,onCancel:()=>u({show:!1,message:"",onConfirm:null})}))};