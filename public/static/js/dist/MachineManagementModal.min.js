const MachineManagementModal=({show:e,onClose:t,currentUser:a,machines:l,onRefresh:r})=>{const[c,n]=React.useState(""),[o,s]=React.useState(!1),[m,u]=React.useState(null),[i,d]=React.useState({placeholder_machine_type:"Ex: Équipement, Machine...",placeholder_location:"Ex: Zone A, Atelier...",placeholder_manufacturer:"Ex: Marque, Fabricant...",placeholder_model:"Ex: Modèle, Version...",placeholder_serial_number:"Ex: SN-001, ABC123..."});React.useEffect(()=>{e&&fetch("/api/settings/placeholders").then(e=>e.ok?e.json():{}).then(e=>d(t=>({...t,...e}))).catch(()=>{})},[e]);const[b,p]=React.useState(""),[f,g]=React.useState(""),[x,R]=React.useState(""),[h,E]=React.useState(""),[v,y]=React.useState(""),[N,w]=React.useState(""),[C,_]=React.useState(""),[k,S]=React.useState(""),[M,L]=React.useState(""),[A,I]=React.useState(""),[j,q]=React.useState(""),[F,T]=React.useState(""),[P,D]=React.useState(""),[U,B]=React.useState(""),[H,O]=React.useState(""),z=React.useRef(null),[G,V]=(React.useRef(null),React.useState(!1));if(React.useEffect(()=>{const a=a=>{"Escape"===a.key&&e&&t()};if(e)return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,t]),!e)return null;const W=l.filter(e=>!c||e.machine_type.toLowerCase().includes(c.toLowerCase())||e.model&&e.model.toLowerCase().includes(c.toLowerCase())||e.serial_number&&e.serial_number.toLowerCase().includes(c.toLowerCase())||e.location&&e.location.toLowerCase().includes(c.toLowerCase())||e.manufacturer&&e.manufacturer.toLowerCase().includes(c.toLowerCase()));return React.createElement("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[10000] p-4 backdrop-blur-sm",onClick:t},React.createElement("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-300 w-full max-w-5xl max-h-[85vh] sm:max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"bg-gradient-to-r from-teal-700 to-cyan-700 text-white p-4 sm:p-5 flex justify-between items-center shadow-md"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("div",{className:"bg-white/20 p-2 rounded-lg"},React.createElement("i",{className:"fas fa-server text-xl sm:text-2xl"})),React.createElement("div",{},React.createElement("h2",{className:"text-lg sm:text-2xl font-bold tracking-tight"},"Gestion du Parc Machines"),React.createElement("p",{className:"text-xs sm:text-sm text-cyan-100 font-medium"},"Inventaire et caractéristiques techniques"))),React.createElement("button",{onClick:t,className:"text-white hover:bg-white/20 rounded-xl p-2 transition-all active:scale-95","aria-label":"Fermer"},React.createElement("i",{className:"fas fa-times text-xl"}))),React.createElement("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 bg-gray-50",ref:z},React.createElement("div",{className:"mb-6 flex flex-col sm:flex-row gap-3 bg-white p-4 rounded-xl shadow-sm border border-gray-100"},"admin"===a?.role?React.createElement(React.Fragment,{},React.createElement("button",{onClick:()=>s(!o),className:"px-6 py-2.5 bg-teal-600 hover:bg-teal-700 text-white rounded-xl font-bold shadow-sm transition-all flex items-center justify-center gap-2"},React.createElement("i",{className:o?"fas fa-minus":"fas fa-plus"}),o?"Fermer":"Nouvelle Machine"),React.createElement("button",{onClick:()=>window.openDataImport?window.openDataImport("machines"):alert("Fonction non disponible"),className:"px-4 py-2.5 bg-slate-700 hover:bg-slate-800 text-white rounded-xl font-bold shadow-sm transition-all flex items-center justify-center gap-2"},React.createElement("i",{className:"fas fa-exchange-alt"}),"Import / Export")):null,React.createElement("div",{className:"relative flex-1"},React.createElement("i",{className:"fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"}),React.createElement("input",{type:"text",placeholder:"Rechercher une machine (nom, modèle, série, fabricant...)",value:c,onChange:e=>n(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-xl focus:border-teal-500 focus:ring-2 focus:ring-teal-100 outline-none transition-all"}))),o?React.createElement("form",{onSubmit:async e=>{if(e.preventDefault(),b)try{await axios.post(API_URL+"/machines",{machine_type:b,model:f||null,serial_number:x||null,location:h||null,manufacturer:v||null,year:N?parseInt(N):null,technical_specs:C||null}),alert("Machine creee avec succes!"),p(""),g(""),R(""),E(""),y(""),w(""),_(""),s(!1),r()}catch(e){alert("Erreur: "+(e.response?.data?.error||"Erreur inconnue"))}else alert("Type de machine requis")},className:"mb-6 p-6 bg-white rounded-xl border border-blue-200 shadow-lg"},React.createElement("h3",{className:"text-xl font-bold mb-4 text-blue-800"},"Nouvelle Machine"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Type *"),React.createElement("input",{type:"text",value:b,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-600 focus:outline-none",placeholder:i.placeholder_machine_type})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Modele"),React.createElement("input",{type:"text",value:f,onChange:e=>g(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-600 focus:outline-none",placeholder:i.placeholder_model})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Numero de serie"),React.createElement("input",{type:"text",value:x,onChange:e=>R(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-600 focus:outline-none",placeholder:i.placeholder_serial_number})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Emplacement"),React.createElement("input",{type:"text",value:h,onChange:e=>E(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-600 focus:outline-none",placeholder:i.placeholder_location})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Fabricant"),React.createElement("input",{type:"text",value:v,onChange:e=>y(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-600 focus:outline-none",placeholder:i.placeholder_manufacturer})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Annee"),React.createElement("input",{type:"number",value:N,onChange:e=>w(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-600 focus:outline-none",placeholder:"Ex: 2018"})),React.createElement("div",{className:"md:col-span-2"},React.createElement("label",{className:"block font-semibold mb-2"},"Specs Techniques"),React.createElement("textarea",{value:C,onChange:e=>_(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-600 focus:outline-none",placeholder:"Ex: Puissance 40kW, 5 axes...",rows:3}))),React.createElement("button",{type:"submit",className:"mt-4 px-6 py-3 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg font-bold shadow-lg hover:shadow-xl transition-all"},"Creer la Machine")):null,m?React.createElement("form",{onSubmit:async e=>{e.preventDefault();try{await axios.patch(API_URL+"/machines/"+m.id,{machine_type:k,model:M||null,serial_number:A||null,location:j||null,manufacturer:F||null,year:P?parseInt(P):null,technical_specs:U||null,status:H}),alert("Machine mise a jour!"),u(null),r()}catch(e){alert("Erreur: "+(e.response?.data?.error||"Erreur inconnue"))}},className:"mb-6 p-6 bg-white rounded-xl border border-blue-200 shadow-lg"},React.createElement("h3",{className:"text-xl font-bold mb-4 text-blue-800"},"Modifier Machine"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Type"),React.createElement("input",{type:"text",value:k,onChange:e=>S(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Modele"),React.createElement("input",{type:"text",value:M,onChange:e=>L(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Numero de serie"),React.createElement("input",{type:"text",value:A,onChange:e=>I(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Emplacement"),React.createElement("input",{type:"text",value:j,onChange:e=>q(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Fabricant"),React.createElement("input",{type:"text",value:F,onChange:e=>T(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Annee"),React.createElement("input",{type:"number",value:P,onChange:e=>D(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"})),React.createElement("div",{className:"md:col-span-2"},React.createElement("label",{className:"block font-semibold mb-2"},"Specs Techniques"),React.createElement("textarea",{value:U,onChange:e=>B(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none",rows:3})),React.createElement("div",{},React.createElement("label",{className:"block font-semibold mb-2"},"Statut"),React.createElement("select",{value:H,onChange:e=>O(e.target.value),className:"w-full px-4 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"},React.createElement("option",{value:"operational"},"Operationnelle"),React.createElement("option",{value:"maintenance"},"En maintenance"),React.createElement("option",{value:"out_of_service"},"Hors service")))),React.createElement("div",{className:"flex gap-3 mt-4"},React.createElement("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg font-bold shadow-lg hover:shadow-xl transition-all"},"Enregistrer"),React.createElement("button",{type:"button",onClick:()=>u(null),className:"px-6 py-3 bg-gray-400 text-white rounded-lg font-bold hover:bg-gray-500 transition-all"},"Annuler"))):null,React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"flex justify-between items-center mb-4"},React.createElement("p",{className:"text-gray-600 font-medium"},W.length+" machine(s) trouvée(s)")),W.map(e=>{return React.createElement("div",{key:e.id,className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200 hover:border-teal-400 hover:shadow-md transition-all group"},React.createElement("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2"},React.createElement("h4",{className:"font-bold text-lg text-gray-800 flex items-center gap-2"},e.machine_type,e.model?React.createElement("span",{className:"text-gray-500 font-normal"}," - "+e.model):null),React.createElement("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-bold uppercase tracking-wide "+(t=e.status,"operational"===t?"bg-green-100 text-green-800":"maintenance"===t?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800")},(e=>"operational"===e?"Operationnelle":"maintenance"===e?"En maintenance":"Hors service")(e.status))),React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-y-1 gap-x-4 mt-2"},React.createElement("p",{className:"text-sm text-gray-600 flex items-center gap-2"},React.createElement("i",{className:"fas fa-barcode text-gray-400 w-5 text-center"}),React.createElement("span",{className:"font-mono"},e.serial_number||"N/A")),e.location?React.createElement("p",{className:"text-sm text-gray-600 flex items-center gap-2"},React.createElement("i",{className:"fas fa-map-marker-alt text-gray-400 w-5 text-center"}),e.location):null,e.manufacturer||e.year?React.createElement("p",{className:"text-sm text-gray-600 flex items-center gap-2"},React.createElement("i",{className:"fas fa-industry text-gray-400 w-5 text-center"}),[e.manufacturer,e.year?`(${e.year})`:null].filter(Boolean).join(" ")):null),e.technical_specs?React.createElement("div",{className:"mt-3 pl-3 border-l-2 border-gray-100"},React.createElement("p",{className:"text-xs text-gray-500 italic line-clamp-2"},e.technical_specs)):null),"admin"===a?.role||"supervisor"===a?.role?React.createElement("div",{className:"flex gap-2 self-end sm:self-auto"},React.createElement("button",{onClick:()=>(e=>{u(e),S(e.machine_type),L(e.model||""),I(e.serial_number||""),q(e.location||""),T(e.manufacturer||""),D(e.year||""),B(e.technical_specs||""),O(e.status),setTimeout(()=>{z.current&&(z.current.scrollTop=0)},100)})(e),className:"px-3 sm:px-4 py-2 bg-blue-50 text-blue-700 rounded-lg font-bold hover:bg-blue-100 transition-all text-sm sm:text-base border border-blue-200"},React.createElement("i",{className:"fas fa-edit"}),React.createElement("span",{className:"ml-2 hidden sm:inline"},"Modifier")),"admin"===a?.role?React.createElement("button",{onClick:()=>(async e=>{if(confirm("Supprimer "+e.machine_type+" "+(e.model||"")+" ?"))try{await axios.delete(API_URL+"/machines/"+e.id),alert("Machine supprimee!"),r()}catch(e){alert("Erreur: "+(e.response?.data?.error||"Impossible de supprimer une machine avec des tickets"))}})(e),className:"px-3 sm:px-4 py-2 bg-red-50 text-red-700 rounded-lg font-bold hover:bg-red-100 transition-all text-sm sm:text-base border border-red-200"},React.createElement("i",{className:"fas fa-trash"}),React.createElement("span",{className:"ml-2 hidden sm:inline"},"Supprimer")):null):null));var t})))))};