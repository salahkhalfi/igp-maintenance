const ProductionPlanning=({onClose:e})=>{const[t,a]=React.useState(new Date),[n,r]=React.useState("all"),[i,l]=React.useState("calendar"),[o,s]=React.useState([{id:"prod",label:"Production",icon:"fa-industry",color:"blue"},{id:"maint",label:"Maintenance",icon:"fa-tools",color:"orange"},{id:"log",label:"Logistique",icon:"fa-truck",color:"purple"},{id:"qual",label:"Qualit√©",icon:"fa-clipboard-check",color:"green"},{id:"sst",label:"SST / S√©curit√©",icon:"fa-hard-hat",color:"red"},{id:"admin",label:"Admin / RH",icon:"fa-users",color:"gray"}]),[c,d]=React.useState(!1),[m,g]=React.useState(null),[p,u]=React.useState(!1),[b,f]=React.useState([]),[x,h]=React.useState([]),[y,v]=React.useState(!1),w=()=>{v(!0),axios.get("/api/planning?t="+Date.now()).then(e=>{const t=e.data;t.categories&&Array.isArray(t.categories)&&t.categories.length>0&&s(t.categories),t.events&&f(t.events),t.notes&&h(t.notes)}).catch(e=>{console.error("Error loading planning data:",e)}).finally(()=>{v(!1)})};React.useEffect(()=>{w()},[]);const E=(e,t)=>{const a=o.find(t=>t.id===e),n={blue:"bg-blue-50 text-blue-900 border-blue-600",green:"bg-green-50 text-green-900 border-green-600",red:"bg-red-50 text-red-900 border-red-600",yellow:"bg-yellow-50 text-yellow-900 border-yellow-500",purple:"bg-purple-50 text-purple-900 border-purple-600",orange:"bg-orange-50 text-orange-900 border-orange-600",gray:"bg-gray-100 text-gray-800 border-gray-400"},r=n[a?a.color:"gray"]||n.gray;return"tentative"===t?`${r} border-dashed opacity-80 border-l-4`:`${r} border-solid border-l-4`},R=e=>{const t=o.find(t=>t.id===e);return t?t.icon:"fa-circle"},[k,N]=React.useState(null),[$,D]=React.useState(!1),[S,M]=React.useState(!1),[z,C]=React.useState(!1),[j,_]=React.useState("month"),[F,P]=React.useState(null),[A,I]=React.useState("undefined"!=typeof Notification?Notification.permission:"default");React.useEffect(()=>{if("granted"!==A)return;const e=setInterval(()=>{const e=new Date,t=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;h(e=>{let a=!1;const n=e.map(e=>e.done||e.notified||e.time!==t?e:(new Notification("Rappel IGP Production",{body:e.text,icon:"https://cdn-icons-png.flaticon.com/512/1028/1028918.png"}),a=!0,{...e,notified:!0}));return a?n:e})},3e4);return()=>clearInterval(e)},[A]);const T=(e,t)=>{h(a=>a.map(a=>a.id===e?{...a,...t}:a)),axios.put(`/api/planning/notes/${e}`,t).then(t=>{t.data.note&&h(a=>a.map(a=>a.id===e?t.data.note:a))}).catch(a=>{console.error("Error updating note:",a),alert("Erreur lors de la mise √† jour : "+(a.response?.data?.error||a.message)),h(a=>a.map(a=>a.id===e?{...a,is_dashboard:!t.is_dashboard}:a))})},[Y,L]=React.useState(!1),[O,q]=React.useState(null),[V,H]=React.useState(""),U=(e,t)=>{e.stopPropagation(),q(t),H(t.date),L(!0)},G=e=>{e.target.style.opacity="1",N(null)},J=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},W=t.getFullYear(),B=t.getMonth(),K=new Date(W,B+1,0).getDate(),Q=Array.from({length:K},(e,t)=>{const a=t+1,n=new Date(W,B,a);return{num:a,dateStr:`${W}-${String(B+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,dayOfWeek:n.getDay()}});return React.createElement("div",{className:"fixed inset-0 z-[150] bg-gray-100 flex flex-col animate-fadeIn"},React.createElement("div",{className:"bg-white border-b p-3 lg:px-6 lg:py-3 flex flex-col md:flex-row justify-between items-start md:items-center gap-3 md:gap-0 shadow-sm z-20 shrink-0"},React.createElement("div",{className:"flex-1 min-w-0 w-full md:w-auto"},React.createElement("h1",{className:"text-lg lg:text-2xl font-bold text-slate-800 flex items-center gap-2 lg:gap-3 truncate"},React.createElement("div",{className:"bg-blue-600 text-white w-8 h-8 rounded-lg flex items-center justify-center shadow-sm shrink-0"},React.createElement("i",{className:"far fa-calendar-alt text-lg"})),React.createElement("span",{className:"truncate"},"Planning & Production")),React.createElement("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-1"},React.createElement("span",null,window.APP_COMPANY_NAME||"Entreprise"),React.createElement("i",{className:"fas fa-circle text-[4px] text-slate-300"}),React.createElement("span",null,"Vue Directeur"))),React.createElement("div",{className:"flex items-center justify-between md:justify-end gap-2 w-full md:w-auto"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("button",{onClick:()=>d(!0),className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition shadow-sm"},React.createElement("i",{className:"fas fa-cog"})),React.createElement("button",{onClick:()=>D(!$),className:"lg:hidden w-10 h-10 flex items-center justify-center rounded-lg transition "+($?"bg-yellow-100 text-yellow-600":"bg-gray-100 text-gray-500")},React.createElement("i",{className:"fas fa-sticky-note"}))),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("button",{onClick:w,title:"Rafra√Æchir les donn√©es",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition shadow-sm"},React.createElement("i",{className:"fas fa-sync-alt "+(y?"fa-spin text-blue-600":"")})),React.createElement("button",{onClick:()=>M(!0),title:"Partager le planning",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-blue-50 hover:text-blue-600 transition shadow-sm"},React.createElement("i",{className:"fas fa-share-alt"})),React.createElement("button",{onClick:()=>{P(new Date(t)),C(!0)},title:"Imprimer le planning (PDF)",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-green-50 hover:text-green-600 transition shadow-sm"},React.createElement("i",{className:"fas fa-print"})),React.createElement("button",{onClick:()=>l("calendar"===i?"list":"calendar"),title:"calendar"===i?"Passer en vue TV / Liste":"Passer en vue Calendrier",className:"w-10 h-10 flex items-center justify-center rounded-lg border transition shadow-sm "+("list"===i?"bg-slate-800 text-white border-slate-900":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50")},React.createElement("i",{className:"calendar"===i?"fas fa-tv":"fas fa-calendar-alt"})),React.createElement("button",{onClick:()=>u(!0),title:"Configuration √©cran TV",className:"w-10 h-10 flex items-center justify-center rounded-lg border transition shadow-sm bg-white border-slate-200 text-purple-600 hover:bg-purple-50 hover:border-purple-300"},React.createElement("i",{className:"fas fa-desktop"})),React.createElement("button",{onClick:()=>{const e=new Date,a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(Math.max(1,Math.min(e.getDate(),K))).padStart(2,"0")}`;H(a),q(null),L(!0)},className:"flex px-3 lg:px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md transition font-semibold items-center gap-2"},React.createElement("i",{className:"fas fa-plus"}),React.createElement("span",{className:"hidden sm:inline"},"Nouvel √âv√©nement")),React.createElement("div",{className:"h-8 w-px bg-gray-200 mx-1 hidden md:block"}),React.createElement("button",{onClick:e,className:"bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg font-medium transition shadow-sm"},"Fermer")))),React.createElement("div",{className:"bg-white border-b py-2 px-2 lg:px-6 flex flex-col lg:flex-row gap-3 lg:gap-4 items-stretch lg:items-center shadow-sm z-10 shrink-0"},React.createElement("div",{className:"flex items-center overflow-hidden w-full lg:w-auto min-w-0"},React.createElement("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mr-2 shrink-0 hidden lg:inline"},"Filtres :"),React.createElement("div",{className:"flex overflow-x-auto gap-2 items-center pb-2 lg:pb-0 w-full no-scrollbar mask-linear-fade",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"}},React.createElement("button",{onClick:()=>r("all"),className:"px-4 py-2 rounded-full text-sm font-bold transition-all duration-200 border whitespace-nowrap flex-shrink-0 "+("all"===n?"bg-slate-800 text-white border-slate-900 shadow-md transform scale-105":"bg-white text-slate-600 border-slate-300 hover:border-slate-400 shadow-sm")},"Tout Voir"),0===o.length?React.createElement("span",{className:"text-xs text-gray-400 italic whitespace-nowrap px-2"},"Aucune cat√©gorie"):null,o.map(e=>{const t={blue:n===e.id?"bg-blue-600 text-white border-blue-700 shadow-md transform scale-105":"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100",green:n===e.id?"bg-green-600 text-white border-green-700 shadow-md transform scale-105":"bg-green-50 text-green-700 border-green-200 hover:bg-green-100",red:n===e.id?"bg-red-600 text-white border-red-700 shadow-md transform scale-105":"bg-red-50 text-red-700 border-red-200 hover:bg-red-100",yellow:n===e.id?"bg-yellow-500 text-white border-yellow-600 shadow-md transform scale-105":"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-100",purple:n===e.id?"bg-purple-600 text-white border-purple-700 shadow-md transform scale-105":"bg-purple-50 text-purple-700 border-purple-200 hover:bg-purple-100",orange:n===e.id?"bg-orange-600 text-white border-orange-700 shadow-md transform scale-105":"bg-orange-50 text-orange-800 border-orange-200 hover:bg-orange-100",gray:n===e.id?"bg-gray-600 text-white border-gray-700 shadow-md transform scale-105":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"},a=t[e.color]||t.gray;return React.createElement("button",{key:e.id,onClick:()=>r(e.id),className:`px-4 py-2 rounded-full text-sm font-bold transition-all duration-200 flex items-center gap-2 border whitespace-nowrap flex-shrink-0 ${a}`},React.createElement("i",{className:`fas ${e.icon} ${n===e.id?"text-white":""} text-sm`}),e.label)}))),React.createElement("div",{className:"flex justify-center lg:justify-end lg:ml-auto shrink-0"},React.createElement("div",{className:"flex bg-gray-100 rounded-lg p-1 shadow-inner"},React.createElement("button",{onClick:()=>{a(new Date(t.getFullYear(),t.getMonth()-1,1))},className:"w-10 h-8 flex items-center justify-center bg-white shadow-sm rounded text-slate-700 hover:bg-slate-50 active:scale-95 transition"},React.createElement("i",{className:"fas fa-chevron-left"})),React.createElement("span",{className:"px-4 flex items-center justify-center font-bold text-slate-700 text-sm whitespace-nowrap capitalize w-36"},t.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})),React.createElement("button",{onClick:()=>{a(new Date(t.getFullYear(),t.getMonth()+1,1))},className:"w-10 h-8 flex items-center justify-center bg-white shadow-sm rounded text-slate-700 hover:bg-slate-50 active:scale-95 transition"},React.createElement("i",{className:"fas fa-chevron-right"}))))),React.createElement("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden relative"},"list"===i?React.createElement("div",{className:"flex-1 flex flex-col bg-slate-50 lg:border-r border-gray-200 overflow-y-auto p-4 lg:p-8"},React.createElement("div",{className:"max-w-5xl mx-auto w-full space-y-8"},(()=>{const e=b.filter(e=>{const a=new Date(e.date);return a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()&&("all"===n||e.type===n)}).sort((e,t)=>new Date(e.date)-new Date(t.date));if(0===e.length)return React.createElement("div",{className:"text-center py-20 text-gray-400"},React.createElement("i",{className:"fas fa-calendar-times text-6xl mb-4 opacity-50"}),React.createElement("p",{className:"text-xl font-medium"},"Aucun √©v√©nement pour ce mois"));const a=e.reduce((e,t)=>(e[t.date]||(e[t.date]=[]),e[t.date].push(t),e),{});return Object.keys(a).map(e=>{const t=new Date(e),n=t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"});return React.createElement("div",{key:e,className:"animate-slideIn"},React.createElement("h3",{className:"text-2xl font-bold text-slate-800 mb-4 capitalize flex items-center gap-3 border-b border-slate-200 pb-2"},React.createElement("span",{className:"text-blue-600"},t.getDate()),n),React.createElement("div",{className:"grid gap-4"},a[e].map(e=>{const t=o.find(t=>t.id===e.type),a=E(e.type,e.status);return React.createElement("div",{key:e.id,onClick:t=>U(t,e),className:`bg-white rounded-xl shadow-sm border-l-8 p-6 cursor-pointer hover:shadow-lg transition-all ${a.replace("border-l-4","border-l-8")}`},React.createElement("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center gap-3 mb-2"},React.createElement("span",{className:"px-3 py-1 rounded-full text-sm font-bold uppercase tracking-wider flex items-center gap-2 w-fit "+("blue"===t?.color?"bg-blue-100 text-blue-800":"green"===t?.color?"bg-green-100 text-green-800":"red"===t?.color?"bg-red-100 text-red-800":"yellow"===t?.color?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800")},React.createElement("i",{className:`fas ${t?.icon||"fa-circle"}`}),t?.label||"Autre"),"tentative"===e.status&&React.createElement("span",{className:"text-amber-500 font-bold text-sm flex items-center gap-1"},React.createElement("i",{className:"fas fa-question-circle"}),"√Ä confirmer")),React.createElement("h4",{className:"text-2xl font-bold text-slate-900 mb-2 leading-snug flex items-center gap-2"},e.time&&React.createElement("span",{className:"text-lg font-mono font-normal text-slate-500 bg-slate-100 px-2 py-0.5 rounded"},e.time),e.title),e.details&&React.createElement("div",{className:"text-lg text-slate-600 leading-relaxed bg-slate-50 p-4 rounded-lg border border-slate-100 mt-2"},e.details.split("\n").map((e,t)=>React.createElement("p",{key:t,className:"mb-1 last:mb-0"},e)))),React.createElement("div",{className:"flex items-center gap-2 md:flex-col shrink-0"},React.createElement("button",{className:"w-12 h-12 flex items-center justify-center rounded-full bg-slate-100 text-slate-400 hover:bg-blue-50 hover:text-blue-600 transition"},React.createElement("i",{className:"fas fa-pen text-xl"})))))})))})})())):React.createElement("div",{className:"flex-1 flex flex-col bg-slate-50 lg:border-r border-gray-200 overflow-hidden"},React.createElement("div",{className:"hidden lg:grid grid-cols-7 border-b bg-white shadow-sm"},["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"].map(e=>React.createElement("div",{key:e,className:"py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider"},e))),React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-7 flex-1 overflow-y-auto p-3 lg:p-4 gap-3 lg:gap-4 pb-20 lg:pb-4"},Array.from({length:new Date(W,B,1).getDay()}).map((e,t)=>React.createElement("div",{key:`empty-${t}`,className:"hidden lg:block bg-transparent"})),Q.map((e,a)=>{const r=(i=e.dateStr,b.filter(e=>e.date===i&&("all"===n||e.type==n)));var i;return React.createElement("div",{key:e.dateStr,onDragOver:J,onDrop:t=>((e,t)=>{e.preventDefault(),k&&t&&(f(e=>e.map(e=>e.id===k?{...e,date:t}:e)),axios.put(`/api/planning/events/${k}`,{date:t}).catch(e=>console.error("Error moving event:",e)))})(t,e.dateStr),className:"rounded-xl border bg-white border-slate-200 hover:shadow-md hover:border-blue-300 p-3 flex flex-col gap-2 relative transition-all group min-h-[140px]"},React.createElement("div",{className:"flex justify-between items-start mb-1"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"text-lg font-bold w-8 h-8 flex items-center justify-center rounded-full "+(e.num===(new Date).getDate()&&t.getMonth()===(new Date).getMonth()?"bg-blue-600 text-white shadow-md":"text-slate-700 bg-slate-100")},e.num),React.createElement("span",{className:"lg:hidden text-sm font-bold text-slate-500 uppercase"},["Dim","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Sam"][e.dayOfWeek])),React.createElement("div",{className:"flex items-center gap-1"},r.length>0&&React.createElement("span",{className:"text-[10px] font-bold text-slate-500 bg-slate-100 border border-slate-200 px-1.5 py-0.5 rounded-md"},`${r.length}`),React.createElement("button",{onClick:()=>{q(null),H(e.dateStr),L(!0)},className:"opacity-100 lg:opacity-0 lg:group-hover:opacity-100 text-slate-400 hover:text-blue-600 transition p-1"},React.createElement("i",{className:"fas fa-plus-circle text-lg"})))),React.createElement("div",{className:"flex-1 overflow-y-auto space-y-1 custom-scrollbar"},r.map((e,t)=>React.createElement("div",{key:e.id||t,draggable:!0,onClick:t=>U(t,e),onDragStart:t=>((e,t)=>{N(t),e.dataTransfer.effectAllowed="move",e.target.style.opacity="0.5"})(t,e.id),onDragEnd:G,className:`text-xs p-2 rounded-lg shadow-sm cursor-pointer hover:scale-[1.02] transition-transform border border-transparent ${E(e.type,e.status)}`,title:"Cliquez pour modifier"},React.createElement("div",{className:"flex items-center justify-between mb-0.5"},React.createElement("div",{className:"flex items-center gap-1.5"},React.createElement("i",{className:`fas ${R(e.type)}`}),React.createElement("span",{className:"font-bold truncate max-w-[80px]"},o.find(t=>t.id===e.type)?.label||"Autre")),"tentative"===e.status&&React.createElement("i",{className:"fas fa-question-circle opacity-50"})),React.createElement("div",{className:"truncate font-medium leading-tight"},e.time&&React.createElement("span",{className:"mr-1 font-mono text-[10px] opacity-75 bg-white/50 px-1 rounded"},e.time),e.title),e.details&&React.createElement("div",{className:"text-[10px] opacity-75 truncate mt-0.5"},e.details)))))}))),"calendar"===i?React.createElement(window.PlanningNotes,{notes:x,showMobile:$,onCloseMobile:()=>D(!1),onAdd:e=>{e.preventDefault();const t=new FormData(e.target),a=t.get("text"),n=t.get("time"),r=t.get("date"),i="on"===t.get("is_dashboard");if(!a)return;const l={id:Date.now(),text:a,time:n,date:r,done:!1,priority:"medium",notified:!1,is_dashboard:i};h(e=>[...e,l]),axios.post("/api/planning/notes",l).then(e=>{const t=e.data;h(e=>e.map(e=>e.id===l.id?t:e))}).catch(e=>{console.error("Error adding note:",e),alert("Erreur lors de l'ajout : "+(e.response?.data?.error||e.message)),h(e=>e.filter(e=>e.id!==l.id))}),e.target.reset()},onUpdate:T,onToggle:e=>{const t=x.find(t=>t.id===e);t&&T(e,{done:!t.done})},onDelete:e=>{h(x.filter(t=>t.id!==e)),axios.delete(`/api/planning/notes/${e}`).catch(e=>console.error("Error deleting note:",e))},notificationPerm:A,onRequestPerm:()=>{"Notification"in window?Notification.requestPermission().then(e=>{I(e),"granted"===e&&new Notification("Notifications activ√©es",{body:"Vous recevrez d√©sormais des alertes pour vos t√¢ches.",icon:"/favicon.ico"})}):alert("Ce navigateur ne supporte pas les notifications desktop")}}):null),React.createElement(window.PlanningModals,{showAddModal:Y,setShowAddModal:L,selectedEvent:O,newEventDate:V,categories:o,onSaveEvent:e=>{e.preventDefault();const t=new FormData(e.target),a=t.get("date"),n="on"===t.get("show_on_tv"),r="on"===t.get("is_popup"),i=t.get("image_url"),l=t.get("display_duration");if(O){const e={date:a,time:t.get("time"),type:t.get("type"),title:t.get("title"),details:t.get("details"),show_on_tv:n,is_popup:r,image_url:i,display_duration:l?parseInt(l):15};f(t=>t.map(t=>t.id===O.id?{...t,...e}:t)),axios.put(`/api/planning/events/${O.id}`,e).catch(e=>console.error("Error updating event:",e))}else{const e={id:Date.now(),date:a,time:t.get("time"),type:t.get("type"),status:"confirmed",title:t.get("title"),details:t.get("details"),show_on_tv:n,is_popup:r,image_url:i,display_duration:l?parseInt(l):15};f([...b,e]),axios.post("/api/planning/events",e).then(t=>{const a=t.data;f(t=>t.map(t=>t.id===e.id?a:t))}).catch(e=>console.error("Error creating event:",e))}L(!1),q(null)},onDeleteEvent:()=>{O&&(f(e=>e.filter(e=>e.id!==O.id)),axios.delete(`/api/planning/events/${O.id}`).catch(e=>console.error("Error deleting event:",e)),L(!1),q(null))},showCategoryModal:c,setShowCategoryModal:d,editingCategory:m,onEditCategoryClick:e=>{g(e)},onCancelEditCategory:()=>{g(null)},onDeleteCategory:e=>{confirm("Supprimer cette cat√©gorie ? Les √©v√©nements existants perdront leur style.")&&(s(o.filter(t=>t.id!==e)),m&&m.id===e&&g(null),axios.delete(`/api/planning/categories/${e}`).catch(e=>console.error("Error deleting category:",e)))},onSaveCategory:e=>{e.preventDefault();const t=new FormData(e.target);if(m){const e={label:t.get("label"),color:t.get("color"),icon:t.get("icon")};s(o.map(t=>t.id===m.id?{...t,...e}:t)),g(null),axios.put(`/api/planning/categories/${m.id}`,e).catch(e=>console.error("Error updating category:",e))}else{const e={id:"cat_"+Date.now(),label:t.get("label"),color:t.get("color"),icon:t.get("icon")};s([...o,e]),axios.post("/api/planning/categories",e).catch(e=>console.error("Error creating category:",e))}e.target.reset()}}),S&&React.createElement(ShareModal,{onClose:()=>M(!1),onShare:async(e,t)=>{try{await axios.post("/api/planning/share",{targetUserId:e,message:t}),alert("Invitation envoy√©e avec succ√®s !")}catch(e){throw console.error(e),alert("Erreur lors de l'envoi : "+(e.response?.data?.error||e.message)),e}}}),z&&React.createElement(PrintExportModal,{currentDate:t,onClose:()=>C(!1),onPrint:async(e,a)=>{C(!1);const n=a||F||t,r=n.getFullYear(),i=n.getMonth();let l="Syst√®me de Maintenance",s="",c="";try{const[e,t]=await Promise.all([axios.get("/api/settings/company_title").catch(()=>null),axios.get("/api/settings/company_subtitle").catch(()=>null)]);e?.data?.value&&(l=e.data.value),t?.data?.value&&(s=t.data.value),c="/api/settings/logo?t="+Date.now()}catch(e){}let d=[];try{const e=await axios.get("/api/tickets?status=assigned,in_progress,diagnostic,waiting_parts,received");e?.data?.tickets&&(d=e.data.tickets.filter(e=>e.scheduled_date))}catch(e){}const m={blue:{bg:"#dbeafe",border:"#3b82f6",text:"#1e40af"},green:{bg:"#dcfce7",border:"#22c55e",text:"#166534"},red:{bg:"#fee2e2",border:"#ef4444",text:"#991b1b"},yellow:{bg:"#fef9c3",border:"#eab308",text:"#854d0e"},purple:{bg:"#f3e8ff",border:"#a855f7",text:"#6b21a8"},orange:{bg:"#ffedd5",border:"#f97316",text:"#9a3412"},gray:{bg:"#f3f4f6",border:"#6b7280",text:"#374151"}},g={critical:"#dc2626",high:"#ea580c",medium:"#ca8a04",low:"#16a34a"},p={critical:"CRITIQUE",high:"HAUTE",medium:"MOYENNE",low:"BASSE"};let u="";if("month"===e){const e=n.toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),t=new Date(r,i+1,0).getDate(),a=b.filter(e=>{const t=new Date(e.date);return t.getMonth()===i&&t.getFullYear()===r}).sort((e,t)=>new Date(e.date)-new Date(t.date)),f=d.filter(e=>{const t=new Date(e.scheduled_date);return t.getMonth()===i&&t.getFullYear()===r}).sort((e,t)=>new Date(e.scheduled_date)-new Date(t.scheduled_date)),x={};for(let e=1;e<=t;e++){const t=`${r}-${String(i+1).padStart(2,"0")}-${String(e).padStart(2,"0")}`,n=new Date(r,i,e),l=a.filter(e=>e.date===t),o=f.filter(t=>new Date(t.scheduled_date).getDate()===e);(l.length>0||o.length>0)&&(x[e]={date:n,events:l,tickets:o})}const h=a.length,y=f.length,v=f.filter(e=>"critical"===e.priority||"high"===e.priority).length,w=o.map(e=>({...e,count:a.filter(t=>t.type===e.id).length})).filter(e=>e.count>0);let E="";Object.keys(x).forEach(e=>{const t=x[e],a=t.date.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),n=0===t.date.getDay()||6===t.date.getDay();let r="";t.events.forEach(e=>{const t=o.find(t=>t.id===e.type),a=m[t?.color]||m.gray;r+=`\n                        <div class="timeline-event" style="border-left-color: ${a.border}; background: ${a.bg};">\n                            <div class="event-header">\n                                <span class="event-time">${e.time||"‚Äî"}</span>\n                                <span class="event-category" style="color: ${a.text};">${t?.label||e.type}</span>\n                                <span class="event-status ${e.status}">${"tentative"===e.status?"‚è≥":"‚úÖ"}</span>\n                            </div>\n                            <div class="event-title">${e.title}</div>\n                            ${e.details?`<div class="event-details">${e.details}</div>`:""}\n                        </div>\n                    `}),t.tickets.forEach(e=>{const t=new Date(e.scheduled_date),a=t.getHours()?t.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"‚Äî";r+=`\n                        <div class="timeline-ticket">\n                            <div class="ticket-header">\n                                <span class="ticket-time">${a}</span>\n                                <span class="ticket-priority" style="color: ${g[e.priority]||"#374151"};">${p[e.priority]||e.priority}</span>\n                                <span class="ticket-id">#${e.ticket_id}</span>\n                            </div>\n                            <div class="ticket-title">üîß ${e.title}</div>\n                            <div class="ticket-meta">\n                                ${e.assignee_name?`<span>üë§ ${e.assignee_name}</span>`:'<span class="unassigned">‚ö†Ô∏è Non assign√©</span>'}\n                                ${e.machine_name?`<span>üè≠ ${e.machine_name}</span>`:""}\n                            </div>\n                        </div>\n                    `});const i=t.events.length+t.tickets.length;E+=`\n                    <div class="timeline-day ${n?"weekend":""}">\n                        <div class="day-header">\n                            <span class="day-date">${a}</span>\n                            <span class="day-count">${i} √©l√©ment${i>1?"s":""}</span>\n                        </div>\n                        <div class="day-items">${r}</div>\n                    </div>\n                `}),0===Object.keys(x).length&&(E='<div class="no-data">Aucun √©v√©nement ou maintenance planifi√© ce mois</div>'),u=`\n                <html>\n                <head>\n                    <title>Planning Mensuel - ${e}</title>\n                    <style>\n                        @page { size: A4; margin: 0; }\n                        * { box-sizing: border-box; margin: 0; padding: 0; }\n                        body { font-family: 'Segoe UI', -apple-system, Arial, sans-serif; padding: 18mm 15mm 20mm 15mm; font-size: 11px; color: #1a1a1a; line-height: 1.4; }\n                        \n                        /* === HEADER === */\n                        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 14px; margin-bottom: 16px; border-bottom: 2px solid #d1d5db; }\n                        .company-section { display: flex; align-items: center; gap: 12px; }\n                        .company-logo { max-height: 40px; max-width: 90px; }\n                        .company-info { }\n                        .company-title { font-size: 15px; font-weight: 700; color: #111827; }\n                        .company-subtitle { font-size: 10px; color: #4b5563; margin-top: 2px; }\n                        .report-section { text-align: right; }\n                        .report-badge { display: inline-block; background: #1e40af; color: white; font-size: 9px; font-weight: 600; padding: 3px 8px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }\n                        .report-title { font-size: 13px; font-weight: 700; color: #111827; text-transform: capitalize; }\n                        .report-generated { font-size: 9px; color: #6b7280; margin-top: 3px; }\n                        \n                        /* === KPI BAR === */\n                        .kpi-bar { display: flex; gap: 0; margin-bottom: 16px; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; }\n                        .kpi-item { flex: 1; text-align: center; padding: 10px 6px; border-right: 1px solid #d1d5db; background: #f9fafb; }\n                        .kpi-item:last-child { border-right: none; }\n                        .kpi-value { font-size: 20px; font-weight: 700; color: #111827; }\n                        .kpi-label { font-size: 8px; color: #4b5563; text-transform: uppercase; letter-spacing: 0.3px; margin-top: 2px; }\n                        .kpi-item.highlight { background: #fef3c7; }\n                        .kpi-item.highlight .kpi-value { color: #92400e; }\n                        .kpi-item.alert .kpi-value { color: #b91c1c; }\n                        \n                        /* === CATEGORY BAR === */\n                        .category-bar { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; }\n                        .cat-badge { padding: 3px 8px; border-radius: 12px; font-size: 9px; font-weight: 600; }\n                        \n                        /* === TIMELINE DAYS === */\n                        .timeline-day { margin-bottom: 10px; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; page-break-inside: avoid; }\n                        .timeline-day.weekend { opacity: 0.75; }\n                        .day-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #f3f4f6; border-bottom: 1px solid #d1d5db; }\n                        .day-date { font-weight: 600; font-size: 11px; color: #111827; text-transform: capitalize; }\n                        .day-count { font-size: 9px; color: #4b5563; }\n                        .day-items { padding: 8px 12px; background: white; }\n                        \n                        /* === TIMELINE ITEMS === */\n                        .timeline-event { display: flex; gap: 10px; padding: 8px 10px; margin-bottom: 6px; border-radius: 4px; border-left: 3px solid #d1d5db; background: #f9fafb; }\n                        .timeline-event:last-child { margin-bottom: 0; }\n                        .event-header { display: flex; gap: 8px; align-items: center; margin-bottom: 3px; font-size: 9px; }\n                        .event-time { font-weight: 600; color: #374151; min-width: 42px; }\n                        .event-category { font-weight: 600; }\n                        .event-status { margin-left: auto; font-size: 9px; color: #4b5563; }\n                        .event-title { font-weight: 600; font-size: 11px; color: #111827; }\n                        .event-details { font-size: 9px; color: #4b5563; margin-top: 2px; }\n                        \n                        .timeline-ticket { display: flex; gap: 10px; padding: 8px 10px; margin-bottom: 6px; border-left: 3px solid #d97706; background: #fffbeb; border-radius: 4px; }\n                        .timeline-ticket:last-child { margin-bottom: 0; }\n                        .ticket-header { display: flex; gap: 8px; align-items: center; margin-bottom: 3px; font-size: 9px; }\n                        .ticket-time { font-weight: 600; color: #374151; min-width: 42px; }\n                        .ticket-priority { font-weight: 700; font-size: 8px; background: currentColor; color: white; padding: 2px 6px; border-radius: 8px; }\n                        .ticket-id { margin-left: auto; color: #4b5563; font-size: 9px; }\n                        .ticket-title { font-weight: 600; font-size: 11px; color: #78350f; }\n                        .ticket-meta { display: flex; gap: 10px; font-size: 9px; color: #57534e; margin-top: 4px; }\n                        .ticket-meta .unassigned { color: #b91c1c; font-weight: 600; }\n                        \n                        .no-data { text-align: center; padding: 30px; color: #6b7280; font-style: italic; background: #f9fafb; border-radius: 6px; border: 1px solid #d1d5db; }\n                        \n                        /* === FOOTER === */\n                        .footer { margin-top: 16px; padding-top: 10px; border-top: 1px solid #d1d5db; display: flex; justify-content: space-between; align-items: center; font-size: 9px; color: #6b7280; }\n                        \n                        @media print { \n                            body { padding: 18mm 15mm 20mm 15mm !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; } \n                            .timeline-day { page-break-inside: avoid; } \n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class="header">\n                        <div class="company-section">\n                            <img src="${c}" class="company-logo" onerror="this.style.display='none'" />\n                            <div class="company-info">\n                                <div class="company-title">${l}</div>\n                                ${s?`<div class="company-subtitle">${s}</div>`:""}\n                            </div>\n                        </div>\n                        <div class="report-section">\n                            <div class="report-badge">Vue Mensuelle</div>\n                            <div class="report-title">${e}</div>\n                            <div class="report-generated">G√©n√©r√© le ${(new Date).toLocaleString("fr-FR")}</div>\n                        </div>\n                    </div>\n                    \n                    <div class="kpi-bar">\n                        <div class="kpi-item"><div class="kpi-value">${h}</div><div class="kpi-label">√âv√©nements</div></div>\n                        <div class="kpi-item highlight"><div class="kpi-value">${y}</div><div class="kpi-label">Maintenances</div></div>\n                        <div class="kpi-item ${v>0?"alert":""}"><div class="kpi-value">${v}</div><div class="kpi-label">Priorit√© haute</div></div>\n                        <div class="kpi-item"><div class="kpi-value">${Object.keys(x).length}</div><div class="kpi-label">Jours actifs</div></div>\n                    </div>\n                    \n                    ${w.length>0?`<div class="category-bar">${w.map(e=>{const t=m[e.color]||m.gray;return`<span class="cat-badge" style="background: ${t.bg}; color: ${t.text}; border: 1px solid ${t.border};">${e.label}: ${e.count}</span>`}).join("")}</div>`:""}\n                    \n                    ${E}\n                    \n                    <div class="footer">\n                        <span>Document confidentiel ‚Ä¢ Ne pas diffuser</span>\n                        <span>${s||"Gestion Maintenance"}</span>\n                    </div>\n                </body>\n                </html>\n            `}else if("week"===e){const e=new Date(n),t=e.getDay();e.setDate(e.getDate()-t+(0===t?-6:1));const a=[];for(let t=0;t<7;t++){const n=new Date(e);n.setDate(n.getDate()+t),a.push(n)}const r=a[0].toLocaleDateString("fr-FR",{day:"numeric",month:"long"}),i=a[6].toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),f=Math.ceil(((e-new Date(e.getFullYear(),0,1))/864e5+1)/7);let x=[],h=[];a.forEach(e=>{const t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,a=b.filter(e=>e.date===t),n=d.filter(t=>new Date(t.scheduled_date).toDateString()===e.toDateString());x.push(...a),h.push(...n)});const y=x.length,v=h.length,w=h.filter(e=>"critical"===e.priority||"high"===e.priority).length,E=a.filter(e=>{const t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;return b.some(e=>e.date===t)||d.some(t=>new Date(t.scheduled_date).toDateString()===e.toDateString())}).length;let R="";a.forEach((e,t)=>{const a=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,n=b.filter(e=>e.date===a).sort((e,t)=>(e.time||"").localeCompare(t.time||"")),r=d.filter(t=>new Date(t.scheduled_date).toDateString()===e.toDateString()).sort((e,t)=>new Date(e.scheduled_date)-new Date(t.scheduled_date)),i=e.toDateString()===(new Date).toDateString(),l=t>=5,s=e.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),c=n.length+r.length;let u="";n.forEach(e=>{const t=o.find(t=>t.id===e.type),a=m[t?.color]||m.gray;u+=`\n                        <div class="timeline-item event-item" style="border-left-color: ${a.border}; background: ${a.bg};">\n                            <div class="item-time">${e.time||"‚Äî"}</div>\n                            <div class="item-content">\n                                <div class="item-header">\n                                    <span class="item-category" style="color: ${a.text};">${t?.label||e.type}</span>\n                                    <span class="item-status">${"tentative"===e.status?"‚è≥ Provisoire":"‚úì Confirm√©"}</span>\n                                </div>\n                                <div class="item-title">${e.title}</div>\n                                ${e.details?`<div class="item-details">${e.details}</div>`:""}\n                            </div>\n                        </div>\n                    `}),r.forEach(e=>{const t=new Date(e.scheduled_date),a=t.getHours()?t.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"‚Äî";u+=`\n                        <div class="timeline-item ticket-item">\n                            <div class="item-time">${a}</div>\n                            <div class="item-content">\n                                <div class="item-header">\n                                    <span class="item-priority" style="background: ${g[e.priority]||"#6b7280"};">${p[e.priority]||"N/A"}</span>\n                                    <span class="item-ticket-id">#${e.ticket_id}</span>\n                                </div>\n                                <div class="item-title">${e.title}</div>\n                                <div class="item-meta">\n                                    ${e.assignee_name?`<span class="meta-assignee">üë§ ${e.assignee_name}</span>`:'<span class="meta-unassigned">‚ö† Non assign√©</span>'}\n                                    ${e.machine_name?`<span class="meta-machine">‚öô ${e.machine_name}</span>`:""}\n                                </div>\n                            </div>\n                        </div>\n                    `}),u||(u=`<div class="empty-day">${l?"Week-end":"Aucune activit√© planifi√©e"}</div>`),R+=`\n                    <div class="day-block ${i?"today":""} ${l?"weekend":""} ${0===c?"empty":""}">\n                        <div class="day-header">\n                            <div class="day-label">\n                                <span class="day-name">${s}</span>\n                                ${i?'<span class="today-badge">Aujourd\'hui</span>':""}\n                            </div>\n                            <span class="day-count">${c>0?c+" √©l√©ment"+(c>1?"s":""):""}</span>\n                        </div>\n                        <div class="day-content">${u}</div>\n                    </div>\n                `}),u=`\n                <html>\n                <head>\n                    <title>Planning Semaine ${f} - ${r} au ${i}</title>\n                    <style>\n                        @page { size: A4; margin: 0; }\n                        * { box-sizing: border-box; margin: 0; padding: 0; }\n                        body { font-family: 'Segoe UI', -apple-system, Arial, sans-serif; padding: 18mm 15mm 20mm 15mm; font-size: 11px; color: #1a1a1a; line-height: 1.4; }\n                        \n                        /* === HEADER === */\n                        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 14px; margin-bottom: 16px; border-bottom: 2px solid #d1d5db; }\n                        .company-section { display: flex; align-items: center; gap: 12px; }\n                        .company-logo { max-height: 40px; max-width: 90px; }\n                        .company-info { }\n                        .company-title { font-size: 15px; font-weight: 700; color: #111827; }\n                        .company-subtitle { font-size: 10px; color: #4b5563; margin-top: 2px; }\n                        .report-section { text-align: right; }\n                        .report-badge { display: inline-block; background: #1e40af; color: white; font-size: 9px; font-weight: 600; padding: 3px 8px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }\n                        .report-title { font-size: 13px; font-weight: 700; color: #111827; }\n                        .report-period { font-size: 10px; color: #4b5563; margin-top: 3px; }\n                        .report-generated { font-size: 9px; color: #6b7280; margin-top: 3px; }\n                        \n                        /* === KPI BAR === */\n                        .kpi-bar { display: flex; gap: 0; margin-bottom: 16px; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; }\n                        .kpi-item { flex: 1; text-align: center; padding: 10px 6px; border-right: 1px solid #d1d5db; background: #f9fafb; }\n                        .kpi-item:last-child { border-right: none; }\n                        .kpi-value { font-size: 20px; font-weight: 700; color: #111827; }\n                        .kpi-label { font-size: 8px; color: #4b5563; text-transform: uppercase; letter-spacing: 0.3px; margin-top: 2px; }\n                        .kpi-item.highlight { background: #fef3c7; }\n                        .kpi-item.highlight .kpi-value { color: #92400e; }\n                        .kpi-item.alert .kpi-value { color: #b91c1c; }\n                        \n                        /* === TIMELINE DAYS === */\n                        .day-block { margin-bottom: 10px; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; page-break-inside: avoid; }\n                        .day-block.empty { opacity: 0.65; }\n                        .day-block.weekend { background: #f9fafb; }\n                        .day-block.today { border: 2px solid #1e40af; }\n                        \n                        .day-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #f3f4f6; border-bottom: 1px solid #d1d5db; }\n                        .day-label { display: flex; align-items: center; gap: 8px; }\n                        .day-name { font-weight: 600; font-size: 11px; color: #111827; text-transform: capitalize; }\n                        .today-badge { font-size: 8px; font-weight: 600; color: #1e40af; background: #dbeafe; padding: 2px 6px; border-radius: 8px; }\n                        .day-count { font-size: 9px; color: #4b5563; }\n                        \n                        .day-content { padding: 8px 12px; background: white; }\n                        \n                        /* === TIMELINE ITEMS === */\n                        .timeline-item { display: flex; gap: 10px; padding: 8px 10px; margin-bottom: 6px; border-radius: 4px; border-left: 3px solid #d1d5db; background: #f9fafb; }\n                        .timeline-item:last-child { margin-bottom: 0; }\n                        \n                        .timeline-item.event-item { }\n                        .timeline-item.ticket-item { border-left-color: #d97706; background: #fffbeb; }\n                        \n                        .item-time { min-width: 42px; font-weight: 600; font-size: 10px; color: #374151; padding-top: 2px; }\n                        .item-content { flex: 1; }\n                        .item-header { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }\n                        .item-category { font-size: 9px; font-weight: 600; }\n                        .item-status { font-size: 8px; color: #4b5563; margin-left: auto; }\n                        .item-priority { font-size: 8px; font-weight: 600; color: white; padding: 2px 6px; border-radius: 8px; }\n                        .item-ticket-id { font-size: 9px; color: #4b5563; margin-left: auto; }\n                        .item-title { font-size: 11px; font-weight: 600; color: #111827; }\n                        .item-details { font-size: 9px; color: #4b5563; margin-top: 2px; }\n                        .item-meta { display: flex; gap: 10px; margin-top: 4px; font-size: 9px; color: #4b5563; }\n                        .meta-unassigned { color: #b91c1c; font-weight: 600; }\n                        \n                        .empty-day { text-align: center; padding: 14px; color: #6b7280; font-style: italic; font-size: 10px; }\n                        \n                        /* === FOOTER === */\n                        .footer { margin-top: 16px; padding-top: 10px; border-top: 1px solid #d1d5db; display: flex; justify-content: space-between; align-items: center; font-size: 9px; color: #6b7280; }\n                        .footer-left { }\n                        .footer-right { text-align: right; }\n                        \n                        @media print { \n                            body { padding: 18mm 15mm 20mm 15mm !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; } \n                            .day-block { page-break-inside: avoid; }\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class="header">\n                        <div class="company-section">\n                            <img src="${c}" class="company-logo" onerror="this.style.display='none'" />\n                            <div class="company-info">\n                                <div class="company-title">${l}</div>\n                                ${s?`<div class="company-subtitle">${s}</div>`:""}\n                            </div>\n                        </div>\n                        <div class="report-section">\n                            <div class="report-badge">Semaine ${f}</div>\n                            <div class="report-title">Planning Hebdomadaire</div>\n                            <div class="report-period">${r} ‚Äî ${i}</div>\n                            <div class="report-generated">G√©n√©r√© le ${(new Date).toLocaleString("fr-FR")}</div>\n                        </div>\n                    </div>\n                    \n                    <div class="kpi-bar">\n                        <div class="kpi-item"><div class="kpi-value">${y}</div><div class="kpi-label">√âv√©nements</div></div>\n                        <div class="kpi-item highlight"><div class="kpi-value">${v}</div><div class="kpi-label">Maintenances</div></div>\n                        <div class="kpi-item ${w>0?"alert":""}"><div class="kpi-value">${w}</div><div class="kpi-label">Priorit√© haute</div></div>\n                        <div class="kpi-item"><div class="kpi-value">${E}/7</div><div class="kpi-label">Jours actifs</div></div>\n                    </div>\n                    \n                    ${R}\n                    \n                    <div class="footer">\n                        <div class="footer-left">Document confidentiel ‚Ä¢ Ne pas diffuser</div>\n                        <div class="footer-right">${s||"Gestion Maintenance"}</div>\n                    </div>\n                </body>\n                </html>\n            `}const f=window.open("","_blank","width=1000,height=800");f.document.write(u),f.document.close(),f.focus(),setTimeout(()=>f.print(),500)}}),p&&window.TVDashboardModal&&React.createElement(window.TVDashboardModal,{isOpen:p,onClose:()=>u(!1)}))},PrintExportModal=({currentDate:e,onClose:t,onPrint:a})=>{const[n,r]=React.useState("month"),[i,l]=React.useState(()=>{const t=e||new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}),[o,s]=React.useState(()=>{const t=e||new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-01`}),[c,d]=React.useState(()=>{const t=e||new Date,a=new Date(t.getFullYear(),t.getMonth()+1,0).getDate();return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${a}`}),m=()=>{const e=new Date(o),t=new Date(c),a=Math.ceil((t-e)/864e5)+1;return a>0?a:0};return React.createElement("div",{className:"fixed inset-0 z-[200] overflow-y-auto",style:{background:"rgba(0, 0, 0, 0.5)"},onClick:t},React.createElement("div",{className:"min-h-screen px-4 py-8 flex items-center justify-center"},React.createElement("div",{className:"w-full max-w-md bg-white rounded-xl shadow-xl relative",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center"},React.createElement("div",{},React.createElement("h2",{className:"text-lg font-semibold text-gray-900"},"Exporter le planning"),React.createElement("p",{className:"text-sm text-gray-500"},"Choisissez la p√©riode √† exporter")),React.createElement("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600 transition"},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"p-6 space-y-4"},React.createElement("div",{},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"Type de p√©riode"),React.createElement("div",{className:"flex flex-wrap gap-2"},[{id:"week",label:"Semaine",icon:"fa-calendar-week",desc:"7 jours"},{id:"month",label:"Mois",icon:"fa-calendar-alt",desc:"1 mois"},{id:"quarter",label:"Trimestre",icon:"fa-calendar",desc:"3 mois"},{id:"year",label:"Ann√©e",icon:"fa-calendar-check",desc:"12 mois"},{id:"custom",label:"Personnalis√©",icon:"fa-sliders-h",desc:"Libre"}].map(e=>{const t=n===e.id;return React.createElement("button",{key:e.id,onClick:()=>r(e.id),className:"flex-1 min-w-[70px] p-2 rounded-lg border-2 text-center transition-all "+(t?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300")},React.createElement("i",{className:`fas ${e.icon} text-lg mb-1 ${t?"text-blue-600":"text-gray-400"}`}),React.createElement("div",{className:"text-xs font-medium"},e.label))}))),"custom"!==n?React.createElement("div",{},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"week"===n?"Semaine du":"quarter"===n?"Trimestre":"year"===n?"Ann√©e":"Mois"),React.createElement("input",{type:"year"===n?"number":"week"===n?"date":"month",value:"year"===n?new Date(i).getFullYear():"week"===n?i:i.substring(0,7),min:"year"===n?2020:void 0,max:"year"===n?2030:void 0,onChange:e=>{l("year"===n?`${e.target.value}-01-01`:"week"===n?e.target.value:e.target.value+"-01")},className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none text-gray-900"})):React.createElement("div",{className:"space-y-3"},React.createElement("div",{},React.createElement("label",{className:"block text-xs font-medium text-gray-500 mb-1.5"},"Raccourcis"),React.createElement("div",{className:"flex flex-wrap gap-1.5"},[{label:"7 jours",days:7},{label:"14 jours",days:14},{label:"30 jours",days:30},{label:"60 jours",days:60},{label:"90 jours",days:90}].map(e=>React.createElement("button",{key:e.days,type:"button",onClick:()=>(e=>{const t=new Date,a=new Date;a.setDate(a.getDate()+e-1),s(`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`),d(`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`)})(e.days),className:"px-2.5 py-1 text-xs font-medium rounded-full border border-gray-200 text-gray-600 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 transition"},e.label)))),React.createElement("div",{className:"grid grid-cols-2 gap-3"},React.createElement("div",{},React.createElement("label",{className:"block text-xs font-medium text-gray-500 mb-1"},"Date d√©but"),React.createElement("input",{type:"date",value:o,onChange:e=>s(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none text-gray-900 text-sm"})),React.createElement("div",{},React.createElement("label",{className:"block text-xs font-medium text-gray-500 mb-1"},"Date fin"),React.createElement("input",{type:"date",value:c,min:o,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none text-gray-900 text-sm"})))),React.createElement("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-calendar-check text-blue-500"}),React.createElement("span",{className:"text-sm text-gray-600"},"P√©riode s√©lectionn√©e")),"custom"===n&&React.createElement("span",{className:"text-xs text-gray-500"},m()+" jours")),React.createElement("p",{className:"mt-1 text-sm font-semibold text-gray-900"},(()=>{const e=new Date(i);switch(n){case"month":return e.toLocaleDateString("fr-FR",{month:"long",year:"numeric"});case"week":const t=new Date(e),a=t.getDay();t.setDate(t.getDate()-a+(0===a?-6:1));const n=new Date(t);return n.setDate(n.getDate()+6),`${t.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})} ‚Äî ${n.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}`;case"quarter":return`T${Math.floor(e.getMonth()/3)+1} ${e.getFullYear()}`;case"year":return`Ann√©e ${e.getFullYear()}`;case"custom":const r=new Date(o),i=new Date(c);return`${r.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})} ‚Äî ${i.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}`;default:return""}})()))),React.createElement("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3"},React.createElement("button",{onClick:t,className:"px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition"},"Annuler"),React.createElement("button",{onClick:()=>{"custom"===n?a(n,new Date(o),new Date(c)):a(n,new Date(i)),t()},disabled:"custom"===n&&m()<=0,className:"px-5 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition flex items-center gap-2 "+("custom"===n&&m()<=0?"opacity-50 cursor-not-allowed":"")},React.createElement("i",{className:"fas fa-print"}),"Exporter")))))},ShareModal=({onClose:e,onShare:t})=>{const[a,n]=React.useState([]),[r,i]=React.useState(""),[l,o]=React.useState(""),[s,c]=React.useState(!0),[d,m]=React.useState(!1),[g,p]=React.useState(null);return React.useEffect(()=>{axios.get("/api/messages/available-users").then(e=>{n(e.data.users||[]),c(!1)}).catch(e=>{console.error("Error fetching users:",e),p("Impossible de charger les utilisateurs"),c(!1)})},[]),React.createElement("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fadeIn"},React.createElement("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-slideUp"},React.createElement("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50"},React.createElement("h3",{className:"font-bold text-gray-800 flex items-center gap-2"},React.createElement("i",{className:"fas fa-share-alt text-blue-600"}),"Partager le planning"),React.createElement("button",{onClick:e,className:"text-gray-400 hover:text-gray-600"},React.createElement("i",{className:"fas fa-times"}))),React.createElement("form",{onSubmit:async a=>{if(a.preventDefault(),r){m(!0);try{await t(r,l),e()}catch(e){p("Erreur lors du partage"),m(!1)}}},className:"p-6"},g&&React.createElement("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-md text-sm"},g),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Destinataire"),s?React.createElement("div",{className:"text-sm text-gray-500"},"Chargement..."):React.createElement("select",{className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:r,onChange:e=>i(e.target.value),required:!0},React.createElement("option",{value:""},"-- S√©lectionner un utilisateur --"),a.map(e=>React.createElement("option",{key:e.id,value:e.id},e.full_name||e.email)))),React.createElement("div",{className:"mb-6"},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Message (optionnel)"),React.createElement("textarea",{className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",rows:3,value:l,onChange:e=>o(e.target.value),placeholder:"Je vous invite √† consulter le planning de production..."})),React.createElement("div",{className:"flex justify-end gap-3"},React.createElement("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md"},"Annuler"),React.createElement("button",{type:"submit",disabled:!r||d,className:"px-4 py-2 text-sm text-white bg-blue-600 hover:bg-blue-700 rounded-md shadow-sm flex items-center gap-2 "+(d?"opacity-70 cursor-not-allowed":"")},d&&React.createElement("i",{className:"fas fa-spinner fa-spin"}),"Envoyer l'invitation")))))};window.ProductionPlanning=ProductionPlanning;