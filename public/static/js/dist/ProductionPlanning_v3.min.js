const ProductionPlanning=({onClose:e})=>{const[t,a]=React.useState(new Date),[n,r]=React.useState("all"),[i,o]=React.useState("calendar"),[l,s]=React.useState([{id:"prod",label:"Production",icon:"fa-industry",color:"blue"},{id:"maint",label:"Maintenance",icon:"fa-tools",color:"orange"},{id:"log",label:"Logistique",icon:"fa-truck",color:"purple"},{id:"qual",label:"Qualit√©",icon:"fa-clipboard-check",color:"green"},{id:"sst",label:"SST / S√©curit√©",icon:"fa-hard-hat",color:"red"},{id:"admin",label:"Admin / RH",icon:"fa-users",color:"gray"}]),[c,d]=React.useState(!1),[m,p]=React.useState(null),[g,u]=React.useState([]),[b,f]=React.useState([]),[x,h]=React.useState(!1),v=()=>{h(!0),axios.get("/api/planning?t="+Date.now()).then(e=>{const t=e.data;t.categories&&Array.isArray(t.categories)&&t.categories.length>0&&s(t.categories),t.events&&u(t.events),t.notes&&f(t.notes)}).catch(e=>{console.error("Error loading planning data:",e)}).finally(()=>{h(!1)})};React.useEffect(()=>{v()},[]);const y=(e,t)=>{const a=l.find(t=>t.id===e),n={blue:"bg-blue-50 text-blue-900 border-blue-600",green:"bg-green-50 text-green-900 border-green-600",red:"bg-red-50 text-red-900 border-red-600",yellow:"bg-yellow-50 text-yellow-900 border-yellow-500",purple:"bg-purple-50 text-purple-900 border-purple-600",orange:"bg-orange-50 text-orange-900 border-orange-600",gray:"bg-gray-100 text-gray-800 border-gray-400"},r=n[a?a.color:"gray"]||n.gray;return"tentative"===t?`${r} border-dashed opacity-80 border-l-4`:`${r} border-solid border-l-4`},w=e=>{const t=l.find(t=>t.id===e);return t?t.icon:"fa-circle"},[R,E]=React.useState(null),[k,N]=React.useState(!1),[$,D]=React.useState(!1),[S,z]=React.useState(!1),[C,j]=React.useState("month"),[_,M]=React.useState(null),[P,A]=React.useState("undefined"!=typeof Notification?Notification.permission:"default");React.useEffect(()=>{if("granted"!==P)return;const e=setInterval(()=>{const e=new Date,t=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;f(e=>{let a=!1;const n=e.map(e=>e.done||e.notified||e.time!==t?e:(new Notification("Rappel IGP Production",{body:e.text,icon:"https://cdn-icons-png.flaticon.com/512/1028/1028918.png"}),a=!0,{...e,notified:!0}));return a?n:e})},3e4);return()=>clearInterval(e)},[P]);const T=(e,t)=>{f(a=>a.map(a=>a.id===e?{...a,...t}:a)),axios.put(`/api/planning/notes/${e}`,t).then(t=>{t.data.note&&f(a=>a.map(a=>a.id===e?t.data.note:a))}).catch(a=>{console.error("Error updating note:",a),alert("Erreur lors de la mise √† jour : "+(a.response?.data?.error||a.message)),f(a=>a.map(a=>a.id===e?{...a,is_dashboard:!t.is_dashboard}:a))})},[I,F]=React.useState(!1),[L,O]=React.useState(null),[Y,q]=React.useState(""),G=(e,t)=>{e.stopPropagation(),O(t),q(t.date),F(!0)},H=e=>{e.target.style.opacity="1",E(null)},B=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},U=t.getFullYear(),V=t.getMonth(),Q=new Date(U,V+1,0).getDate(),J=Array.from({length:Q},(e,t)=>{const a=t+1,n=new Date(U,V,a);return{num:a,dateStr:`${U}-${String(V+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,dayOfWeek:n.getDay()}});return React.createElement("div",{className:"fixed inset-0 z-[150] bg-gray-100 flex flex-col animate-fadeIn"},React.createElement("div",{className:"bg-white border-b p-3 lg:px-6 lg:py-3 flex flex-col md:flex-row justify-between items-start md:items-center gap-3 md:gap-0 shadow-sm z-20 shrink-0"},React.createElement("div",{className:"flex-1 min-w-0 w-full md:w-auto"},React.createElement("h1",{className:"text-lg lg:text-2xl font-bold text-slate-800 flex items-center gap-2 lg:gap-3 truncate"},React.createElement("div",{className:"bg-blue-600 text-white w-8 h-8 rounded-lg flex items-center justify-center shadow-sm shrink-0"},React.createElement("i",{className:"far fa-calendar-alt text-lg"})),React.createElement("span",{className:"truncate"},"Planning & Production")),React.createElement("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-1"},React.createElement("span",null,window.APP_COMPANY_NAME||"Entreprise"),React.createElement("i",{className:"fas fa-circle text-[4px] text-slate-300"}),React.createElement("span",null,"Vue Directeur"))),React.createElement("div",{className:"flex items-center justify-between md:justify-end gap-2 w-full md:w-auto"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("button",{onClick:()=>d(!0),className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition shadow-sm"},React.createElement("i",{className:"fas fa-cog"})),React.createElement("button",{onClick:()=>N(!k),className:"lg:hidden w-10 h-10 flex items-center justify-center rounded-lg transition "+(k?"bg-yellow-100 text-yellow-600":"bg-gray-100 text-gray-500")},React.createElement("i",{className:"fas fa-sticky-note"}))),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("button",{onClick:v,title:"Rafra√Æchir les donn√©es",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition shadow-sm"},React.createElement("i",{className:"fas fa-sync-alt "+(x?"fa-spin text-blue-600":"")})),React.createElement("button",{onClick:()=>D(!0),title:"Partager le planning",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-blue-50 hover:text-blue-600 transition shadow-sm"},React.createElement("i",{className:"fas fa-share-alt"})),React.createElement("button",{onClick:()=>{M(new Date(t)),z(!0)},title:"Imprimer le planning (PDF)",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-green-50 hover:text-green-600 transition shadow-sm"},React.createElement("i",{className:"fas fa-print"})),React.createElement("button",{onClick:()=>o("calendar"===i?"list":"calendar"),title:"calendar"===i?"Passer en vue TV / Liste":"Passer en vue Calendrier",className:"w-10 h-10 flex items-center justify-center rounded-lg border transition shadow-sm "+("list"===i?"bg-slate-800 text-white border-slate-900":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50")},React.createElement("i",{className:"calendar"===i?"fas fa-tv":"fas fa-calendar-alt"})),React.createElement("button",{onClick:()=>window.open("/admin/tv","_blank"),title:"Configuration √©cran TV",className:"w-10 h-10 flex items-center justify-center rounded-lg border transition shadow-sm bg-white border-slate-200 text-purple-600 hover:bg-purple-50 hover:border-purple-300"},React.createElement("i",{className:"fas fa-desktop"})),React.createElement("button",{onClick:()=>{const e=new Date,a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(Math.max(1,Math.min(e.getDate(),Q))).padStart(2,"0")}`;q(a),O(null),F(!0)},className:"flex px-3 lg:px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md transition font-semibold items-center gap-2"},React.createElement("i",{className:"fas fa-plus"}),React.createElement("span",{className:"hidden sm:inline"},"Nouvel √âv√©nement")),React.createElement("div",{className:"h-8 w-px bg-gray-200 mx-1 hidden md:block"}),React.createElement("button",{onClick:e,className:"bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg font-medium transition shadow-sm"},"Fermer")))),React.createElement("div",{className:"bg-white border-b py-2 px-2 lg:px-6 flex flex-col lg:flex-row gap-3 lg:gap-4 items-stretch lg:items-center shadow-sm z-10 shrink-0"},React.createElement("div",{className:"flex items-center overflow-hidden w-full lg:w-auto min-w-0"},React.createElement("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mr-2 shrink-0 hidden lg:inline"},"Filtres :"),React.createElement("div",{className:"flex overflow-x-auto gap-2 items-center pb-2 lg:pb-0 w-full no-scrollbar mask-linear-fade",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"}},React.createElement("button",{onClick:()=>r("all"),className:"px-4 py-2 rounded-full text-sm font-bold transition-all duration-200 border whitespace-nowrap flex-shrink-0 "+("all"===n?"bg-slate-800 text-white border-slate-900 shadow-md transform scale-105":"bg-white text-slate-600 border-slate-300 hover:border-slate-400 shadow-sm")},"Tout Voir"),0===l.length?React.createElement("span",{className:"text-xs text-gray-400 italic whitespace-nowrap px-2"},"Aucune cat√©gorie"):null,l.map(e=>{const t={blue:n===e.id?"bg-blue-600 text-white border-blue-700 shadow-md transform scale-105":"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100",green:n===e.id?"bg-green-600 text-white border-green-700 shadow-md transform scale-105":"bg-green-50 text-green-700 border-green-200 hover:bg-green-100",red:n===e.id?"bg-red-600 text-white border-red-700 shadow-md transform scale-105":"bg-red-50 text-red-700 border-red-200 hover:bg-red-100",yellow:n===e.id?"bg-yellow-500 text-white border-yellow-600 shadow-md transform scale-105":"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-100",purple:n===e.id?"bg-purple-600 text-white border-purple-700 shadow-md transform scale-105":"bg-purple-50 text-purple-700 border-purple-200 hover:bg-purple-100",orange:n===e.id?"bg-orange-600 text-white border-orange-700 shadow-md transform scale-105":"bg-orange-50 text-orange-800 border-orange-200 hover:bg-orange-100",gray:n===e.id?"bg-gray-600 text-white border-gray-700 shadow-md transform scale-105":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"},a=t[e.color]||t.gray;return React.createElement("button",{key:e.id,onClick:()=>r(e.id),className:`px-4 py-2 rounded-full text-sm font-bold transition-all duration-200 flex items-center gap-2 border whitespace-nowrap flex-shrink-0 ${a}`},React.createElement("i",{className:`fas ${e.icon} ${n===e.id?"text-white":""} text-sm`}),e.label)}))),React.createElement("div",{className:"flex justify-center lg:justify-end lg:ml-auto shrink-0"},React.createElement("div",{className:"flex bg-gray-100 rounded-lg p-1 shadow-inner"},React.createElement("button",{onClick:()=>{a(new Date(t.getFullYear(),t.getMonth()-1,1))},className:"w-10 h-8 flex items-center justify-center bg-white shadow-sm rounded text-slate-700 hover:bg-slate-50 active:scale-95 transition"},React.createElement("i",{className:"fas fa-chevron-left"})),React.createElement("span",{className:"px-4 flex items-center justify-center font-bold text-slate-700 text-sm whitespace-nowrap capitalize w-36"},t.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})),React.createElement("button",{onClick:()=>{a(new Date(t.getFullYear(),t.getMonth()+1,1))},className:"w-10 h-8 flex items-center justify-center bg-white shadow-sm rounded text-slate-700 hover:bg-slate-50 active:scale-95 transition"},React.createElement("i",{className:"fas fa-chevron-right"}))))),React.createElement("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden relative"},"list"===i?React.createElement("div",{className:"flex-1 flex flex-col bg-slate-50 lg:border-r border-gray-200 overflow-y-auto p-4 lg:p-8"},React.createElement("div",{className:"max-w-5xl mx-auto w-full space-y-8"},(()=>{const e=g.filter(e=>{const a=new Date(e.date);return a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()&&("all"===n||e.type===n)}).sort((e,t)=>new Date(e.date)-new Date(t.date));if(0===e.length)return React.createElement("div",{className:"text-center py-20 text-gray-400"},React.createElement("i",{className:"fas fa-calendar-times text-6xl mb-4 opacity-50"}),React.createElement("p",{className:"text-xl font-medium"},"Aucun √©v√©nement pour ce mois"));const a=e.reduce((e,t)=>(e[t.date]||(e[t.date]=[]),e[t.date].push(t),e),{});return Object.keys(a).map(e=>{const t=new Date(e),n=t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"});return React.createElement("div",{key:e,className:"animate-slideIn"},React.createElement("h3",{className:"text-2xl font-bold text-slate-800 mb-4 capitalize flex items-center gap-3 border-b border-slate-200 pb-2"},React.createElement("span",{className:"text-blue-600"},t.getDate()),n),React.createElement("div",{className:"grid gap-4"},a[e].map(e=>{const t=l.find(t=>t.id===e.type),a=y(e.type,e.status);return React.createElement("div",{key:e.id,onClick:t=>G(t,e),className:`bg-white rounded-xl shadow-sm border-l-8 p-6 cursor-pointer hover:shadow-lg transition-all ${a.replace("border-l-4","border-l-8")}`},React.createElement("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center gap-3 mb-2"},React.createElement("span",{className:"px-3 py-1 rounded-full text-sm font-bold uppercase tracking-wider flex items-center gap-2 w-fit "+("blue"===t?.color?"bg-blue-100 text-blue-800":"green"===t?.color?"bg-green-100 text-green-800":"red"===t?.color?"bg-red-100 text-red-800":"yellow"===t?.color?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800")},React.createElement("i",{className:`fas ${t?.icon||"fa-circle"}`}),t?.label||"Autre"),"tentative"===e.status&&React.createElement("span",{className:"text-amber-500 font-bold text-sm flex items-center gap-1"},React.createElement("i",{className:"fas fa-question-circle"}),"√Ä confirmer")),React.createElement("h4",{className:"text-2xl font-bold text-slate-900 mb-2 leading-snug flex items-center gap-2"},e.time&&React.createElement("span",{className:"text-lg font-mono font-normal text-slate-500 bg-slate-100 px-2 py-0.5 rounded"},e.time),e.title),e.details&&React.createElement("div",{className:"text-lg text-slate-600 leading-relaxed bg-slate-50 p-4 rounded-lg border border-slate-100 mt-2"},e.details.split("\n").map((e,t)=>React.createElement("p",{key:t,className:"mb-1 last:mb-0"},e)))),React.createElement("div",{className:"flex items-center gap-2 md:flex-col shrink-0"},React.createElement("button",{className:"w-12 h-12 flex items-center justify-center rounded-full bg-slate-100 text-slate-400 hover:bg-blue-50 hover:text-blue-600 transition"},React.createElement("i",{className:"fas fa-pen text-xl"})))))})))})})())):React.createElement("div",{className:"flex-1 flex flex-col bg-slate-50 lg:border-r border-gray-200 overflow-hidden"},React.createElement("div",{className:"hidden lg:grid grid-cols-7 border-b bg-white shadow-sm"},["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"].map(e=>React.createElement("div",{key:e,className:"py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider"},e))),React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-7 flex-1 overflow-y-auto p-3 lg:p-4 gap-3 lg:gap-4 pb-20 lg:pb-4"},Array.from({length:new Date(U,V,1).getDay()}).map((e,t)=>React.createElement("div",{key:`empty-${t}`,className:"hidden lg:block bg-transparent"})),J.map((e,a)=>{const r=(i=e.dateStr,g.filter(e=>e.date===i&&("all"===n||e.type==n)));var i;return React.createElement("div",{key:e.dateStr,onDragOver:B,onDrop:t=>((e,t)=>{e.preventDefault(),R&&t&&(u(e=>e.map(e=>e.id===R?{...e,date:t}:e)),axios.put(`/api/planning/events/${R}`,{date:t}).catch(e=>console.error("Error moving event:",e)))})(t,e.dateStr),className:"rounded-xl border bg-white border-slate-200 hover:shadow-md hover:border-blue-300 p-3 flex flex-col gap-2 relative transition-all group min-h-[140px]"},React.createElement("div",{className:"flex justify-between items-start mb-1"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"text-lg font-bold w-8 h-8 flex items-center justify-center rounded-full "+(e.num===(new Date).getDate()&&t.getMonth()===(new Date).getMonth()?"bg-blue-600 text-white shadow-md":"text-slate-700 bg-slate-100")},e.num),React.createElement("span",{className:"lg:hidden text-sm font-bold text-slate-500 uppercase"},["Dim","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Sam"][e.dayOfWeek])),React.createElement("div",{className:"flex items-center gap-1"},r.length>0&&React.createElement("span",{className:"text-[10px] font-bold text-slate-500 bg-slate-100 border border-slate-200 px-1.5 py-0.5 rounded-md"},`${r.length}`),React.createElement("button",{onClick:()=>{O(null),q(e.dateStr),F(!0)},className:"opacity-100 lg:opacity-0 lg:group-hover:opacity-100 text-slate-400 hover:text-blue-600 transition p-1"},React.createElement("i",{className:"fas fa-plus-circle text-lg"})))),React.createElement("div",{className:"flex-1 overflow-y-auto space-y-1 custom-scrollbar"},r.map((e,t)=>React.createElement("div",{key:e.id||t,draggable:!0,onClick:t=>G(t,e),onDragStart:t=>((e,t)=>{E(t),e.dataTransfer.effectAllowed="move",e.target.style.opacity="0.5"})(t,e.id),onDragEnd:H,className:`text-xs p-2 rounded-lg shadow-sm cursor-pointer hover:scale-[1.02] transition-transform border border-transparent ${y(e.type,e.status)}`,title:"Cliquez pour modifier"},React.createElement("div",{className:"flex items-center justify-between mb-0.5"},React.createElement("div",{className:"flex items-center gap-1.5"},React.createElement("i",{className:`fas ${w(e.type)}`}),React.createElement("span",{className:"font-bold truncate max-w-[80px]"},l.find(t=>t.id===e.type)?.label||"Autre")),"tentative"===e.status&&React.createElement("i",{className:"fas fa-question-circle opacity-50"})),React.createElement("div",{className:"truncate font-medium leading-tight"},e.time&&React.createElement("span",{className:"mr-1 font-mono text-[10px] opacity-75 bg-white/50 px-1 rounded"},e.time),e.title),e.details&&React.createElement("div",{className:"text-[10px] opacity-75 truncate mt-0.5"},e.details)))))}))),"calendar"===i?React.createElement(window.PlanningNotes,{notes:b,showMobile:k,onCloseMobile:()=>N(!1),onAdd:e=>{e.preventDefault();const t=new FormData(e.target),a=t.get("text"),n=t.get("time"),r=t.get("date"),i="on"===t.get("is_dashboard");if(!a)return;const o={id:Date.now(),text:a,time:n,date:r,done:!1,priority:"medium",notified:!1,is_dashboard:i};f(e=>[...e,o]),axios.post("/api/planning/notes",o).then(e=>{const t=e.data;f(e=>e.map(e=>e.id===o.id?t:e))}).catch(e=>{console.error("Error adding note:",e),alert("Erreur lors de l'ajout : "+(e.response?.data?.error||e.message)),f(e=>e.filter(e=>e.id!==o.id))}),e.target.reset()},onUpdate:T,onToggle:e=>{const t=b.find(t=>t.id===e);t&&T(e,{done:!t.done})},onDelete:e=>{f(b.filter(t=>t.id!==e)),axios.delete(`/api/planning/notes/${e}`).catch(e=>console.error("Error deleting note:",e))},notificationPerm:P,onRequestPerm:()=>{"Notification"in window?Notification.requestPermission().then(e=>{A(e),"granted"===e&&new Notification("Notifications activ√©es",{body:"Vous recevrez d√©sormais des alertes pour vos t√¢ches.",icon:"/favicon.ico"})}):alert("Ce navigateur ne supporte pas les notifications desktop")}}):null),React.createElement(window.PlanningModals,{showAddModal:I,setShowAddModal:F,selectedEvent:L,newEventDate:Y,categories:l,onSaveEvent:e=>{e.preventDefault();const t=new FormData(e.target),a=t.get("date"),n="on"===t.get("show_on_tv"),r="on"===t.get("is_popup"),i=t.get("image_url"),o=t.get("display_duration");if(L){const e={date:a,time:t.get("time"),type:t.get("type"),title:t.get("title"),details:t.get("details"),show_on_tv:n,is_popup:r,image_url:i,display_duration:o?parseInt(o):15};u(t=>t.map(t=>t.id===L.id?{...t,...e}:t)),axios.put(`/api/planning/events/${L.id}`,e).catch(e=>console.error("Error updating event:",e))}else{const e={id:Date.now(),date:a,time:t.get("time"),type:t.get("type"),status:"confirmed",title:t.get("title"),details:t.get("details"),show_on_tv:n,is_popup:r,image_url:i,display_duration:o?parseInt(o):15};u([...g,e]),axios.post("/api/planning/events",e).then(t=>{const a=t.data;u(t=>t.map(t=>t.id===e.id?a:t))}).catch(e=>console.error("Error creating event:",e))}F(!1),O(null)},onDeleteEvent:()=>{L&&(u(e=>e.filter(e=>e.id!==L.id)),axios.delete(`/api/planning/events/${L.id}`).catch(e=>console.error("Error deleting event:",e)),F(!1),O(null))},showCategoryModal:c,setShowCategoryModal:d,editingCategory:m,onEditCategoryClick:e=>{p(e)},onCancelEditCategory:()=>{p(null)},onDeleteCategory:e=>{confirm("Supprimer cette cat√©gorie ? Les √©v√©nements existants perdront leur style.")&&(s(l.filter(t=>t.id!==e)),m&&m.id===e&&p(null),axios.delete(`/api/planning/categories/${e}`).catch(e=>console.error("Error deleting category:",e)))},onSaveCategory:e=>{e.preventDefault();const t=new FormData(e.target);if(m){const e={label:t.get("label"),color:t.get("color"),icon:t.get("icon")};s(l.map(t=>t.id===m.id?{...t,...e}:t)),p(null),axios.put(`/api/planning/categories/${m.id}`,e).catch(e=>console.error("Error updating category:",e))}else{const e={id:"cat_"+Date.now(),label:t.get("label"),color:t.get("color"),icon:t.get("icon")};s([...l,e]),axios.post("/api/planning/categories",e).catch(e=>console.error("Error creating category:",e))}e.target.reset()}}),$&&React.createElement(ShareModal,{onClose:()=>D(!1),onShare:async(e,t)=>{try{await axios.post("/api/planning/share",{targetUserId:e,message:t}),alert("Invitation envoy√©e avec succ√®s !")}catch(e){throw console.error(e),alert("Erreur lors de l'envoi : "+(e.response?.data?.error||e.message)),e}}}),S&&React.createElement(PrintExportModal,{currentDate:t,onClose:()=>z(!1),onPrint:async(e,a)=>{z(!1);const n=a||_||t,r=n.getFullYear(),i=n.getMonth();let o="Syst√®me de Maintenance",s="",c="";try{const[e,t]=await Promise.all([axios.get("/api/settings/company_title").catch(()=>null),axios.get("/api/settings/company_subtitle").catch(()=>null)]);e?.data?.value&&(o=e.data.value),t?.data?.value&&(s=t.data.value),c="/api/settings/logo?t="+Date.now()}catch(e){}let d=[];try{const e=await axios.get("/api/tickets?status=assigned,in_progress,diagnostic,waiting_parts,received");e?.data?.tickets&&(d=e.data.tickets.filter(e=>e.scheduled_date))}catch(e){}const m={blue:{bg:"#dbeafe",border:"#3b82f6",text:"#1e40af"},green:{bg:"#dcfce7",border:"#22c55e",text:"#166534"},red:{bg:"#fee2e2",border:"#ef4444",text:"#991b1b"},yellow:{bg:"#fef9c3",border:"#eab308",text:"#854d0e"},purple:{bg:"#f3e8ff",border:"#a855f7",text:"#6b21a8"},orange:{bg:"#ffedd5",border:"#f97316",text:"#9a3412"},gray:{bg:"#f3f4f6",border:"#6b7280",text:"#374151"}},p={critical:"#dc2626",high:"#ea580c",medium:"#ca8a04",low:"#16a34a"},u={critical:"CRITIQUE",high:"HAUTE",medium:"MOYENNE",low:"BASSE"};let b="";if("month"===e){const e=n.toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),t=new Date(r,i+1,0).getDate(),a=g.filter(e=>{const t=new Date(e.date);return t.getMonth()===i&&t.getFullYear()===r}).sort((e,t)=>new Date(e.date)-new Date(t.date)),f=d.filter(e=>{const t=new Date(e.scheduled_date);return t.getMonth()===i&&t.getFullYear()===r}).sort((e,t)=>new Date(e.scheduled_date)-new Date(t.scheduled_date)),x={};for(let e=1;e<=t;e++){const t=`${r}-${String(i+1).padStart(2,"0")}-${String(e).padStart(2,"0")}`,n=new Date(r,i,e),o=a.filter(e=>e.date===t),l=f.filter(t=>new Date(t.scheduled_date).getDate()===e);(o.length>0||l.length>0)&&(x[e]={date:n,events:o,tickets:l})}const h=a.length,v=f.length,y=f.filter(e=>"critical"===e.priority||"high"===e.priority).length,w=l.map(e=>({...e,count:a.filter(t=>t.type===e.id).length})).filter(e=>e.count>0);let R="";Object.keys(x).forEach(e=>{const t=x[e],a=t.date.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),n=0===t.date.getDay()||6===t.date.getDay();let r="";t.events.forEach(e=>{const t=l.find(t=>t.id===e.type),a=m[t?.color]||m.gray;r+=`\n                        <div class="timeline-event" style="border-left-color: ${a.border}; background: ${a.bg};">\n                            <div class="event-header">\n                                <span class="event-time">${e.time||"‚Äî"}</span>\n                                <span class="event-category" style="color: ${a.text};">${t?.label||e.type}</span>\n                                <span class="event-status ${e.status}">${"tentative"===e.status?"‚è≥":"‚úÖ"}</span>\n                            </div>\n                            <div class="event-title">${e.title}</div>\n                            ${e.details?`<div class="event-details">${e.details}</div>`:""}\n                        </div>\n                    `}),t.tickets.forEach(e=>{const t=new Date(e.scheduled_date),a=t.getHours()?t.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"‚Äî";r+=`\n                        <div class="timeline-ticket">\n                            <div class="ticket-header">\n                                <span class="ticket-time">${a}</span>\n                                <span class="ticket-priority" style="color: ${p[e.priority]||"#374151"};">${u[e.priority]||e.priority}</span>\n                                <span class="ticket-id">#${e.ticket_id}</span>\n                            </div>\n                            <div class="ticket-title">üîß ${e.title}</div>\n                            <div class="ticket-meta">\n                                ${e.assignee_name?`<span>üë§ ${e.assignee_name}</span>`:'<span class="unassigned">‚ö†Ô∏è Non assign√©</span>'}\n                                ${e.machine_name?`<span>üè≠ ${e.machine_name}</span>`:""}\n                            </div>\n                        </div>\n                    `});const i=t.events.length+t.tickets.length;R+=`\n                    <div class="timeline-day ${n?"weekend":""}">\n                        <div class="day-header">\n                            <span class="day-date">${a}</span>\n                            <span class="day-count">${i} √©l√©ment${i>1?"s":""}</span>\n                        </div>\n                        <div class="day-items">${r}</div>\n                    </div>\n                `}),0===Object.keys(x).length&&(R='<div class="no-data">Aucun √©v√©nement ou maintenance planifi√© ce mois</div>'),b=`\n                <html>\n                <head>\n                    <title>Planning Mensuel - ${e}</title>\n                    <style>\n                        @page { size: A4; margin: 0; }\n                        * { box-sizing: border-box; margin: 0; padding: 0; }\n                        body { font-family: 'Segoe UI', -apple-system, Arial, sans-serif; padding: 18mm 15mm 20mm 15mm; font-size: 11px; color: #1a1a1a; line-height: 1.4; }\n                        \n                        /* === HEADER === */\n                        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 14px; margin-bottom: 16px; border-bottom: 2px solid #d1d5db; }\n                        .company-section { display: flex; align-items: center; gap: 12px; }\n                        .company-logo { max-height: 40px; max-width: 90px; }\n                        .company-info { }\n                        .company-title { font-size: 15px; font-weight: 700; color: #111827; }\n                        .company-subtitle { font-size: 10px; color: #4b5563; margin-top: 2px; }\n                        .report-section { text-align: right; }\n                        .report-badge { display: inline-block; background: #1e40af; color: white; font-size: 9px; font-weight: 600; padding: 3px 8px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }\n                        .report-title { font-size: 13px; font-weight: 700; color: #111827; text-transform: capitalize; }\n                        .report-generated { font-size: 9px; color: #6b7280; margin-top: 3px; }\n                        \n                        /* === KPI BAR === */\n                        .kpi-bar { display: flex; gap: 0; margin-bottom: 16px; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; }\n                        .kpi-item { flex: 1; text-align: center; padding: 10px 6px; border-right: 1px solid #d1d5db; background: #f9fafb; }\n                        .kpi-item:last-child { border-right: none; }\n                        .kpi-value { font-size: 20px; font-weight: 700; color: #111827; }\n                        .kpi-label { font-size: 8px; color: #4b5563; text-transform: uppercase; letter-spacing: 0.3px; margin-top: 2px; }\n                        .kpi-item.highlight { background: #fef3c7; }\n                        .kpi-item.highlight .kpi-value { color: #92400e; }\n                        .kpi-item.alert .kpi-value { color: #b91c1c; }\n                        \n                        /* === CATEGORY BAR === */\n                        .category-bar { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; }\n                        .cat-badge { padding: 3px 8px; border-radius: 12px; font-size: 9px; font-weight: 600; }\n                        \n                        /* === TIMELINE DAYS === */\n                        .timeline-day { margin-bottom: 10px; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; page-break-inside: avoid; }\n                        .timeline-day.weekend { opacity: 0.75; }\n                        .day-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #f3f4f6; border-bottom: 1px solid #d1d5db; }\n                        .day-date { font-weight: 600; font-size: 11px; color: #111827; text-transform: capitalize; }\n                        .day-count { font-size: 9px; color: #4b5563; }\n                        .day-items { padding: 8px 12px; background: white; }\n                        \n                        /* === TIMELINE ITEMS === */\n                        .timeline-event { display: flex; gap: 10px; padding: 8px 10px; margin-bottom: 6px; border-radius: 4px; border-left: 3px solid #d1d5db; background: #f9fafb; }\n                        .timeline-event:last-child { margin-bottom: 0; }\n                        .event-header { display: flex; gap: 8px; align-items: center; margin-bottom: 3px; font-size: 9px; }\n                        .event-time { font-weight: 600; color: #374151; min-width: 42px; }\n                        .event-category { font-weight: 600; }\n                        .event-status { margin-left: auto; font-size: 9px; color: #4b5563; }\n                        .event-title { font-weight: 600; font-size: 11px; color: #111827; }\n                        .event-details { font-size: 9px; color: #4b5563; margin-top: 2px; }\n                        \n                        .timeline-ticket { display: flex; gap: 10px; padding: 8px 10px; margin-bottom: 6px; border-left: 3px solid #d97706; background: #fffbeb; border-radius: 4px; }\n                        .timeline-ticket:last-child { margin-bottom: 0; }\n                        .ticket-header { display: flex; gap: 8px; align-items: center; margin-bottom: 3px; font-size: 9px; }\n                        .ticket-time { font-weight: 600; color: #374151; min-width: 42px; }\n                        .ticket-priority { font-weight: 700; font-size: 8px; background: currentColor; color: white; padding: 2px 6px; border-radius: 8px; }\n                        .ticket-id { margin-left: auto; color: #4b5563; font-size: 9px; }\n                        .ticket-title { font-weight: 600; font-size: 11px; color: #78350f; }\n                        .ticket-meta { display: flex; gap: 10px; font-size: 9px; color: #57534e; margin-top: 4px; }\n                        .ticket-meta .unassigned { color: #b91c1c; font-weight: 600; }\n                        \n                        .no-data { text-align: center; padding: 30px; color: #6b7280; font-style: italic; background: #f9fafb; border-radius: 6px; border: 1px solid #d1d5db; }\n                        \n                        /* === FOOTER === */\n                        .footer { margin-top: 16px; padding-top: 10px; border-top: 1px solid #d1d5db; display: flex; justify-content: space-between; align-items: center; font-size: 9px; color: #6b7280; }\n                        \n                        @media print { \n                            body { padding: 18mm 15mm 20mm 15mm !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; } \n                            .timeline-day { page-break-inside: avoid; } \n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class="header">\n                        <div class="company-section">\n                            <img src="${c}" class="company-logo" onerror="this.style.display='none'" />\n                            <div class="company-info">\n                                <div class="company-title">${o}</div>\n                                ${s?`<div class="company-subtitle">${s}</div>`:""}\n                            </div>\n                        </div>\n                        <div class="report-section">\n                            <div class="report-badge">Vue Mensuelle</div>\n                            <div class="report-title">${e}</div>\n                            <div class="report-generated">G√©n√©r√© le ${(new Date).toLocaleString("fr-FR")}</div>\n                        </div>\n                    </div>\n                    \n                    <div class="kpi-bar">\n                        <div class="kpi-item"><div class="kpi-value">${h}</div><div class="kpi-label">√âv√©nements</div></div>\n                        <div class="kpi-item highlight"><div class="kpi-value">${v}</div><div class="kpi-label">Maintenances</div></div>\n                        <div class="kpi-item ${y>0?"alert":""}"><div class="kpi-value">${y}</div><div class="kpi-label">Priorit√© haute</div></div>\n                        <div class="kpi-item"><div class="kpi-value">${Object.keys(x).length}</div><div class="kpi-label">Jours actifs</div></div>\n                    </div>\n                    \n                    ${w.length>0?`<div class="category-bar">${w.map(e=>{const t=m[e.color]||m.gray;return`<span class="cat-badge" style="background: ${t.bg}; color: ${t.text}; border: 1px solid ${t.border};">${e.label}: ${e.count}</span>`}).join("")}</div>`:""}\n                    \n                    ${R}\n                    \n                    <div class="footer">\n                        <span>Document confidentiel ‚Ä¢ Ne pas diffuser</span>\n                        <span>${s||"Gestion Maintenance"}</span>\n                    </div>\n                </body>\n                </html>\n            `}else if("week"===e){const e=new Date(n),t=e.getDay();e.setDate(e.getDate()-t+(0===t?-6:1));const a=[];for(let t=0;t<7;t++){const n=new Date(e);n.setDate(n.getDate()+t),a.push(n)}const r=a[0].toLocaleDateString("fr-FR",{day:"numeric",month:"long"}),i=a[6].toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),f=Math.ceil(((e-new Date(e.getFullYear(),0,1))/864e5+1)/7);let x=[],h=[];a.forEach(e=>{const t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,a=g.filter(e=>e.date===t),n=d.filter(t=>new Date(t.scheduled_date).toDateString()===e.toDateString());x.push(...a),h.push(...n)});const v=x.length,y=h.length,w=h.filter(e=>"critical"===e.priority||"high"===e.priority).length,R=a.filter(e=>{const t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;return g.some(e=>e.date===t)||d.some(t=>new Date(t.scheduled_date).toDateString()===e.toDateString())}).length;let E="";a.forEach((e,t)=>{const a=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,n=g.filter(e=>e.date===a).sort((e,t)=>(e.time||"").localeCompare(t.time||"")),r=d.filter(t=>new Date(t.scheduled_date).toDateString()===e.toDateString()).sort((e,t)=>new Date(e.scheduled_date)-new Date(t.scheduled_date)),i=e.toDateString()===(new Date).toDateString(),o=t>=5,s=e.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),c=n.length+r.length;let b="";n.forEach(e=>{const t=l.find(t=>t.id===e.type),a=m[t?.color]||m.gray;b+=`\n                        <div class="timeline-item event-item" style="border-left-color: ${a.border}; background: ${a.bg};">\n                            <div class="item-time">${e.time||"‚Äî"}</div>\n                            <div class="item-content">\n                                <div class="item-header">\n                                    <span class="item-category" style="color: ${a.text};">${t?.label||e.type}</span>\n                                    <span class="item-status">${"tentative"===e.status?"‚è≥ Provisoire":"‚úì Confirm√©"}</span>\n                                </div>\n                                <div class="item-title">${e.title}</div>\n                                ${e.details?`<div class="item-details">${e.details}</div>`:""}\n                            </div>\n                        </div>\n                    `}),r.forEach(e=>{const t=new Date(e.scheduled_date),a=t.getHours()?t.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"‚Äî";b+=`\n                        <div class="timeline-item ticket-item">\n                            <div class="item-time">${a}</div>\n                            <div class="item-content">\n                                <div class="item-header">\n                                    <span class="item-priority" style="background: ${p[e.priority]||"#6b7280"};">${u[e.priority]||"N/A"}</span>\n                                    <span class="item-ticket-id">#${e.ticket_id}</span>\n                                </div>\n                                <div class="item-title">${e.title}</div>\n                                <div class="item-meta">\n                                    ${e.assignee_name?`<span class="meta-assignee">üë§ ${e.assignee_name}</span>`:'<span class="meta-unassigned">‚ö† Non assign√©</span>'}\n                                    ${e.machine_name?`<span class="meta-machine">‚öô ${e.machine_name}</span>`:""}\n                                </div>\n                            </div>\n                        </div>\n                    `}),b||(b=`<div class="empty-day">${o?"Week-end":"Aucune activit√© planifi√©e"}</div>`),E+=`\n                    <div class="day-block ${i?"today":""} ${o?"weekend":""} ${0===c?"empty":""}">\n                        <div class="day-header">\n                            <div class="day-label">\n                                <span class="day-name">${s}</span>\n                                ${i?'<span class="today-badge">Aujourd\'hui</span>':""}\n                            </div>\n                            <span class="day-count">${c>0?c+" √©l√©ment"+(c>1?"s":""):""}</span>\n                        </div>\n                        <div class="day-content">${b}</div>\n                    </div>\n                `}),b=`\n                <html>\n                <head>\n                    <title>Planning Semaine ${f} - ${r} au ${i}</title>\n                    <style>\n                        @page { size: A4; margin: 0; }\n                        * { box-sizing: border-box; margin: 0; padding: 0; }\n                        body { font-family: 'Segoe UI', -apple-system, Arial, sans-serif; padding: 18mm 15mm 20mm 15mm; font-size: 11px; color: #1a1a1a; line-height: 1.4; }\n                        \n                        /* === HEADER === */\n                        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 14px; margin-bottom: 16px; border-bottom: 2px solid #d1d5db; }\n                        .company-section { display: flex; align-items: center; gap: 12px; }\n                        .company-logo { max-height: 40px; max-width: 90px; }\n                        .company-info { }\n                        .company-title { font-size: 15px; font-weight: 700; color: #111827; }\n                        .company-subtitle { font-size: 10px; color: #4b5563; margin-top: 2px; }\n                        .report-section { text-align: right; }\n                        .report-badge { display: inline-block; background: #1e40af; color: white; font-size: 9px; font-weight: 600; padding: 3px 8px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }\n                        .report-title { font-size: 13px; font-weight: 700; color: #111827; }\n                        .report-period { font-size: 10px; color: #4b5563; margin-top: 3px; }\n                        .report-generated { font-size: 9px; color: #6b7280; margin-top: 3px; }\n                        \n                        /* === KPI BAR === */\n                        .kpi-bar { display: flex; gap: 0; margin-bottom: 16px; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; }\n                        .kpi-item { flex: 1; text-align: center; padding: 10px 6px; border-right: 1px solid #d1d5db; background: #f9fafb; }\n                        .kpi-item:last-child { border-right: none; }\n                        .kpi-value { font-size: 20px; font-weight: 700; color: #111827; }\n                        .kpi-label { font-size: 8px; color: #4b5563; text-transform: uppercase; letter-spacing: 0.3px; margin-top: 2px; }\n                        .kpi-item.highlight { background: #fef3c7; }\n                        .kpi-item.highlight .kpi-value { color: #92400e; }\n                        .kpi-item.alert .kpi-value { color: #b91c1c; }\n                        \n                        /* === TIMELINE DAYS === */\n                        .day-block { margin-bottom: 10px; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; page-break-inside: avoid; }\n                        .day-block.empty { opacity: 0.65; }\n                        .day-block.weekend { background: #f9fafb; }\n                        .day-block.today { border: 2px solid #1e40af; }\n                        \n                        .day-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #f3f4f6; border-bottom: 1px solid #d1d5db; }\n                        .day-label { display: flex; align-items: center; gap: 8px; }\n                        .day-name { font-weight: 600; font-size: 11px; color: #111827; text-transform: capitalize; }\n                        .today-badge { font-size: 8px; font-weight: 600; color: #1e40af; background: #dbeafe; padding: 2px 6px; border-radius: 8px; }\n                        .day-count { font-size: 9px; color: #4b5563; }\n                        \n                        .day-content { padding: 8px 12px; background: white; }\n                        \n                        /* === TIMELINE ITEMS === */\n                        .timeline-item { display: flex; gap: 10px; padding: 8px 10px; margin-bottom: 6px; border-radius: 4px; border-left: 3px solid #d1d5db; background: #f9fafb; }\n                        .timeline-item:last-child { margin-bottom: 0; }\n                        \n                        .timeline-item.event-item { }\n                        .timeline-item.ticket-item { border-left-color: #d97706; background: #fffbeb; }\n                        \n                        .item-time { min-width: 42px; font-weight: 600; font-size: 10px; color: #374151; padding-top: 2px; }\n                        .item-content { flex: 1; }\n                        .item-header { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }\n                        .item-category { font-size: 9px; font-weight: 600; }\n                        .item-status { font-size: 8px; color: #4b5563; margin-left: auto; }\n                        .item-priority { font-size: 8px; font-weight: 600; color: white; padding: 2px 6px; border-radius: 8px; }\n                        .item-ticket-id { font-size: 9px; color: #4b5563; margin-left: auto; }\n                        .item-title { font-size: 11px; font-weight: 600; color: #111827; }\n                        .item-details { font-size: 9px; color: #4b5563; margin-top: 2px; }\n                        .item-meta { display: flex; gap: 10px; margin-top: 4px; font-size: 9px; color: #4b5563; }\n                        .meta-unassigned { color: #b91c1c; font-weight: 600; }\n                        \n                        .empty-day { text-align: center; padding: 14px; color: #6b7280; font-style: italic; font-size: 10px; }\n                        \n                        /* === FOOTER === */\n                        .footer { margin-top: 16px; padding-top: 10px; border-top: 1px solid #d1d5db; display: flex; justify-content: space-between; align-items: center; font-size: 9px; color: #6b7280; }\n                        .footer-left { }\n                        .footer-right { text-align: right; }\n                        \n                        @media print { \n                            body { padding: 18mm 15mm 20mm 15mm !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; } \n                            .day-block { page-break-inside: avoid; }\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class="header">\n                        <div class="company-section">\n                            <img src="${c}" class="company-logo" onerror="this.style.display='none'" />\n                            <div class="company-info">\n                                <div class="company-title">${o}</div>\n                                ${s?`<div class="company-subtitle">${s}</div>`:""}\n                            </div>\n                        </div>\n                        <div class="report-section">\n                            <div class="report-badge">Semaine ${f}</div>\n                            <div class="report-title">Planning Hebdomadaire</div>\n                            <div class="report-period">${r} ‚Äî ${i}</div>\n                            <div class="report-generated">G√©n√©r√© le ${(new Date).toLocaleString("fr-FR")}</div>\n                        </div>\n                    </div>\n                    \n                    <div class="kpi-bar">\n                        <div class="kpi-item"><div class="kpi-value">${v}</div><div class="kpi-label">√âv√©nements</div></div>\n                        <div class="kpi-item highlight"><div class="kpi-value">${y}</div><div class="kpi-label">Maintenances</div></div>\n                        <div class="kpi-item ${w>0?"alert":""}"><div class="kpi-value">${w}</div><div class="kpi-label">Priorit√© haute</div></div>\n                        <div class="kpi-item"><div class="kpi-value">${R}/7</div><div class="kpi-label">Jours actifs</div></div>\n                    </div>\n                    \n                    ${E}\n                    \n                    <div class="footer">\n                        <div class="footer-left">Document confidentiel ‚Ä¢ Ne pas diffuser</div>\n                        <div class="footer-right">${s||"Gestion Maintenance"}</div>\n                    </div>\n                </body>\n                </html>\n            `}const f=window.open("","_blank","width=1000,height=800");f.document.write(b),f.document.close(),f.focus(),setTimeout(()=>f.print(),500)}}))},PrintExportModal=({currentDate:e,onClose:t,onPrint:a})=>{const[n,r]=React.useState("month"),[i,o]=React.useState(()=>{const t=e||new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}),[l,s]=React.useState(!1),[c,d]=React.useState(null),[m,p]=React.useState(""),g=[{id:"correspondance",label:"Correspondance",icon:"‚úâÔ∏è",documents:[{icon:"üìß",label:"Lettre officielle",value:"R√©diger une lettre officielle √† [destinataire] concernant : "},{icon:"ü§ù",label:"Lettre de partenariat",value:"Proposition de partenariat commercial avec : "},{icon:"üì¨",label:"R√©ponse fournisseur",value:"R√©ponse √† une demande de fournisseur concernant : "},{icon:"üôè",label:"Lettre de remerciement",value:"Lettre de remerciement adress√©e √† : "}]},{id:"subventions",label:"Subventions",icon:"üí∞",documents:[{icon:"üá®üá¶",label:"Subvention f√©d√©rale (PARI-CNRC)",value:"Demande de subvention au Programme d'aide √† la recherche industrielle (PARI-CNRC) pour le projet : "},{icon:"‚öúÔ∏è",label:"Subvention Qu√©bec (Investissement QC)",value:"Demande de subvention √† Investissement Qu√©bec pour le projet de : "},{icon:"üî¨",label:"Cr√©dit R&D (RS&DE)",value:"Pr√©paration du dossier de cr√©dit d'imp√¥t RS&DE pour les activit√©s de recherche et d√©veloppement : "},{icon:"üå±",label:"Programme √©cologique",value:"Demande au Fonds √âcoleader / Fonds vert pour le projet environnemental : "},{icon:"üë∑",label:"Subvention formation",value:"Demande de subvention √† Emploi-Qu√©bec pour la formation des employ√©s sur : "}]},{id:"administratif",label:"Administratif",icon:"üìÅ",documents:[{icon:"üìú",label:"Proc√®s-verbal",value:"R√©diger le proc√®s-verbal de la r√©union du conseil d'administration du : "},{icon:"üìã",label:"Politique interne",value:"R√©diger une politique interne concernant : "},{icon:"üìë",label:"Contrat type",value:"Pr√©parer un contrat type pour : "},{icon:"‚öñÔ∏è",label:"Mise en demeure",value:"R√©diger une mise en demeure adress√©e √† [nom] pour : "}]},{id:"rh",label:"Ressources Humaines",icon:"üë•",documents:[{icon:"üìÑ",label:"Offre d'emploi",value:"R√©diger une offre d'emploi pour le poste de : "},{icon:"‚úÖ",label:"Lettre d'embauche",value:"Lettre d'offre d'embauche pour [nom] au poste de : "},{icon:"üìù",label:"√âvaluation employ√©",value:"Formulaire d'√©valuation de performance pour : "},{icon:"üö™",label:"Lettre de fin d'emploi",value:"Lettre de fin d'emploi / cessation pour : "}]},{id:"technique",label:"Documents Techniques",icon:"üîß",documents:[{icon:"üìñ",label:"Manuel de proc√©dure",value:"R√©diger un manuel de proc√©dure pour : "},{icon:"üîí",label:"Fiche de s√©curit√©",value:"Fiche de donn√©es de s√©curit√© (FDS) pour le produit : "},{icon:"üìê",label:"Sp√©cification technique",value:"Sp√©cification technique d√©taill√©e pour : "},{icon:"‚úîÔ∏è",label:"Liste de v√©rification",value:"Checklist / liste de v√©rification pour : "}]},{id:"financier",label:"Documents Financiers",icon:"üíº",documents:[{icon:"üíµ",label:"Demande de financement",value:"Demande de financement bancaire pour le projet : "},{icon:"üìä",label:"Plan d'affaires",value:"Section du plan d'affaires concernant : "},{icon:"üßæ",label:"Justificatif de d√©penses",value:"Justificatif de d√©penses pour le projet/subvention : "},{icon:"üìà",label:"Rapport financier",value:"Rapport financier p√©riodique incluant : "}]},{id:"creatif",label:"Cr√©atif / Libre",icon:"üé®",documents:[{icon:"üåê",label:"Texte site web",value:"R√©diger un texte promotionnel pour notre site web pr√©sentant : "},{icon:"üì∞",label:"Communiqu√© de presse",value:"Communiqu√© de presse annon√ßant : "},{icon:"üé§",label:"Discours / Allocution",value:"R√©diger un discours pour [occasion] sur le th√®me : "},{icon:"üì¢",label:"Brochure / D√©pliant",value:"Cr√©er le contenu d'une brochure de pr√©sentation de l'entreprise mettant en avant : "},{icon:"üí°",label:"Pitch commercial",value:"R√©diger un pitch commercial pour pr√©senter nos services √† : "},{icon:"üìù",label:"Autre (libre)",value:""}]}],[u,b]=React.useState("correspondance"),[f,x]=React.useState(""),[h,v]=React.useState(null),[y,w]=React.useState(!1),[R,E]=React.useState(!1),k=()=>{"ai-report"===n?N():"secretary"===n?D():(a(n,new Date(i)),t())},N=async()=>{s(!0),d(null);try{const e=new Date(i),t=await axios.post("/api/ai/report",{period:"month",startDate:new Date(e.getFullYear(),e.getMonth(),1).toISOString(),endDate:new Date(e.getFullYear(),e.getMonth()+1,1).toISOString(),reportType:"summary",customInstructions:m.trim()||null});t.data.success?d(t.data):window.showToast&&window.showToast("Erreur de g√©n√©ration du rapport","error")}catch(e){console.error("AI Report error:",e),window.showToast&&window.showToast("Erreur: "+(e.response?.data?.error||e.message),"error")}finally{s(!1)}},$=e=>e?e.replace(/\|(.+)\|\n\|[-:\s|]+\|\n((?:\|.+\|\n?)+)/g,(e,t,a)=>`<table><thead><tr>${t.split("|").filter(e=>e.trim()).map(e=>`<th>${e.trim()}</th>`).join("")}</tr></thead><tbody>${a.trim().split("\n").map(e=>`<tr>${e.split("|").filter(e=>e.trim()).map(e=>`<td>${e.trim()}</td>`).join("")}</tr>`).join("")}</tbody></table>`).replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/^\* (.+)$/gm,"<li>$1</li>").replace(/^- (.+)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>\n?)+/g,"<ul>$&</ul>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>").replace(/^/,"<p>").replace(/$/,"</p>").replace(/<p><\/p>/g,"").replace(/<p>(<h[123]>)/g,"$1").replace(/(<\/h[123]>)<\/p>/g,"$1").replace(/<p>(<ul>)/g,"$1").replace(/(<\/ul>)<\/p>/g,"$1").replace(/<p>(<table>)/g,"$1").replace(/(<\/table>)<\/p>/g,"$1"):"",D=async()=>{if(f.trim()){w(!0),v(null);try{const e=await axios.post("/api/ai/secretary",{documentType:u,instructions:f.trim()});e.data.success?v(e.data):window.showToast&&window.showToast("Erreur de g√©n√©ration","error")}catch(e){console.error("Secretary AI error:",e),window.showToast&&window.showToast("Erreur: "+(e.response?.data?.error||e.message),"error")}finally{w(!1)}}else window.showToast&&window.showToast("Veuillez d√©crire le document souhait√©","warning")};return React.createElement("div",{className:"fixed inset-0 z-[200] overflow-y-auto",style:{background:"rgba(0, 0, 0, 0.5)"}},React.createElement("div",{className:"min-h-screen px-4 py-8 flex items-start justify-center"},React.createElement("div",{className:"w-full max-w-lg bg-white rounded-xl shadow-xl relative",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50 rounded-t-xl"},React.createElement("div",{},React.createElement("h2",{className:"text-lg font-semibold text-gray-900"},"Exporter le planning"),React.createElement("p",{className:"text-sm text-gray-500"},"Choisissez le format et la p√©riode")),React.createElement("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full text-gray-400 hover:bg-gray-200 hover:text-gray-600 transition"},React.createElement("i",{className:"fas fa-times"}))),React.createElement("div",{className:"p-6 space-y-5"},React.createElement("div",{},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-3"},"Type de document"),React.createElement("div",{className:"grid grid-cols-2 gap-3"},[{id:"month",label:"Planning mensuel",desc:"Vue calendrier du mois",icon:"fa-calendar-alt",color:"blue"},{id:"week",label:"Planning hebdo",desc:"Vue de la semaine",icon:"fa-calendar-week",color:"emerald"}].map(e=>{const t=n===e.id;return React.createElement("button",{key:e.id,onClick:()=>r(e.id),className:"p-4 rounded-lg border-2 text-center transition-all "+(t?"border-gray-900 bg-gray-900 text-white":"border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50")},React.createElement("i",{className:`fas ${e.icon} text-xl mb-2 ${t?"text-white":"text-gray-400"}`}),React.createElement("div",{className:"text-sm font-medium"},e.label),React.createElement("div",{className:"text-xs mt-1 "+(t?"text-gray-300":"text-gray-400")},e.desc))}))),React.createElement("div",{},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"week"===n?"Semaine":"Mois"),React.createElement("input",{type:"week"===n?"date":"month",value:"week"===n?i:i.substring(0,7),onChange:e=>{o("week"===n?e.target.value:e.target.value+"-01")},className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none text-gray-900"}),React.createElement("p",{className:"mt-2 text-sm text-gray-500"},"P√©riode s√©lectionn√©e : ",React.createElement("span",{className:"font-medium text-gray-900"},(()=>{const e=new Date(i);if("month"===n||"ai-report"===n)return e.toLocaleDateString("fr-FR",{month:"long",year:"numeric"});{const t=new Date(e),a=t.getDay();t.setDate(t.getDate()-a+(0===a?-6:1));const n=new Date(t);return n.setDate(n.getDate()+6),`${t.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})} ‚Äî ${n.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}`}})()))),"ai-report"===n&&React.createElement("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200"},React.createElement("div",{className:"flex items-center gap-2 mb-4"},React.createElement("i",{className:"fas fa-file-invoice text-gray-600"}),React.createElement("span",{className:"text-sm font-medium text-gray-900"},"Type de document")),React.createElement("div",{className:"grid grid-cols-2 gap-2 mb-4"},[{icon:"üìä",label:"Rapport mensuel",value:"Rapport de synth√®se mensuel pour la direction"},{icon:"üìù",label:"Note de service",value:"R√©diger une note de service concernant : "},{icon:"üìã",label:"Compte-rendu",value:"Compte-rendu de r√©union/incident : "},{icon:"üë∑",label:"Bilan technicien",value:"Analyse de performance des techniciens"},{icon:"üè≠",label:"Bilan machines",value:"√âtat et disponibilit√© du parc machines"},{icon:"‚ö†Ô∏è",label:"Incidents critiques",value:"Rapport sur les incidents critiques du mois"}].map((e,t)=>React.createElement("button",{key:t,type:"button",onClick:()=>p(e.value),className:"flex items-center gap-2 px-3 py-2 text-sm rounded-lg transition-all "+(m===e.value?"bg-gray-900 text-white":"bg-white text-gray-700 border border-gray-200 hover:border-gray-400")},React.createElement("span",{},e.icon),React.createElement("span",{className:"truncate"},e.label)))),React.createElement("textarea",{value:m,onChange:e=>p(e.target.value),placeholder:"Ou d√©crivez pr√©cis√©ment ce dont vous avez besoin...",rows:3,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none text-gray-900 text-sm resize-none"})),"secretary"===n&&React.createElement("div",{className:"bg-indigo-50 rounded-lg p-4 border border-indigo-200"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-user-tie text-indigo-600"}),React.createElement("span",{className:"text-sm font-medium text-gray-900"},"Secr√©taire de Direction IA"),React.createElement("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full"},"Lois QC/CA")),React.createElement("button",{onClick:()=>E(!R),className:"p-1.5 rounded-full transition-colors "+(R?"bg-indigo-200 text-indigo-800":"hover:bg-indigo-100 text-indigo-600"),title:"Trucs & Astuces"},React.createElement("i",{className:"fas fa-question-circle"}))),R&&React.createElement("div",{className:"mb-4 p-3 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-lg border border-amber-200"},React.createElement("div",{className:"flex items-center gap-2 mb-2"},React.createElement("i",{className:"fas fa-lightbulb text-amber-600"}),React.createElement("span",{className:"text-sm font-semibold text-amber-800"},"Trucs & Astuces pour de meilleurs r√©sultats")),React.createElement("ul",{className:"space-y-1"},['üí° Soyez pr√©cis : "Lettre au fournisseur ABC pour retard livraison" > "Lettre fournisseur"','üìÖ Incluez les dates : "r√©union du 15 janvier", "projet d√©marr√© en mars 2024"','üí∞ Montants exacts : "subvention de 50 000$", "investissement de 200 000$"','üë§ Nommez les destinataires : "M. Jean Tremblay, Directeur", "Mme Lavoie de Investissement Qu√©bec"','üéØ Pr√©cisez l\'objectif : "pour obtenir un financement", "pour relancer la commande"',"üìä L'IA utilise vos donn√©es r√©elles : tickets, machines, √©quipes pour enrichir les documents"].map((e,t)=>React.createElement("li",{key:t,className:"text-xs text-amber-700 flex items-start gap-1.5"},React.createElement("span",{className:"mt-0.5"},"‚Ä¢"),React.createElement("span",{},e))))),React.createElement("div",{className:"flex flex-wrap gap-2 mb-4"},g.map(e=>React.createElement("button",{key:e.id,type:"button",onClick:()=>{b(e.id),x("")},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-lg transition-all "+(u===e.id?"bg-indigo-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:border-indigo-300")},React.createElement("span",{},e.icon),React.createElement("span",{},e.label)))),React.createElement("div",{className:"grid grid-cols-2 gap-2 mb-4"},(g.find(e=>e.id===u)?.documents||[]).map((e,t)=>React.createElement("button",{key:t,type:"button",onClick:()=>x(e.value),className:"flex items-center gap-2 px-3 py-2 text-sm rounded-lg transition-all text-left "+(f===e.value?"bg-indigo-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:border-indigo-400")},React.createElement("span",{className:"text-base"},e.icon),React.createElement("span",{className:"truncate"},e.label)))),React.createElement("textarea",{value:f,onChange:e=>x(e.target.value),placeholder:"D√©crivez le document souhait√© avec tous les d√©tails pertinents (destinataire, objet, contexte, montants, dates, etc.)...",rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none text-gray-900 text-sm resize-none"}),React.createElement("div",{className:"mt-3 p-3 bg-white rounded-lg border border-indigo-100"},React.createElement("div",{className:"text-xs text-gray-600"},React.createElement("span",{className:"font-medium text-indigo-700"},"üí° Connaissances int√©gr√©es: "),"Lois canadiennes et qu√©b√©coises applicables √† l'industrie manufacturi√®re, programmes de subventions (PARI-CNRC, IQ, RS&DE, Emploi-Qu√©bec), normes de r√©daction administrative."))),h&&"secretary"===n&&React.createElement("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-check-circle text-green-600"}),React.createElement("span",{className:"text-sm font-medium text-green-800"},h.title||"Document g√©n√©r√©")),React.createElement("button",{onClick:async()=>{if(!h)return;let e="IGP",t="",a="/api/settings/logo";try{const n=await axios.get("/api/settings/config/public");n.data&&(e=n.data.company_short_name||"IGP",t=n.data.company_subtitle||"",n.data.company_logo_url&&(a=n.data.company_logo_url))}catch(e){}const n=window.open("","_blank"),r=(new Date).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),i=$(h.document),o=h.title||"Document";n.document.write(`<!DOCTYPE html>\n<html lang="fr">\n<head>\n<meta charset="UTF-8">\n<title>${o}</title>\n<style>\n@page { size: A4; margin: 0; }\n* { box-sizing: border-box; margin: 0; padding: 0; }\nbody { \n    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;\n    font-size: 11pt; line-height: 1.7; color: #333;\n    padding: 20mm 18mm 25mm 18mm;\n}\n.header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25pt; padding-bottom: 15pt; border-bottom: 1pt solid #e0e0e0; }\n.header-left { display: flex; align-items: center; }\n.logo { height: 45pt; margin-right: 15pt; }\n.brand { border-left: 2pt solid #4f46e5; padding-left: 15pt; }\n.brand-name { font-size: 16pt; font-weight: 600; color: #1a1a1a; }\n.brand-sub { font-size: 9pt; color: #555; margin-top: 4pt; max-width: 250pt; }\n.header-right { text-align: right; font-size: 10pt; color: #555; }\n.title-block { text-align: center; padding: 20pt 0; margin-bottom: 20pt; border-bottom: 2pt solid #4f46e5; }\n.title-block h1 { font-size: 18pt; font-weight: 700; color: #1a1a1a; }\n.content { font-size: 11pt; }\n.content h2 { font-size: 14pt; color: #1a1a1a; margin: 18pt 0 10pt; border-bottom: 1pt solid #eee; padding-bottom: 6pt; }\n.content h3 { font-size: 12pt; color: #333; margin: 15pt 0 8pt; }\n.content p { margin-bottom: 10pt; text-align: justify; }\n.content ul, .content ol { margin: 10pt 0 10pt 20pt; }\n.content li { margin-bottom: 5pt; }\n.content strong { color: #1a1a1a; }\n.content table { width: 100%; border-collapse: collapse; margin: 12pt 0; font-size: 10pt; }\n.content th, .content td { border: 1pt solid #ddd; padding: 8pt; text-align: left; }\n.content th { background: #f8f8f8; font-weight: 600; }\n.footer { margin-top: 30pt; padding-top: 15pt; border-top: 1pt solid #ddd; font-size: 9pt; color: #666; text-align: center; }\n@media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }\n</style>\n</head>\n<body>\n<div class="header">\n    <div class="header-left">\n        <img src="${a}" class="logo" onerror="this.style.display='none'">\n        <div class="brand">\n            <div class="brand-name">${e}</div>\n            <div class="brand-sub">${t}</div>\n        </div>\n    </div>\n    <div class="header-right">\n        <div>${r}</div>\n    </div>\n</div>\n<div class="title-block">\n    <h1>${o}</h1>\n</div>\n<div class="content">\n    ${i}\n</div>\n<div class="footer">\n    Document g√©n√©r√© par ${e} - Secr√©tariat de Direction\n</div>\n</body>\n</html>`),n.document.close(),setTimeout(()=>{n.print()},300)},className:"px-3 py-1.5 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition"},"Imprimer")),React.createElement("div",{className:"bg-white rounded-lg p-3 max-h-48 overflow-y-auto text-sm text-gray-700 whitespace-pre-wrap border border-green-100"},h.document)),c&&"ai-report"===n&&React.createElement("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-check-circle text-green-600"}),React.createElement("span",{className:"text-sm font-medium text-green-800"},"Document g√©n√©r√©")),React.createElement("button",{onClick:async()=>{if(!c)return;let e="IGP",t="",a="/api/settings/logo",n="#0f4c81";try{const r=await axios.get("/api/settings/config/public");r.data&&(e=r.data.company_short_name||"IGP",t=r.data.company_subtitle||"",r.data.company_logo_url&&(a=r.data.company_logo_url),r.data.primary_color&&(n=r.data.primary_color))}catch(e){console.log("Settings not loaded")}const r=e+" Gestion",o=window.open("","_blank"),l=new Date(i),s=l.toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),d=s.charAt(0).toUpperCase()+s.slice(1),p=(new Date).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),g=(m||"").toLowerCase(),u=g.includes("note")?"Note de service":g.includes("compte-rendu")?"Compte-rendu":g.includes("m√©mo")?"M√©mo":g.includes("bilan")?"Bilan d'activit√©":g.includes("incident")?"Rapport d'incident":"Rapport de gestion",b=$(c.report),f=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(Date.now()).slice(-4)}`;o.document.write(`<!DOCTYPE html>\n<html lang="fr">\n<head>\n<meta charset="UTF-8">\n<title>${u} - ${d}</title>\n<style>\n/* Marges d'impression - IMPORTANT: utiliser padding sur body car @page margin n'est pas fiable */\n@page { \n    size: A4; \n    margin: 0;\n}\n\n* { \n    box-sizing: border-box; \n    margin: 0; \n    padding: 0; \n}\n\nhtml { \n    width: 100%;\n    height: 100%;\n}\n\nbody { \n    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;\n    font-size: 11pt;\n    line-height: 1.7;\n    color: #333;\n    /* Marges forc√©es via padding - plus fiable que @page margin */\n    padding: 20mm 18mm 25mm 18mm;\n    min-height: 100%;\n}\n\n/* Wrapper principal */\n.page-wrapper {\n    max-width: 100%;\n    margin: 0;\n}\n\n/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */\n.header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: 25pt;\n    padding-bottom: 15pt;\n    border-bottom: 1pt solid #e0e0e0;\n}\n.header-left {\n    display: flex;\n    align-items: center;\n}\n.logo {\n    height: 45pt;\n    margin-right: 15pt;\n}\n.brand {\n    border-left: 2pt solid #0066cc;\n    padding-left: 15pt;\n}\n.brand-name {\n    font-size: 16pt;\n    font-weight: 600;\n    color: #1a1a1a;\n    letter-spacing: 0.5pt;\n}\n.brand-sub {\n    font-size: 9pt;\n    color: #555;\n    margin-top: 4pt;\n    max-width: 250pt;\n}\n.header-right {\n    text-align: right;\n    font-size: 10pt;\n    color: #555;\n}\n.header-right .ref {\n    font-size: 9pt;\n    color: #888;\n    margin-top: 4pt;\n}\n\n/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TITLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */\n.title-block {\n    text-align: center;\n    padding: 25pt 0;\n    margin-bottom: 25pt;\n    background: linear-gradient(to right, #f8f9fa, #fff, #f8f9fa);\n    border-top: 3pt solid #1a1a1a;\n    border-bottom: 1pt solid #ddd;\n}\n.title-block h1 {\n    font-size: 20pt;\n    font-weight: 700;\n    color: #1a1a1a;\n    text-transform: uppercase;\n    letter-spacing: 3pt;\n}\n.title-block .period {\n    font-size: 12pt;\n    color: #555;\n    margin-top: 10pt;\n    font-weight: 400;\n}\n\n/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUMMARY BOX ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */\n.summary-box {\n    background: #f5f7fa;\n    padding: 18pt 22pt;\n    margin-bottom: 25pt;\n    border-left: 4pt solid #0066cc;\n    border-radius: 0 4pt 4pt 0;\n}\n.summary-box .label {\n    font-size: 8pt;\n    text-transform: uppercase;\n    letter-spacing: 1.5pt;\n    color: #888;\n    margin-bottom: 8pt;\n    font-weight: 600;\n}\n.summary-box .text {\n    font-size: 11pt;\n    color: #333;\n    line-height: 1.6;\n}\n\n/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê KPI ROW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */\n.kpi-row {\n    display: flex;\n    justify-content: space-around;\n    margin-bottom: 30pt;\n    padding: 20pt 0;\n    background: #fafbfc;\n    border: 1pt solid #e8e8e8;\n    border-radius: 4pt;\n}\n.kpi-item {\n    text-align: center;\n    flex: 1;\n    padding: 0 10pt;\n    border-right: 1pt solid #e0e0e0;\n}\n.kpi-item:last-child {\n    border-right: none;\n}\n.kpi-value {\n    font-size: 36pt;\n    font-weight: 300;\n    color: #1a1a1a;\n    line-height: 1.2;\n}\n.kpi-value.alert {\n    color: #c62828;\n    font-weight: 500;\n}\n.kpi-label {\n    font-size: 8pt;\n    text-transform: uppercase;\n    letter-spacing: 1.5pt;\n    color: #777;\n    margin-top: 8pt;\n    font-weight: 500;\n}\n\n/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */\n.content {\n    line-height: 1.5;\n}\n\n.content h1 {\n    font-size: 12pt;\n    font-weight: 700;\n    color: #1a1a1a;\n    text-transform: uppercase;\n    letter-spacing: 0.5pt;\n    margin: 16pt 0 8pt;\n    padding-bottom: 5pt;\n    border-bottom: 1.5pt solid #1a1a1a;\n}\n.content h1:first-child { margin-top: 0; }\n\n.content h2 {\n    font-size: 11pt;\n    font-weight: 600;\n    color: #333;\n    margin: 12pt 0 6pt;\n    padding-left: 8pt;\n    border-left: 2pt solid #0066cc;\n}\n\n.content h3 {\n    font-size: 10.5pt;\n    font-weight: 600;\n    color: #444;\n    margin: 10pt 0 5pt;\n}\n\n.content p {\n    margin: 6pt 0;\n    text-align: justify;\n    line-height: 1.5;\n}\n\n.content ul, .content ol { \n    margin: 8pt 0 8pt 20pt;\n}\n.content li { \n    margin: 3pt 0;\n    line-height: 1.45;\n}\n\n.content strong { font-weight: 600; }\n.content em { font-style: italic; }\n\n/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABLES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */\ntable {\n    width: 100%;\n    border-collapse: collapse;\n    margin: 18pt 0;\n    font-size: 10pt;\n}\nth {\n    background: #f0f2f5;\n    border: 1pt solid #ddd;\n    padding: 10pt 8pt;\n    text-align: left;\n    font-weight: 600;\n    font-size: 9pt;\n    text-transform: uppercase;\n    color: #444;\n}\ntd {\n    border: 1pt solid #ddd;\n    padding: 9pt 8pt;\n    line-height: 1.5;\n}\ntr:nth-child(even) { background: #fafafa; }\n\n/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */\n.footer {\n    margin-top: 50pt;\n    padding-top: 15pt;\n    border-top: 1pt solid #ddd;\n    display: flex;\n    justify-content: space-between;\n    font-size: 9pt;\n    color: #888;\n}\n.footer .conf {\n    text-transform: uppercase;\n    letter-spacing: 1pt;\n    font-weight: 500;\n}\n\n/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PRINT STYLES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */\n@media print {\n    body { \n        -webkit-print-color-adjust: exact !important; \n        print-color-adjust: exact !important;\n        /* GARDER le padding pour les marges */\n        padding: 20mm 18mm 25mm 18mm !important;\n    }\n    .kpi-row, .title-block, .summary-box { \n        page-break-inside: avoid; \n    }\n    h1, h2, h3 { \n        page-break-after: avoid; \n    }\n}\n</style>\n</head>\n<body>\n<div class="page-wrapper">\n\n<div class="header">\n    <div class="header-left">\n        <img src="${a}" alt="" class="logo" onerror="this.style.display='none'">\n        <div class="brand">\n            <div class="brand-name">${r}</div>\n            <div class="brand-sub">${t}</div>\n        </div>\n    </div>\n    <div class="header-right">\n        <div>${p}</div>\n        <div class="ref">R√©f. ${f}</div>\n    </div>\n</div>\n\n<div class="title-block">\n    <h1>${u}</h1>\n    <div class="period">${d}</div>\n</div>\n\n${c.customFocus?`\n<div class="summary-box">\n    <div class="label">Objet</div>\n    <div class="text">${c.customFocus}</div>\n</div>\n`:""}\n\n<div class="kpi-row">\n    <div class="kpi-item">\n        <div class="kpi-value">${c.kpis?.ticketsCreated||0}</div>\n        <div class="kpi-label">Cr√©√©s</div>\n    </div>\n    <div class="kpi-item">\n        <div class="kpi-value">${c.kpis?.ticketsCompleted||0}</div>\n        <div class="kpi-label">Termin√©s</div>\n    </div>\n    <div class="kpi-item">\n        <div class="kpi-value">${c.kpis?.activeTickets||0}</div>\n        <div class="kpi-label">En cours</div>\n    </div>\n    <div class="kpi-item">\n        <div class="kpi-value${(c.kpis?.criticalTickets||0)>0?" alert":""}">${c.kpis?.criticalTickets||0}</div>\n        <div class="kpi-label">Critiques</div>\n    </div>\n</div>\n\n<div class="content">\n${b}\n</div>\n\n<div class="footer">\n    <span class="conf">Document confidentiel</span>\n    <span>${t}</span>\n</div>\n\n</div>\n</body>\n</html>`),o.document.close(),setTimeout(()=>o.print(),500)},className:"px-3 py-1.5 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition"},"Imprimer")),React.createElement("div",{className:"bg-white rounded-lg p-3 max-h-40 overflow-y-auto text-sm text-gray-700 whitespace-pre-wrap border border-green-100"},c.report))),React.createElement("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50 rounded-b-xl"},React.createElement("button",{onClick:t,className:"px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition"},"Annuler"),"ai-report"===n||"secretary"===n?React.createElement("button",{onClick:k,disabled:l||y,className:`px-5 py-2.5 text-sm font-medium text-white rounded-lg transition flex items-center gap-2 ${"secretary"===n?"bg-indigo-600 hover:bg-indigo-700":"bg-gray-900 hover:bg-gray-800"} ${l||y?"opacity-50 cursor-not-allowed":""}`},l||y?React.createElement("i",{className:"fas fa-spinner fa-spin"}):React.createElement("i",{className:"secretary"===n?"fas fa-magic":"fas fa-file-alt"}),l||y?"G√©n√©ration IA...":"secretary"===n?"R√©diger le document":"G√©n√©rer le rapport"):React.createElement("button",{onClick:k,className:"px-5 py-2.5 text-sm font-medium text-white bg-gray-900 rounded-lg hover:bg-gray-800 transition flex items-center gap-2"},React.createElement("i",{className:"fas fa-download"}),"Exporter")))))},ShareModal=({onClose:e,onShare:t})=>{const[a,n]=React.useState([]),[r,i]=React.useState(""),[o,l]=React.useState(""),[s,c]=React.useState(!0),[d,m]=React.useState(!1),[p,g]=React.useState(null);return React.useEffect(()=>{axios.get("/api/messages/available-users").then(e=>{n(e.data.users||[]),c(!1)}).catch(e=>{console.error("Error fetching users:",e),g("Impossible de charger les utilisateurs"),c(!1)})},[]),React.createElement("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fadeIn"},React.createElement("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-slideUp"},React.createElement("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50"},React.createElement("h3",{className:"font-bold text-gray-800 flex items-center gap-2"},React.createElement("i",{className:"fas fa-share-alt text-blue-600"}),"Partager le planning"),React.createElement("button",{onClick:e,className:"text-gray-400 hover:text-gray-600"},React.createElement("i",{className:"fas fa-times"}))),React.createElement("form",{onSubmit:async a=>{if(a.preventDefault(),r){m(!0);try{await t(r,o),e()}catch(e){g("Erreur lors du partage"),m(!1)}}},className:"p-6"},p&&React.createElement("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-md text-sm"},p),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Destinataire"),s?React.createElement("div",{className:"text-sm text-gray-500"},"Chargement..."):React.createElement("select",{className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:r,onChange:e=>i(e.target.value),required:!0},React.createElement("option",{value:""},"-- S√©lectionner un utilisateur --"),a.map(e=>React.createElement("option",{key:e.id,value:e.id},e.full_name||e.email)))),React.createElement("div",{className:"mb-6"},React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Message (optionnel)"),React.createElement("textarea",{className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",rows:3,value:o,onChange:e=>l(e.target.value),placeholder:"Je vous invite √† consulter le planning de production..."})),React.createElement("div",{className:"flex justify-end gap-3"},React.createElement("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md"},"Annuler"),React.createElement("button",{type:"submit",disabled:!r||d,className:"px-4 py-2 text-sm text-white bg-blue-600 hover:bg-blue-700 rounded-md shadow-sm flex items-center gap-2 "+(d?"opacity-70 cursor-not-allowed":"")},d&&React.createElement("i",{className:"fas fa-spinner fa-spin"}),"Envoyer l'invitation")))))};window.ProductionPlanning=ProductionPlanning;