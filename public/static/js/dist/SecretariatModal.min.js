const extractOfficialDocument=e=>{if(!e)return"";const t=e.split(/^---\s*$/m);if(t.length>=3)return t[1].trim();if(2===t.length){const e=t[0].trim(),n=t[1].trim();return n.length>e.length?n:e}return e.trim()},SecretariatModal=({isOpen:e,onClose:t})=>{const[n,a]=React.useState("correspondance"),[i,r]=React.useState(null),[o,s]=React.useState(""),[l,c]=React.useState(null),[d,m]=React.useState(!1),[p,u]=React.useState("form"),[g,f]=React.useState("categories"),[b,h]=React.useState(!1),[x,v]=React.useState(0),w={correspondance:{description:"Lettres officielles, courriels formels, communications externes",keywords:["lettre","courrier","correspondance","r√©ponse","demande"],notFor:["rapport","kpi","performance","statistiques"]},subventions:{description:"Demandes de financement gouvernemental, cr√©dits d'imp√¥t R&D",keywords:["subvention","financement","pari","rsde","cr√©dit"],notFor:["rapport","lettre","communiqu√©"]},administratif:{description:"Documents internes : proc√®s-verbaux, politiques, contrats",keywords:["proc√®s-verbal","politique","contrat","mise en demeure"],notFor:["rapport maintenance","kpi","site web"]},rh:{description:"Gestion du personnel : offres d'emploi, embauches, √©valuations",keywords:["employ√©","embauche","emploi","√©valuation","cong√©diement"],notFor:["rapport","maintenance","machine"]},technique:{description:"Documentation technique : manuels, proc√©dures, fiches s√©curit√©",keywords:["proc√©dure","manuel","technique","s√©curit√©","checklist"],notFor:["rapport mensuel","kpi","communiqu√©"]},financier:{description:"Documents financiers : demandes de cr√©dit, plans d'affaires",keywords:["financement","budget","d√©penses","financier"],notFor:["maintenance","technique","communiqu√©"]},rapports:{description:"üìä RAPPORTS DE MAINTENANCE : KPIs, performance √©quipe, √©tat machines",keywords:["rapport","kpi","performance","mensuel","bilan","statistiques"],notFor:["lettre","communiqu√©","site web"]},creatif:{description:"üé® CR√âATIF : Communiqu√©s de presse, textes web, discours, pitchs",keywords:["communiqu√©","site web","discours","pitch","marketing"],notFor:["rapport","kpi","maintenance","statistiques","mensuel"]}},R=[{id:"correspondance",label:"Correspondance",icon:"fa-envelope",color:"blue",documents:[{icon:"fa-file-alt",label:"Lettre officielle",value:"R√©diger une lettre officielle √† [destinataire] concernant : "},{icon:"fa-handshake",label:"Lettre de partenariat",value:"Proposition de partenariat commercial avec : "},{icon:"fa-reply",label:"R√©ponse fournisseur",value:"R√©ponse √† une demande de fournisseur concernant : "},{icon:"fa-heart",label:"Lettre de remerciement",value:"Lettre de remerciement adress√©e √† : "}]},{id:"subventions",label:"Subventions",icon:"fa-dollar-sign",color:"emerald",documents:[{icon:"fa-flag",label:"PARI-CNRC",value:"Demande de subvention au Programme d'aide √† la recherche industrielle (PARI-CNRC) pour le projet : "},{icon:"fa-landmark",label:"Investissement Qu√©bec",value:"Demande de subvention √† Investissement Qu√©bec pour le projet de : "},{icon:"fa-flask",label:"Cr√©dit RS&DE",value:"Pr√©paration du dossier de cr√©dit d'imp√¥t RS&DE pour les activit√©s de R&D : "},{icon:"fa-leaf",label:"Fonds √©cologique",value:"Demande au Fonds √âcoleader pour le projet environnemental : "},{icon:"fa-graduation-cap",label:"Formation Emploi-QC",value:"Demande de subvention √† Emploi-Qu√©bec pour la formation sur : "}]},{id:"administratif",label:"Administratif",icon:"fa-folder",color:"amber",documents:[{icon:"fa-gavel",label:"Proc√®s-verbal",value:"R√©diger le proc√®s-verbal de la r√©union du : "},{icon:"fa-clipboard-list",label:"Politique interne",value:"R√©diger une politique interne concernant : "},{icon:"fa-file-contract",label:"Contrat type",value:"Pr√©parer un contrat type pour : "},{icon:"fa-balance-scale",label:"Mise en demeure",value:"R√©diger une mise en demeure adress√©e √† [nom] pour : "}]},{id:"rh",label:"RH",icon:"fa-users",color:"purple",documents:[{icon:"fa-user-plus",label:"Offre d'emploi",value:"R√©diger une offre d'emploi pour le poste de : "},{icon:"fa-file-signature",label:"Lettre d'embauche",value:"Lettre d'offre d'embauche pour [nom] au poste de : "},{icon:"fa-chart-line",label:"√âvaluation employ√©",value:"Formulaire d'√©valuation de performance pour : "},{icon:"fa-door-open",label:"Fin d'emploi",value:"Lettre de fin d'emploi pour : "}]},{id:"technique",label:"Technique",icon:"fa-cogs",color:"slate",documents:[{icon:"fa-book",label:"Manuel proc√©dure",value:"R√©diger un manuel de proc√©dure pour : "},{icon:"fa-shield-alt",label:"Fiche s√©curit√©",value:"Fiche de donn√©es de s√©curit√© (FDS) pour : "},{icon:"fa-ruler-combined",label:"Sp√©cification technique",value:"Sp√©cification technique d√©taill√©e pour : "},{icon:"fa-tasks",label:"Checklist",value:"Liste de v√©rification pour : "}]},{id:"financier",label:"Financier",icon:"fa-chart-pie",color:"rose",documents:[{icon:"fa-hand-holding-usd",label:"Demande financement",value:"Demande de financement bancaire pour : "},{icon:"fa-briefcase",label:"Plan d'affaires",value:"Section du plan d'affaires concernant : "},{icon:"fa-receipt",label:"Justificatif d√©penses",value:"Justificatif de d√©penses pour : "},{icon:"fa-file-invoice-dollar",label:"Rapport financier",value:"Rapport financier p√©riodique incluant : "}]},{id:"rapports",label:"Rapports",icon:"fa-chart-bar",color:"indigo",documents:[{icon:"fa-calendar-alt",label:"Rapport mensuel",value:"G√©n√©rer un rapport mensuel complet sur les op√©rations de maintenance avec les KPIs cl√©s"},{icon:"fa-tachometer-alt",label:"Bilan performance",value:"Analyse de performance de l'√©quipe technique avec temps de r√©ponse et r√©solution"},{icon:"fa-industry",label:"√âtat machines",value:"Rapport sur l'√©tat et la disponibilit√© du parc machines"},{icon:"fa-exclamation-triangle",label:"Incidents critiques",value:"Rapport sur les incidents critiques et pannes majeures"}]},{id:"creatif",label:"Cr√©atif",icon:"fa-paint-brush",color:"pink",documents:[{icon:"fa-globe",label:"Texte site web",value:"R√©diger un texte promotionnel pour notre site web pr√©sentant : "},{icon:"fa-newspaper",label:"Communiqu√© presse",value:"Communiqu√© de presse annon√ßant : "},{icon:"fa-microphone",label:"Discours",value:"R√©diger un discours pour [occasion] sur le th√®me : "},{icon:"fa-bullhorn",label:"Pitch commercial",value:"R√©diger un pitch commercial pour pr√©senter nos services √† : "}]}],E={blue:{bg:"bg-blue-500",light:"bg-blue-50",text:"text-blue-600",border:"border-blue-200",ring:"ring-blue-500"},emerald:{bg:"bg-emerald-500",light:"bg-emerald-50",text:"text-emerald-600",border:"border-emerald-200",ring:"ring-emerald-500"},amber:{bg:"bg-amber-500",light:"bg-amber-50",text:"text-amber-600",border:"border-amber-200",ring:"ring-amber-500"},purple:{bg:"bg-purple-500",light:"bg-purple-50",text:"text-purple-600",border:"border-purple-200",ring:"ring-purple-500"},slate:{bg:"bg-slate-500",light:"bg-slate-50",text:"text-slate-600",border:"border-slate-200",ring:"ring-slate-500"},rose:{bg:"bg-rose-500",light:"bg-rose-50",text:"text-rose-600",border:"border-rose-200",ring:"ring-rose-500"},indigo:{bg:"bg-indigo-500",light:"bg-indigo-50",text:"text-indigo-600",border:"border-indigo-200",ring:"ring-indigo-500"},pink:{bg:"bg-pink-500",light:"bg-pink-50",text:"text-pink-600",border:"border-pink-200",ring:"ring-pink-500"}},y=e=>{r(e.label),s(e.value),f("form")},N=e=>{a(e),s(""),r(null)},k=async()=>{if(!o.trim())return void(window.showToast&&window.showToast("Veuillez d√©crire le document souhait√©","warning"));m(!0),c(null),v(0);const e=Date.now(),t=setInterval(()=>{v(Math.floor((Date.now()-e)/1e3))},1e3);try{const t=localStorage.getItem("auth_token"),a=await axios.post("/api/ai/secretary",{documentType:b?"auto":n,instructions:o.trim()},{headers:t?{Authorization:`Bearer ${t}`}:{},timeout:12e4});if(!1===a.data.success)throw new Error(a.data.error||"Erreur");{const t=extractOfficialDocument(a.data.document);c({...a.data,document:t}),u("preview");const n=Math.floor((Date.now()-e)/1e3);window.showToast&&window.showToast(`‚ú® Document pr√™t en ${n}s`,"success")}}catch(e){window.showToast&&window.showToast(e.response?.data?.error||"Erreur lors de la g√©n√©ration","error")}finally{clearInterval(t),m(!1)}},$=(e,t=!1)=>{if(!e)return"";if(t)return(e=(e=(e=(e=e.replace(/!\[([^\]]*)\][\s\n]+\(([^)]+)\)/g,"![$1]($2)")).replace(/!\[([^\]]*)\]\(([^)]*[\s\n][^)]*)\)/g,(e,t,n)=>"!["+t+"]("+n.replace(/[\s\n]+/g,"")+")")).replace(/^(\*\*Signature\s*:\*\*|Signature\s*:)\s*(\n_+)?$/gim,'<div class="manual-signature-block"><strong>Signature :</strong><div class="signature-space"></div><div class="signature-line-manual"></div></div>')).replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(e,t,n)=>t.toLowerCase().includes("signature")?'<div class="signature-block"><img src="'+n+'" alt="'+t+'" style="max-height:70px;width:auto;border:none;box-shadow:none;margin:0;"><div class="signature-line"></div></div>':'<img src="'+n+'" alt="'+t+'" style="max-width:100%;height:auto;margin:10pt 0;">')).split(/\n\n+/).map(e=>`<div class="letter-block">${e=(e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")).replace(/\n/g,"<br>")}</div>`).join("");let n=(e=(e=(e=(e=e.replace(/!\[([^\]]*)\][\s\n]+\(([^)]+)\)/g,"![$1]($2)")).replace(/!\[([^\]]*)\]\(([^)]*[\s\n][^)]*)\)/g,(e,t,n)=>"!["+t+"]("+n.replace(/[\s\n]+/g,"")+")")).replace(/^(\*\*Signature\s*:\*\*|Signature\s*:)\s*(\n_+)?$/gim,'<div class="manual-signature-block"><strong>Signature :</strong><div class="signature-space"></div><div class="signature-line-manual"></div></div>')).replace(/^(?:>\s*.+\n?)+/gm,e=>`<blockquote>${e.split("\n").filter(e=>e.trim()).map(e=>e.replace(/^>\s*/,"").trim()).join("<br>")}</blockquote>\n`)).replace(/\*\*([^*]+)\*\*/g,'<strong style="font-weight:700;color:#0f172a">$1</strong>').replace(/\*([^*]+)\*/g,'<em style="font-style:italic">$1</em>').replace(/((?:^\|.+\|$\n?)+)/gm,e=>(e=>{const t=e.trim().split("\n").filter(e=>e.trim());if(t.length<2)return e;const n=t[1];if(!/^[\s|:-]+$/.test(n))return e;return`<div class="table-wrapper"><table style="width:100%;min-width:500px;border-collapse:collapse;font-size:10pt;border:2px solid #000 !important"><thead><tr>${t[0].split("|").slice(1,-1).map(e=>e.trim()).map(e=>`<th style="border:2px solid #000 !important;padding:10px 12px;text-align:left;font-weight:bold;background:#d1d5db !important;-webkit-print-color-adjust:exact !important;print-color-adjust:exact !important">${e}</th>`).join("")}</tr></thead><tbody>${t.slice(2).map((e,t)=>`<tr>${e.split("|").slice(1,-1).map(e=>e.trim()).map(e=>`<td style="border:1px solid #000 !important;padding:8px 12px">${e||"&nbsp;"}</td>`).join("")}</tr>`).join("")}</tbody></table></div>`})(e)).replace(/^[-*_]{3,}\s*$/gm,'<hr class="doc-separator">').replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(e,t,n)=>t.toLowerCase().includes("signature")?'<div class="signature-block"><img src="'+n+'" alt="'+t+'" style="max-height:70px;width:auto;border:none;box-shadow:none;margin:0;"><div class="signature-line"></div></div>':'<img src="'+n+'" alt="'+t+'" class="doc-image" style="max-width:100%;height:auto;margin:10pt 0;border-radius:8pt;box-shadow:0 2pt 8pt rgba(0,0,0,0.1);">').replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" style="color:#3b82f6;text-decoration:none;font-weight:500;">$1</a>').replace(/^#### (.+)$/gm,'<h4 style="font-family:Arial,Helvetica,sans-serif;font-size:10pt;font-weight:600;color:#444;margin:10px 0 6px">$1</h4>').replace(/^### (.+)$/gm,'<h3 style="font-family:Arial,Helvetica,sans-serif;font-size:11pt;font-weight:700;color:#333;margin:14px 0 8px">$1</h3>').replace(/^## (.+)$/gm,'<h2 style="font-family:Arial,Helvetica,sans-serif;font-size:13pt;font-weight:700;color:#1a1a1a;margin:20px 0 10px;padding-bottom:4px;border-bottom:1px solid #ccc">$1</h2>').replace(/^# (.+)$/gm,'<h1 style="font-family:Arial,Helvetica,sans-serif;font-size:16pt;font-weight:700;color:#000;margin:24px 0 16px;padding-bottom:6px;border-bottom:2px solid #1a1a1a;text-transform:uppercase;letter-spacing:1px">$1</h1>').replace(/`([^`]+)`/g,'<code style="background:#f1f5f9;padding:2pt 6pt;border-radius:4pt;font-family:monospace;font-size:9pt;color:#0f172a;">$1</code>').replace(/^(\s*)[\*\-] (.+)$/gm,(e,t,n)=>`<li data-level="${Math.floor((t||"").length/2)}">${n}</li>`).replace(/^\d+\. (.+)$/gm,'<li class="numbered">$1</li>');return n=n.replace(/(<li[^>]*>.*<\/li>\n?)+/g,e=>{const t=e.replace(/\n/g,"");return t.includes('class="numbered"')?`<ol>${t}</ol>`:`<ul>${t}</ul>`}),n=n.replace(/\n\n+/g,"</p><p>").replace(/\n/g,"<br>").replace(/^/,"<p>").replace(/$/,"</p>").replace(/<p><\/p>/g,"").replace(/<p>(<h[1234]>)/g,"$1").replace(/(<\/h[1234]>)<\/p>/g,"$1").replace(/<p>(<ul>)/g,"$1").replace(/(<\/ul>)<\/p>/g,"$1").replace(/<p>(<ol>)/g,"$1").replace(/(<\/ol>)<\/p>/g,"$1").replace(/<p>(<table>)/g,"$1").replace(/(<\/table>)<\/p>/g,"$1").replace(/<p>(<hr[^>]*>)<\/p>/g,"$1").replace(/<p>(<img[^>]*>)<\/p>/g,"$1"),n};if(!e)return null;const C=R.find(e=>e.id===n),D=E[C?.color||"indigo"],P=i?{"Lettre officielle":{tips:["üìù Nom et titre du destinataire","üè¢ Entreprise ou organisme","üìã Objet et contexte","üìÖ Dates importantes"],example:"Ex: Lettre √† M. Tremblay, Directeur chez Hydro-Qu√©bec, concernant notre proposition de verre tremp√©. Budget : 150 000$."},"Lettre de partenariat":{tips:["ü§ù Entreprise partenaire","üí° B√©n√©fices mutuels","üìä Volumes et march√©s","üéØ Objectifs communs"],example:"Ex: Partenariat avec Vitrerie Nationale pour distribution exclusive √† Montr√©al. Volume : 500 unit√©s/an."},"R√©ponse fournisseur":{tips:["üì¶ Nom du fournisseur","üìÑ Num√©ro de soumission","‚úÖ Acceptation ou refus","üí∞ Conditions n√©goci√©es"],example:"Ex: R√©ponse √† soumission #2024-089 de Verre & Miroirs Inc. Acceptation avec -5% sur volumes > 1000m¬≤."},"Lettre de remerciement":{tips:["üôè Personne ou organisation","‚≠ê Action √† remercier","üìÖ Date de l'√©v√©nement","üîÆ Collaboration future"],example:"Ex: Remerciement √† Boisvert Construction pour le projet Complexe Desjardins. Livraison z√©ro d√©faut."},"PARI-CNRC":{tips:["üî¨ Innovation technologique","üí∞ Budget (jusqu'√† 80%)","üë• Emplois cr√©√©s","üìà Potentiel commercial"],example:"Ex: Proc√©d√© de trempe basse consommation. Budget: 250k$. Demande: 175k$. 3 postes cr√©√©s."},"Investissement Qu√©bec":{tips:["üè≠ Investissement au Qu√©bec","üë∑ Emplois cr√©√©s","üåç Impact export","üè¢ R√©gion d'implantation"],example:"Ex: Ligne automatis√©e verre tremp√©. 1,2M$. 8 emplois √† Drummondville. Export 25% USA."},"Cr√©dit RS&DE":{tips:["üß™ Incertitudes technologiques","üìä D√©penses admissibles","üìÖ P√©riode couverte","üî¨ Avanc√©es r√©alis√©es"],example:"Ex: Recherche verre feuillet√© architectural 2024. Salaires R&D: 180k$. Mat√©riaux: 45k$."},"Fonds √©cologique":{tips:["üå± Impact environnemental","üìâ R√©ductions (GES, √©nergie)","üíµ Co√ªt et aide demand√©e","üîÑ √âconomie circulaire"],example:"Ex: R√©cup√©ration chaleur fours. -35% √©nergie. -120t CO2/an. Investissement: 85k$."},"Formation Emploi-QC":{tips:["üìö Programme de formation","üë• Employ√©s concern√©s","‚è∞ Dur√©e et calendrier","üéØ Comp√©tences vis√©es"],example:"Ex: Formation CNC 6 op√©rateurs. 40h/pers. Mars-avril 2025. Co√ªt: 18k$."},"Proc√®s-verbal":{tips:["üìÖ Date, heure, lieu","üë• Pr√©sents et absents","üìã Ordre du jour","‚úÖ D√©cisions et actions"],example:"Ex: PV CA du 15 janvier. Pr√©sents: PDG, CFO, COO. Points: Budget Q1, Expansion Montr√©al."},"Politique interne":{tips:["üìú Sujet de la politique","üë• Personnes concern√©es","‚öñÔ∏è Lois applicables","üìÖ Date d'entr√©e en vigueur"],example:"Ex: Politique t√©l√©travail. Employ√©s admin. Max 2j/sem. F√©vrier 2025. Conforme SST QC."},"Contrat type":{tips:["üìù Type de contrat","üë• Parties contractantes","üí∞ Conditions financi√®res","‚è∞ Dur√©e et r√©siliation"],example:"Ex: Contrat fourniture verre. Paiement 30j. Livraison franco. Garantie 5 ans."},"Mise en demeure":{tips:["‚ö†Ô∏è D√©biteur/contrevenant","üí∞ Montant ou pr√©judice","üìÖ D√©lais accord√©s","‚öñÔ∏è Recours l√©gaux"],example:"Ex: Mise en demeure Construction ABC. Facture 45k$ impay√©e 90j. D√©lai: 10 jours."},"Offre d'emploi":{tips:["üíº Poste et responsabilit√©s","üéì Qualifications requises","üí∞ Salaire et avantages","üìç Lieu et horaire"],example:"Ex: Technicien verre. 5 ans exp. DEP. 55-65k$/an + assurances. Drummondville, jour."},"Lettre d'embauche":{tips:["üë§ Nom du candidat","üíº Poste et d√©partement","üìÖ Date d'entr√©e","üí∞ Salaire et conditions"],example:"Ex: Marie Tremblay, Superviseure production. 1er mars. 72k$/an. Probation 3 mois."},"√âvaluation employ√©":{tips:["üë§ Employ√© et poste","üìÖ P√©riode d'√©valuation","üìä Forces et am√©liorations","üéØ Objectifs suivants"],example:"Ex: Jean-Pierre Bouchard, Op√©rateur CNC. 2024. Forces: pr√©cision. Objectif: leadership."},"Fin d'emploi":{tips:["üë§ Nom et poste","üìÖ Dernier jour","üí∞ Indemnit√© de d√©part","üìã Motif si appropri√©"],example:"Ex: Robert Martin, Manutentionnaire. 28 f√©vrier. Motif: abolition poste. Indemnit√©: 8 sem."},"Manuel proc√©dure":{tips:["üîß Processus ou √©quipement","üìã √âtapes principales","‚ö†Ô∏è Points de s√©curit√©","üë• Personnel vis√©"],example:"Ex: Manuel trempe verre 10mm. √âtapes: inspection, chargement, cycle, contr√¥le qualit√©."},"Fiche s√©curit√©":{tips:["‚ö†Ô∏è Produit ou √©quipement","üõ°Ô∏è EPI requis","üö® Risques et urgences","üìû Contacts incident"],example:"Ex: FDS nettoyant industriel. Risques inhalation. EPI: gants, lunettes."},"Sp√©cification technique":{tips:["üìê Produit en d√©tail","üìè Dimensions et tol√©rances","üî¨ Propri√©t√©s physiques","‚úÖ Normes certification"],example:"Ex: Verre tremp√© architectural. 10mm ¬±0.2mm. Flexion 120 MPa. Certif CSA A440."},Checklist:{tips:["üìã Op√©ration ou inspection","‚úÖ Points de v√©rification","üìÖ Fr√©quence","üë§ Responsable"],example:"Ex: Checklist d√©marrage four. Points: temp, pression, huile, convoyeurs. Quotidien."},"Demande financement":{tips:["üí∞ Montant et utilisation","üìä Situation financi√®re","üìà Projections revenus","üè¶ Garanties offertes"],example:"Ex: Marge cr√©dit 500k$ Banque Nationale. CA 2024: 4,2M$. Croissance 15%."},"Plan d'affaires":{tips:["üìä Section √† r√©diger","üéØ Objectifs strat√©giques","üìà Donn√©es financi√®res","üè≠ Avantages concurrentiels"],example:"Ex: Section Analyse de march√©. Verre architectural QC: 180M$/an. Part vis√©e: 12%."},"Justificatif d√©penses":{tips:["üìù Nature des d√©penses","üí∞ Montants et fournisseurs","üìÖ Dates transactions","üìÇ Projet associ√©"],example:"Ex: D√©penses R&D Q4 2024. √âquipement: 25k$. Mat√©riaux: 8k$. Projet: Optimisation."},"Rapport financier":{tips:["üìÖ P√©riode couverte","üìä Indicateurs √† inclure","üìà Comparatifs souhait√©s","üí° Analyses sp√©cifiques"],example:"Ex: Rapport janvier 2025. Revenus, marge, d√©penses, budget vs r√©el, pr√©visions Q1."},"Rapport mensuel":{tips:["üìÖ Donn√©es op√©rationnelles","üìä KPIs automatiques","üë• Performance techniciens","üîß √âtat machines"],example:"Rapport automatique: tickets trait√©s, temps r√©solution, incidents, recommandations."},"Bilan performance":{tips:["üë• √âquipe technique","‚è±Ô∏è Temps r√©ponse/r√©solution","üìà Tendances","üéØ Recommandations"],example:"Bilan: productivit√©/technicien, taux r√©solution, satisfaction, axes am√©lioration."},"√âtat machines":{tips:["üè≠ Parc machines","üìä Disponibilit√© et pannes","üîß Maintenance pr√©ventive","üí∞ Co√ªts maintenance"],example:"Rapport: disponibilit√©/machine, historique pannes, pr√©visions remplacement."},"Incidents critiques":{tips:["üö® Incidents majeurs","‚è±Ô∏è Impact production","üîç Causes racines","‚úÖ Actions correctives"],example:"Rapport: arr√™ts > 2h, pannes majeures, causes, mesures correctives."},"Texte site web":{tips:["üåê Page ou section","üéØ Message cl√©","üë• Public cible","‚ú® Ton souhait√©"],example:"Ex: Page Services. Public: architectes. Message: expertise sur mesure. Ton: professionnel."},"Communiqu√© presse":{tips:["üì∞ Annonce ou √©v√©nement","üìÖ Date diffusion","üé§ Citations dirigeants","üìû Contact m√©dia"],example:"Ex: Acquisition ligne trempe. 1,5M$. 10 emplois. Citation PDG. Diffusion: 1er f√©vrier."},Discours:{tips:["üé§ Occasion et audience","‚è±Ô∏è Dur√©e souhait√©e","üí¨ Messages cl√©s","üéØ Ton d√©sir√©"],example:"Ex: Party No√´l employ√©s. 5 min. Th√®mes: remerciements, bilan 2024, perspectives."},"Pitch commercial":{tips:["üéØ Client cible","üí° Proposition de valeur","üìä Chiffres et r√©f√©rences","‚úÖ Diff√©renciateurs"],example:"Ex: Pitch Pomerleau. Services: verre grands projets. R√©f: Place Ville-Marie."}}[i]:null;return"preview"===p&&l?React.createElement("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-2 sm:p-4",style:{background:"rgba(15, 23, 42, 0.8)",backdropFilter:"blur(4px)"}},React.createElement("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-4xl h-[95vh] sm:h-[90vh] flex flex-col overflow-hidden",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between flex-shrink-0"},React.createElement("div",{className:"flex items-center gap-2 sm:gap-3 text-white min-w-0"},React.createElement("i",{className:"fas fa-file-alt text-lg sm:text-xl flex-shrink-0"}),React.createElement("div",{className:"min-w-0"},React.createElement("h2",{className:"text-base sm:text-lg font-bold truncate"},l.title||"Document"),React.createElement("div",{className:"flex items-center gap-2 mt-0.5"},l.aiModel&&React.createElement("span",{className:"inline-flex items-center gap-1 text-[10px] font-medium bg-white/20 text-white px-1.5 py-0.5 rounded",title:`Mod√®le: ${l.aiModel.model}`},React.createElement("i",{className:"fas fa-microchip text-[8px]"}),"deepseek"===l.aiModel.provider?"DeepSeek":"GPT-4o"),React.createElement("span",{className:"text-[10px] text-emerald-200 hidden sm:inline"},`‚Ä¢ ${new Date(l.generatedAt).toLocaleTimeString("fr-CA",{hour:"2-digit",minute:"2-digit"})}`)))),React.createElement("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0"},React.createElement("button",{onClick:()=>{l?.document&&navigator.clipboard.writeText(l.document).then(()=>window.showToast&&window.showToast("Document copi√©","success"))},className:"p-2 sm:px-3 sm:py-2 bg-white/20 hover:bg-white/30 rounded-lg text-white text-sm transition-all flex items-center gap-1 sm:gap-2",title:"Copier le texte"},React.createElement("i",{className:"fas fa-copy"}),React.createElement("span",{className:"hidden sm:inline"},"Copier")),React.createElement("button",{onClick:async()=>{if(l?.document){window.showToast&&window.showToast("G√©n√©ration du document Word...","info");try{window.docx||await new Promise((e,t)=>{const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.min.js",n.onload=e,n.onerror=t,document.head.appendChild(n)});const{Document:e,Packer:t,Paragraph:n,TextRun:a,Table:i,TableRow:r,TableCell:o,WidthType:s,BorderStyle:c,HeadingLevel:d,AlignmentType:m}=window.docx;let p="Entreprise";try{const e=await fetch("/api/settings/config/public");if(e.ok){const t=await e.json();p=t.company_name||t.company_subtitle||t.company_short_name||"Entreprise"}}catch(e){}const u=l.title||"Document",g=(new Date).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),f=l.document,b=[];b.push(new n({children:[new a({text:p,bold:!0,size:32})],spacing:{after:100}})),b.push(new n({children:[new a({text:u,italics:!0,size:24,color:"666666"})],spacing:{after:100}})),b.push(new n({children:[new a({text:g,size:20,color:"666666"})],alignment:m.RIGHT,spacing:{after:400}}));const h=f.split("\n");let x=0;for(;x<h.length;){const e=h[x];if(e.trim().startsWith("|")&&h[x+1]?.includes("---")){const e=[];for(;x<h.length&&h[x].trim().startsWith("|");)e.push(h[x]),x++;const t=e.filter(e=>!e.includes("---"));if(t.length>0){const e=t[0].split("|").slice(1,-1).length,l=Math.floor(9e3/e),c=t.map((t,i)=>{const c=t.split("|").slice(1,-1).map(e=>e.trim());for(;c.length<e;)c.push("");return new r({children:c.map(e=>new o({children:[new n({children:[new a({text:e||" ",bold:0===i,size:22})]})],width:{size:l,type:s.DXA},shading:0===i?{fill:"E0E0E0"}:void 0,margins:{top:50,bottom:50,left:100,right:100}}))})});b.push(new i({rows:c,width:{size:100,type:s.PERCENTAGE},columnWidths:Array(e).fill(l)})),b.push(new n({text:"",spacing:{after:200}}))}continue}if(e.startsWith("# "))b.push(new n({children:[new a({text:e.replace(/^# /,"").replace(/\*\*/g,""),bold:!0,size:32})],heading:d.HEADING_1,spacing:{before:400,after:200}})),x++;else if(e.startsWith("## "))b.push(new n({children:[new a({text:e.replace(/^## /,"").replace(/\*\*/g,""),bold:!0,size:28})],heading:d.HEADING_2,spacing:{before:300,after:150}})),x++;else if(e.startsWith("### "))b.push(new n({children:[new a({text:e.replace(/^### /,"").replace(/\*\*/g,""),bold:!0,size:24})],heading:d.HEADING_3,spacing:{before:200,after:100}})),x++;else{if(e.trim().startsWith("- ")||e.trim().startsWith("* ")){const t=e.trim().replace(/^[-*]\s+/,"").split(/(\*\*[^*]+\*\*)/g).filter(e=>e).map(e=>e.startsWith("**")&&e.endsWith("**")?new a({text:e.slice(2,-2),bold:!0,size:22}):new a({text:e,size:22}));b.push(new n({children:t,bullet:{level:0},spacing:{after:80}})),x++;continue}if(e.trim()){const t=e.trim().split(/(\*\*[^*]+\*\*)/g).filter(e=>e).map(e=>e.startsWith("**")&&e.endsWith("**")?new a({text:e.slice(2,-2),bold:!0,size:22}):new a({text:e,size:22}));b.push(new n({children:t,spacing:{after:150}}))}x++}}const v=new e({sections:[{children:b}]}),w=await t.toBlob(v),R=URL.createObjectURL(w),E=document.createElement("a");E.href=R,E.download=`${u.replace(/[^a-zA-Z0-9√†√¢√§√©√®√™√´√Ø√Æ√¥√π√ª√º√ß\s-]/gi,"").substring(0,50)}.docx`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(R),window.showToast&&window.showToast("Document Word export√© avec succ√®s","success")}catch(e){console.error("Erreur export DOCX:",e),window.showToast&&window.showToast("Erreur export Word, tentative HTML...","warning"),(async()=>{if(!l?.document)return;const e="correspondance"===n,t=$(l.document,e),a=l.title||"Document";let i="Entreprise";try{const e=await fetch("/api/settings/config/public");if(e.ok){const t=await e.json();i=t.company_name||t.company_subtitle||t.company_short_name||"Entreprise"}}catch(e){}const r=(new Date).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),o=new Blob([`<!DOCTYPE html>\n<html lang="fr">\n<head>\n<meta charset="UTF-8">\n<title>${a}</title>\n<style>\nbody { font-family: 'Times New Roman', Georgia, serif; font-size: 12pt; line-height: 1.6; color: #000; max-width: 800px; margin: 40px auto; padding: 20px; }\nh1 { font-size: 18pt; font-weight: bold; margin: 24pt 0 12pt; border-bottom: 1px solid #000; padding-bottom: 6pt; }\nh2 { font-size: 14pt; font-weight: bold; margin: 18pt 0 10pt; }\nh3 { font-size: 12pt; font-weight: bold; margin: 14pt 0 8pt; }\np { margin: 0 0 10pt; text-align: justify; }\nul, ol { margin: 8pt 0 12pt 24pt; }\nli { margin: 4pt 0; }\ntable { width: 100%; border-collapse: collapse; margin: 12pt 0; }\nth { background: #f0f0f0; border: 1px solid #000; padding: 8pt; text-align: left; font-weight: bold; }\ntd { border: 1px solid #000; padding: 8pt; }\nblockquote { border-left: 3pt solid #ccc; padding-left: 12pt; margin: 12pt 0; font-style: italic; color: #333; }\n.header { border-bottom: 2px solid #000; padding-bottom: 12pt; margin-bottom: 24pt; }\n.header-title { font-size: 16pt; font-weight: bold; }\n.header-subtitle { font-size: 10pt; color: #666; }\n.header-date { font-size: 10pt; text-align: right; }\n</style>\n</head>\n<body>\n<div class="header">\n<div class="header-title">${i}</div>\n<div class="header-subtitle">${a}</div>\n<div class="header-date">${r}</div>\n</div>\n${t}\n</body>\n</html>`],{type:"text/html;charset=utf-8"}),s=URL.createObjectURL(o),c=document.createElement("a");c.href=s,c.download=`${a.replace(/[^a-zA-Z0-9√†√¢√§√©√®√™√´√Ø√Æ√¥√π√ª√º√ß\s-]/gi,"").substring(0,50)}.html`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(s),window.showToast&&window.showToast("Document export√© (ouvrir avec Word/Pages)","success")})()}}},className:"p-2 sm:px-3 sm:py-2 bg-white/20 hover:bg-white/30 rounded-lg text-white text-sm transition-all flex items-center gap-1 sm:gap-2",title:"Exporter pour Word/Pages (.docx)"},React.createElement("i",{className:"fas fa-file-word"}),React.createElement("span",{className:"hidden sm:inline"},"Word")),React.createElement("button",{onClick:async()=>{if(!l)return;let e="Entreprise",t="/api/settings/logo";try{const n=await axios.get("/api/settings/config/public");n.data&&(e=n.data.company_name||n.data.company_subtitle||n.data.company_short_name||"Entreprise",n.data.company_logo_url&&(t=n.data.company_logo_url))}catch(e){}const a=["rapports","subventions","rh"].includes(n),i="correspondance"===n,r=(new Date).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),o=$(l.document,i),s=l.title||"Document",c=`<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>${s}</title>\n<style>\n@page { size: A4; margin: ${i?"20mm 20mm 20mm 20mm":"15mm 18mm 15mm 18mm"}; }\n* { box-sizing: border-box; margin: 0; padding: 0; }\nhtml, body { width: 100%; }\nbody { font-family: ${i?"'Times New Roman', Times, serif":"'Georgia', serif"}; font-size: ${i?"12pt":"11pt"}; line-height: ${i?"1.8":"1.5"}; color: #000; padding: ${i?"0":"10mm 12mm"}; max-width: 100%; }\n\n/* Container principal avec marges de s√©curit√© */\n.print-container { max-width: 100%; overflow-wrap: break-word; word-wrap: break-word; }\n\n/* Header corporate */\n.print-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 8pt; margin-bottom: 16pt; border-bottom: 1pt solid #000; }\n.print-header-left { display: flex; align-items: center; gap: 10px; }\n.print-header-left img { height: 32px; }\n.print-header-left .brand { border-left: 1pt solid #000; padding-left: 8px; }\n.print-header-left .brand-name { font-family: Arial, sans-serif; font-size: 12pt; font-weight: 700; color: #000; }\n.print-header-left .brand-sub { font-family: Arial, sans-serif; font-size: 8pt; color: #333; }\n.print-header-right { font-family: Arial, sans-serif; font-size: 9pt; color: #333; }\n\n/* DOCUMENT OFFICIEL - NOIR ET BLANC */\n.doc-content { font-family: ${i?"'Times New Roman', Times, serif":"'Georgia', 'Times New Roman', serif"}; font-size: ${i?"12pt":"11pt"}; line-height: ${i?"1.8":"1.6"}; color: #000; }\n.doc-content h1 { font-family: Arial, sans-serif; font-size: 14pt; font-weight: 700; color: #000; margin: 18pt 0 12pt; padding-bottom: 4pt; border-bottom: 1.5pt solid #000; text-transform: uppercase; letter-spacing: 0.5px; }\n.doc-content h2 { font-family: Arial, sans-serif; font-size: 12pt; font-weight: 700; color: #000; margin: 16pt 0 8pt; padding-bottom: 3pt; border-bottom: 0.5pt solid #000; }\n.doc-content h3 { font-family: Arial, sans-serif; font-size: 11pt; font-weight: 700; color: #000; margin: 12pt 0 6pt; }\n.doc-content h4 { font-family: Arial, sans-serif; font-size: 10pt; font-weight: 700; color: #000; margin: 10pt 0 4pt; }\n.doc-content p { margin: 0 0 ${i?"12pt":"8pt"}; text-align: ${i?"left":"justify"}; }\n.doc-content ul, .doc-content ol { margin: 4pt 0 8pt; padding-left: 18pt; }\n.doc-content li { margin: 1pt 0; line-height: 1.4; }\n.doc-content blockquote { border-left: 2pt solid #000; padding: 6pt 12pt; margin: 10pt 0 10pt 16pt; font-style: italic; }\n.doc-content table { width: 100%; border-collapse: collapse; margin: 12pt 0; font-size: 9pt; }\n.doc-content th { background: #f5f5f5; border: 0.5pt solid #000; padding: 6pt 8pt; text-align: left; font-weight: 700; font-family: Arial, sans-serif; }\n.doc-content td { border: 0.5pt solid #000; padding: 5pt 8pt; }\n.doc-content hr { border: none; border-top: 0.5pt solid #ccc; margin: 12pt 0; }\n.doc-content strong { font-weight: 700; }\n/* Titres de section inline (gras en d√©but de paragraphe) - ligne discr√®te au-dessus */\n.doc-content p > strong:first-child { display: inline-block; margin-top: 8pt; padding-top: 6pt; border-top: 0.5pt solid #ddd; }\n.doc-content p:first-child > strong:first-child { border-top: none; margin-top: 0; padding-top: 0; }\n\n/* Style sp√©cifique pour les lettres */\n.letter-block { margin-bottom: 16pt; line-height: 1.5; }\n.letter-block:first-child { margin-bottom: 28pt; font-weight: 700; font-size: 13pt; } /* En-t√™te entreprise */\n.letter-block:first-child strong { font-size: 14pt; }\n.letter-block strong { font-weight: 700; }\n\n/* Section wrapper pour √©viter les coupures */\n.section { page-break-inside: avoid; }\n\n@media print {\n  @page { margin: ${i?"20mm":"15mm 18mm"}; }\n  body { padding: 0; margin: 0; }\n  .print-header { page-break-inside: avoid; margin-bottom: 10pt; }\n  /* √âviter de couper les titres et leur contenu imm√©diat */\n  .doc-content h1, .doc-content h2, .doc-content h3, .doc-content h4 { \n    page-break-after: avoid;\n    page-break-inside: avoid;\n  }\n  /* Garder les listes avec leur titre */\n  .doc-content h2 + ul, .doc-content h2 + ol,\n  .doc-content h3 + ul, .doc-content h3 + ol { page-break-before: avoid; }\n  /* √âviter de couper les √©l√©ments de liste */\n  .doc-content li { page-break-inside: avoid; }\n  .doc-content table { page-break-inside: auto; }\n  .doc-content tr { page-break-inside: avoid; }\n  .doc-content thead { display: table-header-group; }\n  .doc-content p { orphans: 3; widows: 3; }\n}\n\n/* Bloc signature manuelle (√† signer au stylo) */\n.manual-signature-block {\n  margin: 24pt 0 16pt 0;\n  page-break-inside: avoid;\n}\n.signature-space {\n  height: 70pt; /* ~2.5cm d'espace pour signer */\n}\n.signature-line-manual {\n  width: 200px;\n  border-bottom: 2px solid #333;\n  margin-top: 4pt;\n}\n\n/* Bloc signature image (signature num√©rique) - aspect naturel */\n.signature-block {\n  display: inline-block;\n  margin: 16pt 0 8pt 0;\n}\n.signature-block img {\n  display: block;\n  max-height: 70px;\n  width: auto;\n  margin: 0;\n  border: none !important;\n  box-shadow: none !important;\n  background: transparent;\n}\n.signature-line {\n  width: 180px;\n  border-bottom: 1px solid #333;\n  margin-top: 2pt;\n}\n\n/* Footer - Avertissement confidentialit√© - EN FIN DE DOCUMENT (pas fixe) */\n.print-footer {\n  margin-top: 40pt;\n  padding: 12pt 0;\n  border-top: 0.5pt solid #999;\n  font-family: Arial, sans-serif;\n  font-size: 8pt;\n  color: #666;\n  text-align: center;\n}\n.print-footer-content {\n  line-height: 1.4;\n}\n@media print {\n  .print-footer { page-break-inside: avoid; margin-top: 30pt; }\n  .manual-signature-block { page-break-inside: avoid; margin: 24pt 0 16pt 0; }\n  .signature-space { height: 70pt !important; min-height: 70pt !important; display: block; }\n  .signature-line-manual { width: 200px; border-bottom: 2px solid #333 !important; display: block; }\n  .signature-line { border-bottom: 2px solid #333 !important; }\n  .signature-block img { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }\n}\n</style></head>\n<body>\n<div class="print-container">\n  <div class="print-header">\n    <div class="print-header-left">\n      <img src="${t}" onerror="this.style.display='none'">\n      <div class="brand">\n        <div class="brand-name">${e}</div>\n        <div class="brand-sub">${s}</div>\n      </div>\n    </div>\n    <div class="print-header-right">${r}</div>\n  </div>\n  <div class="doc-content">${o}</div>\n  ${a?`<div class="print-footer">\n  <div class="print-footer-content">\n    <strong>CONFIDENTIEL</strong> ‚Äî Ce document est la propri√©t√© exclusive de ${e}. \n    Toute reproduction, distribution ou divulgation sans autorisation √©crite est strictement interdite.\n    </div>\n  </div>`:""}\n</div>\n</body></html>`,d=window.open("","_blank");d?(d.document.write(c),d.document.close(),d.onload=()=>setTimeout(()=>{d.focus(),d.print()},250)):window.showToast&&window.showToast("Popup bloqu√©e","error")},className:"p-2 sm:px-3 sm:py-2 bg-white text-emerald-600 rounded-lg text-sm font-semibold transition-all flex items-center gap-1 sm:gap-2",title:"Imprimer / PDF"},React.createElement("i",{className:"fas fa-print"}),React.createElement("span",{className:"hidden sm:inline"},"Imprimer")),React.createElement("button",{onClick:t,className:"ml-1 w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-white/20 hover:bg-white/30 flex items-center justify-center text-white"},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"flex-1 overflow-y-auto bg-slate-100 p-3 sm:p-6"},React.createElement("div",{className:"bg-white rounded-lg sm:rounded-xl shadow-lg max-w-3xl mx-auto"},React.createElement("div",{className:"p-4 sm:p-8 md:p-12"},React.createElement("style",{},"\n        /* STYLE DOCUMENT OFFICIEL - Rapport professionnel */\n        .doc-content { \n            font-family: 'Georgia', 'Times New Roman', Times, serif; \n            font-size: 11pt; \n            line-height: 1.7; \n            color: #1a1a1a; \n        }\n        \n        /* Titres - Style rapport officiel */\n        .doc-content h1 { \n            font-family: 'Arial', 'Helvetica', sans-serif;\n            font-size: 16pt; \n            font-weight: 700; \n            color: #000000; \n            margin: 24pt 0 16pt; \n            padding-bottom: 6pt; \n            border-bottom: 2pt solid #1a1a1a; \n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        .doc-content h2 { \n            font-family: 'Arial', 'Helvetica', sans-serif;\n            font-size: 12pt; \n            font-weight: 700; \n            color: #000; \n            margin: 16pt 0 8pt; \n            padding-bottom: 3pt;\n            border-bottom: 0.5pt solid #000;\n        }\n        .doc-content h3 { \n            font-family: 'Arial', 'Helvetica', sans-serif;\n            font-size: 11pt; \n            font-weight: 700; \n            color: #333333; \n            margin: 14pt 0 8pt; \n        }\n        .doc-content h4 { \n            font-family: 'Arial', 'Helvetica', sans-serif;\n            font-size: 10pt; \n            font-weight: 600; \n            color: #444444; \n            margin: 10pt 0 6pt; \n        }\n        \n        /* Paragraphes */\n        .doc-content p { \n            margin: 0 0 10pt; \n            text-align: justify; \n        }\n        \n        /* Listes - espacement compact */\n        .doc-content ul, .doc-content ol { \n            margin: 4pt 0 8pt; \n            padding-left: 18pt; \n        }\n        .doc-content li { \n            margin: 1pt 0;\n            line-height: 1.4;\n        }\n        \n        /* Citations - Style sobre pour documents */\n        .doc-content blockquote { \n            border-left: 3pt solid #666666; \n            padding: 8pt 16pt; \n            margin: 12pt 0 12pt 20pt; \n            font-style: italic;\n            color: #444444;\n            background: #fafafa;\n        }\n        \n        /* Tableaux - Style rapport officiel */\n        .doc-content .table-wrapper {\n            width: 100%;\n            overflow-x: auto;\n            -webkit-overflow-scrolling: touch;\n            margin: 14pt 0;\n        }\n        .doc-content table { \n            width: 100%; \n            min-width: 500px; /* Force scroll on small screens */\n            border-collapse: collapse; \n            font-size: 10pt; \n        }\n        .doc-content th { \n            background-color: #f5f5f5 !important; \n            border: 0.5pt solid #000 !important; \n            padding: 6pt 8pt; \n            text-align: left; \n            font-weight: 700; \n            font-family: 'Arial', 'Helvetica', sans-serif;\n            color: #000 !important;\n            white-space: nowrap;\n        }\n        .doc-content td { \n            border: 0.5pt solid #000 !important; \n            padding: 5pt 8pt;\n            min-width: 80px;\n        }\n        .doc-content tr:nth-child(even) td { \n            background-color: transparent !important; \n        }\n        \n        /* Mobile: hint de scroll */\n        @media (max-width: 640px) {\n            .doc-content .table-wrapper {\n                position: relative;\n            }\n            .doc-content .table-wrapper::after {\n                content: '‚Üí glisser';\n                position: absolute;\n                top: 0;\n                right: 0;\n                background: linear-gradient(to left, rgba(255,255,255,0.95), transparent);\n                padding: 4px 8px 4px 24px;\n                font-size: 9px;\n                color: #666;\n                pointer-events: none;\n            }\n            .doc-content table {\n                font-size: 9pt;\n            }\n            .doc-content th, .doc-content td {\n                padding: 4pt 6pt;\n            }\n        }\n        \n        /* S√©parateurs - discrets */\n        .doc-content hr, .doc-content .doc-separator { \n            border: none; \n            border-top: 0.5pt solid #ccc; \n            margin: 12pt 0; \n        }\n        \n        /* Autres √©l√©ments */\n        .doc-content img { \n            max-width: 100%; \n            height: auto; \n            margin: 12pt 0; \n            display: block; \n        }\n        \n        /* Bloc signature image - aspect naturel */\n        .doc-content .signature-block {\n            display: inline-block;\n            margin: 16pt 0 8pt 0;\n        }\n        .doc-content .signature-block img {\n            display: block;\n            max-height: 70px;\n            width: auto;\n            margin: 0;\n            border: none !important;\n            box-shadow: none !important;\n            background: transparent;\n        }\n        .doc-content .signature-line {\n            width: 180px;\n            border-bottom: 1px solid #333;\n            margin-top: 2pt;\n        }\n        \n        /* Bloc signature manuelle */\n        .doc-content .manual-signature-block {\n            margin: 20pt 0 12pt 0;\n        }\n        .doc-content .signature-space {\n            height: 60pt;\n        }\n        .doc-content .signature-line-manual {\n            width: 200px;\n            border-bottom: 1px solid #333;\n        }\n        .doc-content a { \n            color: #0066cc; \n            text-decoration: underline; \n        }\n        .doc-content code { \n            background: #f5f5f5; \n            padding: 1pt 4pt; \n            font-family: 'Courier New', monospace; \n            font-size: 10pt; \n        }\n        .doc-content strong { \n            font-weight: 700; \n        }\n        \n        /* Titres de section inline - ligne discr√®te au-dessus */\n        .doc-content p > strong:first-child {\n            display: inline-block;\n            margin-top: 8pt;\n            padding-top: 6pt;\n            border-top: 0.5pt solid #ddd;\n        }\n        .doc-content p:first-child > strong:first-child {\n            border-top: none;\n            margin-top: 0;\n            padding-top: 0;\n        }\n        \n        /* Style pour les lettres - blocs bien espac√©s */\n        .letter-block {\n            margin-bottom: 16pt;\n            line-height: 1.5;\n        }\n        .letter-block:first-child {\n            margin-bottom: 28pt;\n            font-weight: 700;\n            font-size: 13pt;\n        }\n        .letter-block:first-child strong {\n            font-size: 14pt;\n        }\n        \n        /* Contr√¥le des sauts de page pour impression */\n        @media print {\n            .doc-content h1, .doc-content h2, .doc-content h3, .doc-content h4 { \n                page-break-after: avoid;\n                page-break-inside: avoid; \n            }\n            .doc-content p { \n                orphans: 3;\n                widows: 3;\n            }\n            .doc-content table, .doc-content blockquote { \n                page-break-inside: avoid; \n            }\n            .doc-content li { \n                page-break-inside: avoid; \n            }\n        }\n    "),React.createElement("div",{className:"doc-content",dangerouslySetInnerHTML:{__html:$(l.document,"correspondance"===n)}})))),React.createElement("div",{className:"px-4 sm:px-6 py-3 sm:py-4 bg-white border-t flex items-center justify-between flex-shrink-0"},React.createElement("button",{onClick:()=>{c(null),u("form"),s(""),r(null),f("categories")},className:"px-3 sm:px-5 py-2 text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg sm:rounded-xl flex items-center gap-2"},React.createElement("i",{className:"fas fa-plus"}),React.createElement("span",{className:"hidden sm:inline"},"Nouveau")),React.createElement("button",{onClick:t,className:"px-4 sm:px-5 py-2 text-sm font-medium text-white bg-slate-800 rounded-lg sm:rounded-xl"},"Fermer")))):React.createElement("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-2 sm:p-4",style:{background:"rgba(15, 23, 42, 0.7)",backdropFilter:"blur(4px)"}},React.createElement("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-5xl h-[95vh] sm:max-h-[92vh] flex flex-col overflow-hidden",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between flex-shrink-0"},React.createElement("div",{className:"flex items-center gap-3"},!b&&"form"===g&&React.createElement("button",{onClick:()=>f("categories"),className:"sm:hidden w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center text-white mr-1"},React.createElement("i",{className:"fas fa-arrow-left"})),React.createElement("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl ${b?"bg-gradient-to-br from-violet-500 to-fuchsia-500":"bg-white/10"} flex items-center justify-center flex-shrink-0`},React.createElement("i",{className:`fas ${b?"fa-magic":"fa-file-signature"} text-lg sm:text-2xl text-white`})),React.createElement("div",{className:"min-w-0"},React.createElement("h2",{className:"text-base sm:text-xl font-bold text-white truncate"},b?"Assistant Universel":"Secr√©tariat"),React.createElement("p",{className:"text-xs text-slate-400 hidden sm:block"},b?"D√©tection automatique du type":"Documents professionnels"))),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("button",{onClick:()=>{h(!b),b||(r(null),s(""))},className:"px-3 py-1.5 rounded-lg text-xs font-medium transition-all "+(b?"bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white shadow-lg":"bg-white/10 hover:bg-white/20 text-white"),title:b?"Retour au mode cat√©gories":"Mode assistant universel"},React.createElement("i",{className:`fas ${b?"fa-th-large":"fa-magic"} mr-1.5`}),React.createElement("span",{className:"hidden sm:inline"},b?"Cat√©gories":"Universel")),React.createElement("button",{onClick:t,className:"w-9 h-9 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-white/10 hover:bg-white/20 flex items-center justify-center text-white"},React.createElement("i",{className:"fas fa-times"})))),React.createElement("div",{className:"flex flex-1 min-h-0"},b?React.createElement("div",{className:"flex-1 flex flex-col min-h-0"},React.createElement("div",{className:"flex-1 min-h-0 overflow-y-auto p-4 sm:p-6 bg-gradient-to-br from-slate-50 to-violet-50"},React.createElement("div",{className:"max-w-2xl mx-auto"},React.createElement("div",{className:"text-center mb-6"},React.createElement("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-100 to-fuchsia-100 rounded-full mb-3"},React.createElement("i",{className:"fas fa-magic text-violet-600"}),React.createElement("span",{className:"text-sm font-medium text-violet-700"},"D√©tection automatique")),React.createElement("h3",{className:"text-lg font-bold text-slate-800 mb-2"},"D√©crivez simplement ce dont vous avez besoin"),React.createElement("p",{className:"text-sm text-slate-600"},"L'assistant d√©tectera automatiquement le type de document et utilisera les donn√©es appropri√©es.")),React.createElement("div",{className:"bg-white rounded-xl shadow-lg p-4 sm:p-6 border border-slate-200"},React.createElement("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700 mb-3"},React.createElement("i",{className:"fas fa-pen-fancy text-violet-500"}),"Votre demande"),React.createElement("textarea",{value:o,onChange:e=>s(e.target.value),placeholder:'Exemples :\n‚Ä¢ "G√©n√®re un rapport mensuel de maintenance avec les KPIs"\n‚Ä¢ "R√©dige une lettre √† Hydro-Qu√©bec pour proposer nos services"\n‚Ä¢ "Cr√©e une offre d\'emploi pour un technicien de maintenance"\n‚Ä¢ "Communiqu√© de presse pour annoncer notre nouvelle ligne de production"',rows:8,className:"w-full px-4 py-3 rounded-lg border border-slate-200 focus:border-violet-400 focus:ring-2 focus:ring-violet-100 outline-none resize-none text-sm text-slate-700 placeholder-slate-400 bg-slate-50"}),React.createElement("div",{className:"mt-4 pt-4 border-t border-slate-100"},React.createElement("p",{className:"text-xs font-medium text-slate-500 mb-2"},"Suggestions rapides :"),React.createElement("div",{className:"flex flex-wrap gap-2"},["Rapport mensuel maintenance","Lettre officielle","Offre d'emploi","Communiqu√© de presse","Demande de subvention"].map((e,t)=>React.createElement("button",{key:t,onClick:()=>s(e),className:"px-3 py-1.5 text-xs bg-slate-100 hover:bg-violet-100 text-slate-600 hover:text-violet-700 rounded-full transition-all"},e))))),React.createElement("p",{className:"mt-4 text-center text-xs text-slate-500"},React.createElement("i",{className:"fas fa-info-circle mr-1"}),"L'Agent IGP analysera votre demande et choisira le cerveau sp√©cialis√© appropri√© (Rapports, RH, Correspondance, etc.)"))),React.createElement("div",{className:"px-4 sm:px-6 py-3 sm:py-4 bg-white border-t flex-shrink-0"},d&&React.createElement("div",{className:"mb-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-200"},React.createElement("i",{className:"fas fa-brain text-white fa-beat-fade"})),React.createElement("div",{className:"flex-1 min-w-0"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("p",{className:"text-sm font-semibold text-blue-900"},"G√©n√©ration en cours"),React.createElement("span",{className:"text-xs font-mono bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded"},`${x}s`)),React.createElement("p",{className:"text-xs text-blue-600 mt-0.5"},x<5?"üîç Analyse de votre demande...":x<12?"üß† S√©lection du mod√®le IA optimal...":x<25?"‚úçÔ∏è R√©daction par l'assistant IA...":x<45?"üìù Structuration du document...":x<70?"üé® Mise en forme professionnelle...":x<90?"‚ú® R√©vision et finition...":"üöÄ Presque termin√©...")),React.createElement("div",{className:"hidden sm:flex items-center gap-2 px-2 py-1 bg-white/80 rounded-lg border border-blue-100"},React.createElement("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),React.createElement("span",{className:"text-xs font-medium text-slate-600"},"IA active"))),React.createElement("div",{className:"mt-2 h-1 bg-blue-100 rounded-full overflow-hidden"},React.createElement("div",{className:"h-full bg-gradient-to-r from-blue-500 to-indigo-500 transition-all duration-1000 rounded-full",style:{width:`${Math.min(x/90*100,95)}%`}}))),React.createElement("div",{className:"flex items-center justify-end gap-3"},React.createElement("button",{onClick:t,disabled:d,className:"px-4 py-2 text-sm font-medium rounded-lg "+(d?"text-slate-400 bg-slate-50 cursor-not-allowed":"text-slate-600 bg-slate-100 hover:bg-slate-200")},"Annuler"),React.createElement("button",{onClick:k,disabled:d||!o.trim(),className:"px-5 py-2.5 text-sm font-semibold text-white rounded-lg flex items-center gap-2 "+(d||!o.trim()?"bg-slate-300 cursor-not-allowed":"bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-700 hover:to-fuchsia-700 shadow-lg shadow-violet-200")},d?React.createElement("i",{className:"fas fa-circle-notch fa-spin"}):React.createElement("i",{className:"fas fa-magic"}),React.createElement("span",{},d?`${x}s...`:"G√©n√©rer"))))):React.createElement(React.Fragment,null,React.createElement("div",{className:("categories"===g?"flex":"hidden")+" sm:flex flex-col w-full sm:w-48 lg:w-52 bg-slate-50 border-r border-slate-200 flex-shrink-0 overflow-y-auto"},React.createElement("div",{className:"p-3 border-b border-slate-200 bg-white sm:bg-transparent sticky top-0 z-10"},React.createElement("div",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider"},"Cat√©gories")),React.createElement("div",{className:"p-2"},R.map(e=>{const t=E[e.color],a=n===e.id;return React.createElement("button",{key:e.id,onClick:()=>N(e.id),className:"w-full flex items-center gap-2.5 px-3 py-2.5 sm:py-2 rounded-lg mb-1 transition-all text-left "+(a?`${t.light} ${t.text} ring-1 ${t.ring}`:"hover:bg-white text-slate-600")},React.createElement("div",{className:`w-8 h-8 sm:w-7 sm:h-7 rounded-lg ${a?t.bg:"bg-slate-200"} flex items-center justify-center`},React.createElement("i",{className:`fas ${e.icon} text-sm sm:text-xs ${a?"text-white":"text-slate-500"}`})),React.createElement("span",{className:"text-sm font-medium flex-1"},e.label),React.createElement("i",{className:"fas fa-chevron-right text-xs text-slate-400 sm:hidden"}))})),React.createElement("div",{className:"sm:hidden border-t border-slate-200 bg-white sticky bottom-0 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]"},React.createElement("div",{className:"p-3 pb-2"},React.createElement("div",{className:"flex items-center gap-2 mb-2"},React.createElement("i",{className:`fas ${C?.icon} ${D.text}`}),React.createElement("span",{className:"text-sm font-semibold text-slate-800"},C?.label))),React.createElement("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2 max-h-[40vh] overflow-y-auto"},(C?.documents||[]).map((e,t)=>React.createElement("button",{key:t,onClick:()=>y(e),className:"flex items-center gap-2 px-3 py-2.5 rounded-lg text-left text-sm bg-slate-50 hover:bg-slate-100 text-slate-700 border border-slate-200"},React.createElement("i",{className:`fas ${e.icon} text-xs text-slate-400`}),React.createElement("span",{className:"truncate flex-1"},e.label)))))),React.createElement("div",{className:("form"===g?"flex":"hidden")+" sm:flex flex-1 flex-col min-h-0"},React.createElement("div",{className:"hidden sm:block p-4 border-b border-slate-200 bg-white flex-shrink-0"},React.createElement("div",{className:"flex items-center gap-2 mb-2"},React.createElement("i",{className:`fas ${C?.icon} ${D.text}`}),React.createElement("h3",{className:"text-sm font-semibold text-slate-800"},C?.label)),React.createElement("div",{className:"flex flex-wrap gap-2"},(C?.documents||[]).map((e,t)=>{const n=i===e.label;return React.createElement("button",{key:t,onClick:()=>y(e),className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-all "+(n?`${D.light} ${D.text} ring-1 ${D.ring}`:"bg-slate-100 hover:bg-slate-200 text-slate-700")},React.createElement("i",{className:`fas ${e.icon} text-xs`}),React.createElement("span",{},e.label))}))),React.createElement("div",{className:"flex-1 min-h-0 overflow-y-auto bg-slate-50 p-3 sm:p-4"},i&&React.createElement("div",{className:"sm:hidden mb-3 flex items-center gap-2"},React.createElement("div",{className:`px-3 py-1.5 rounded-full ${D.light} ${D.text} text-sm font-medium flex items-center gap-2`},React.createElement("i",{className:"fas fa-file-alt text-xs"}),i)),P&&React.createElement("div",{className:`mb-3 p-3 rounded-lg border ${D.border} ${D.light}`},React.createElement("div",{className:"flex items-center gap-2 mb-2"},React.createElement("i",{className:`fas fa-lightbulb ${D.text} text-sm`}),React.createElement("span",{className:`text-xs font-semibold ${D.text}`},"Conseils")),React.createElement("div",{className:"grid grid-cols-2 gap-1.5 mb-2"},P.tips.map((e,t)=>React.createElement("div",{key:t,className:"text-xs text-slate-600"},e))),React.createElement("p",{className:"text-xs text-slate-500 italic border-t border-slate-200 pt-2 mt-1"},P.example)),React.createElement("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700 mb-2"},React.createElement("i",{className:"fas fa-pen text-slate-400 text-xs"}),"Instructions"),React.createElement("textarea",{value:o,onChange:e=>s(e.target.value),placeholder:i?`D√©crivez votre ${i.toLowerCase()}...`:"S√©lectionnez un type de document...",rows:6,className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 focus:border-slate-400 focus:ring-2 focus:ring-slate-100 outline-none resize-none text-sm text-slate-700 placeholder-slate-400 bg-white"}),(()=>{const e=((e,t)=>{if(!e||e.length<10)return null;const n=e.toLowerCase();for(const[e,a]of Object.entries(w))if(e!==t&&a.keywords.filter(e=>n.includes(e)).length>=2){const i=w[t];if(i?.notFor?.some(e=>n.includes(e)))return{suggestedCategory:e,suggestedLabel:R.find(t=>t.id===e)?.label||e,reason:a.description}}return null})(o,n);return e?React.createElement("div",{className:"mt-2 p-3 bg-amber-50 border border-amber-200 rounded-lg"},React.createElement("div",{className:"flex items-start gap-2"},React.createElement("i",{className:"fas fa-exclamation-triangle text-amber-500 mt-0.5"}),React.createElement("div",{className:"flex-1"},React.createElement("p",{className:"text-sm font-medium text-amber-800"},`Cette demande semble mieux convenir √† la cat√©gorie "${e.suggestedLabel}"`),React.createElement("p",{className:"text-xs text-amber-600 mt-1"},e.reason),React.createElement("button",{onClick:()=>N(e.suggestedCategory),className:"mt-2 text-xs font-medium text-amber-700 hover:text-amber-900 underline"},`‚Üí Basculer vers ${e.suggestedLabel}`)))):null})(),n&&w[n]&&React.createElement("div",{className:"mt-2 p-2 bg-slate-50 rounded-lg border border-slate-100"},React.createElement("p",{className:"text-xs text-slate-600"},React.createElement("i",{className:"fas fa-lightbulb text-slate-400 mr-1"}),React.createElement("strong",{},`${R.find(e=>e.id===n)?.label}: `),w[n].description)),React.createElement("p",{className:"mt-2 text-xs text-slate-500"},React.createElement("i",{className:"fas fa-info-circle mr-1"}),"L'Agent IGP utilise les lois CA/QC et vos donn√©es.")),React.createElement("div",{className:"px-3 sm:px-4 py-3 bg-white border-t flex-shrink-0"},d&&React.createElement("div",{className:"mb-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-200"},React.createElement("i",{className:"fas fa-brain text-white fa-beat-fade"})),React.createElement("div",{className:"flex-1 min-w-0"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("p",{className:"text-sm font-semibold text-blue-900"},"G√©n√©ration en cours"),React.createElement("span",{className:"text-xs font-mono bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded"},`${x}s`)),React.createElement("p",{className:"text-xs text-blue-600 mt-0.5"},x<5?"üîç Analyse de votre demande...":x<12?"üß† S√©lection du mod√®le IA optimal...":x<25?"‚úçÔ∏è R√©daction par l'assistant IA...":x<45?"üìù Structuration du document...":x<70?"üé® Mise en forme professionnelle...":x<90?"‚ú® R√©vision et finition...":"üöÄ Presque termin√©...")),React.createElement("div",{className:"hidden sm:flex items-center gap-2 px-2 py-1 bg-white/80 rounded-lg border border-blue-100"},React.createElement("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),React.createElement("span",{className:"text-xs font-medium text-slate-600"},"IA active"))),React.createElement("div",{className:"mt-2 h-1 bg-blue-100 rounded-full overflow-hidden"},React.createElement("div",{className:"h-full bg-gradient-to-r from-blue-500 to-indigo-500 transition-all duration-1000 rounded-full",style:{width:`${Math.min(x/90*100,95)}%`}}))),React.createElement("div",{className:"flex items-center justify-end gap-2"},React.createElement("button",{onClick:t,disabled:d,className:"px-4 py-2 text-sm font-medium rounded-lg "+(d?"text-slate-400 bg-slate-50 cursor-not-allowed":"text-slate-600 bg-slate-100 hover:bg-slate-200")},"Annuler"),React.createElement("button",{onClick:k,disabled:d||!o.trim(),className:"px-4 sm:px-5 py-2 text-sm font-semibold text-white rounded-lg flex items-center gap-2 "+(d||!o.trim()?"bg-slate-300 cursor-not-allowed":"bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 shadow-lg shadow-indigo-200")},d?React.createElement("i",{className:"fas fa-circle-notch fa-spin"}):React.createElement("i",{className:"fas fa-wand-magic-sparkles"}),React.createElement("span",{},d?`${x}s...`:"G√©n√©rer")))))))))};window.SecretariatModal=SecretariatModal;