const UserManagementModal=({show:e,onClose:s,currentUser:t,onOpenMessage:a})=>{const[r,o]=React.useState([]),[n,c]=React.useState(!0),[l,m]=React.useState(!1),[i,u]=React.useState(null),[h,w]=React.useState({show:!1,message:"",type:"info"}),[g,p]=React.useState({show:!1,message:"",onConfirm:null}),[f,d]=React.useState({show:!1,message:"",onConfirm:null}),[R,y]=React.useState({show:!1,message:"",type:"success"});React.useEffect(()=>{if(e){E();const e=setInterval(()=>{E(!0)},12e4);return()=>clearInterval(e)}},[e]),React.useEffect(()=>{e||(u(null),m(!1))},[e]),React.useEffect(()=>{const t=t=>{"Escape"===t.key&&(f.show?d({show:!1,message:"",onConfirm:null}):g.show?p({show:!1,message:"",onConfirm:null}):h.show?w({show:!1,message:"",type:"info"}):i?u(null):l?m(!1):e&&s())};if(e)return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[e,f.show,g.show,h.show,i,l]);const E=async(e=!1)=>{try{e||c(!0);const s="/users/team",t=await axios.get(API_URL+s);o(Array.isArray(t.data.users)?t.data.users:[])}catch(s){e||(console.error("Erreur chargement utilisateurs:",s),w({show:!0,message:"Erreur chargement: "+(s.response?.data?.error||s.message||"Erreur"),type:"error"}))}finally{e||c(!1)}},x=React.useCallback((e,s)=>{p({show:!0,message:"Êtes-vous sûr de vouloir supprimer "+s+" ?",onConfirm:async()=>{p({show:!1,message:"",onConfirm:null});try{await axios.delete(API_URL+"/users/"+e),y({show:!0,message:"Utilisateur supprimé avec succès!",type:"success"}),E()}catch(e){w({show:!0,message:"Erreur: "+(e.response?.data?.error||"Erreur"),type:"error"})}}})},[E]),C=React.useCallback((e,s)=>{d({show:!0,message:"Nouveau mot de passe pour "+s+":",onConfirm:async s=>{if(d({show:!1,message:"",onConfirm:null}),!s||s.length<6)w({show:!0,message:"Mot de passe invalide (minimum 6 caractères)",type:"error"});else try{await axios.post(API_URL+"/users/"+e+"/reset-password",{new_password:s}),y({show:!0,message:"Mot de passe réinitialisé avec succès!",type:"success"})}catch(e){w({show:!0,message:"Erreur: "+(e.response?.data?.error||"Erreur"),type:"error"})}}})},[]);return e&&t?React.createElement("div",{className:"fixed inset-0 bg-slate-900/80 flex items-center justify-center z-[60] p-2 sm:p-4",onClick:s},React.createElement("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-5xl max-h-[85vh] sm:max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"sticky top-0 bg-slate-800 text-white p-3 sm:p-5 flex justify-between items-center z-10"},React.createElement("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0"},React.createElement("i",{className:"fas fa-users-cog text-xl sm:text-2xl flex-shrink-0"}),React.createElement("h2",{className:"text-lg sm:text-2xl font-bold truncate"},"technician"===t.role?"Liste Équipe":"Gestion des Utilisateurs")),React.createElement("button",{onClick:s,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-all flex-shrink-0"},React.createElement("i",{className:"fas fa-times text-lg sm:text-xl"}))),React.createElement("div",{className:"flex-1 overflow-y-auto p-3 sm:p-6"},l?React.createElement(CreateUserForm,{onCancel:()=>m(!1),onSuccess:()=>{y({show:!0,message:"Utilisateur créé avec succès!",type:"success"}),m(!1),E()},currentUserRole:t.role}):null,i?React.createElement(EditUserForm,{user:i,onCancel:()=>u(null),onSuccess:()=>{y({show:!0,message:"Utilisateur modifié avec succès!",type:"success"}),u(null),E()},currentUserRole:t.role,currentUserId:t.id}):null,n?React.createElement("p",{className:"text-center py-8"},"Chargement..."):React.createElement(UserList,{users:r,currentUser:t,onEdit:u,onDelete:x,onResetPassword:C,onOpenMessage:a,onCreate:()=>m(!0)})),React.createElement(NotificationModal,{show:h.show,message:h.message,type:h.type,onClose:()=>w({show:!1,message:"",type:"info"})}),React.createElement(ConfirmModal,{show:g.show,message:g.message,onConfirm:g.onConfirm,onCancel:()=>p({show:!1,message:"",onConfirm:null})}),React.createElement(PromptModal,{show:f.show,message:f.message,onConfirm:f.onConfirm,onCancel:()=>d({show:!1,message:"",onConfirm:null})}),React.createElement(Toast,{show:R.show,message:R.message,type:R.type,onClose:()=>y({show:!1,message:"",type:"success"})}))):null};