const OnboardingTour=({currentUser:e,onComplete:t,isVisible:a})=>{const[n,o]=React.useState(0),[r,i]=React.useState({top:0,left:0}),[s,l]=React.useState(null),[c,u]=React.useState(!1),d=React.useMemo(()=>(()=>{const t="admin"===e?.role||"supervisor"===e?.role,a=[{target:'[data-tour="kanban"]',title:"Votre tableau de bord",content:"Bienvenue ! Vos tickets de maintenance sont organisés par statut. Glissez-déposez pour changer leur état.",position:"center"},{target:'[data-tour="new-ticket"]',title:"Signaler un problème",content:"Cliquez ici pour créer un nouveau ticket de maintenance. Vous pouvez même ajouter des photos !",position:"bottom-left"},{target:'[data-tour="search"]',title:"Recherche rapide",content:"Trouvez un ticket par machine, mot-clé ou numéro. Tapez au moins 2 caractères pour lancer la recherche.",position:"bottom"},{target:'[data-tour="menu"]',title:"Menu principal",content:"Accédez à toutes les fonctionnalités depuis ce menu : statistiques, paramètres, gestion des utilisateurs...",position:"bottom-left"}];return a.push({target:null,title:"Vous êtes prêt !",content:t?"Vous pouvez maintenant gérer votre équipe efficacement. Besoin d'aide ? Cliquez sur le menu pour accéder au support.":"Vous pouvez maintenant signaler des problèmes et suivre vos tickets. Bonne utilisation !",position:"center",isFinal:!0}),a})(),[e?.role]),m=React.useCallback((e,t)=>{const a=320,n=12;if(!e)return{top:window.innerHeight/2-100,left:window.innerWidth/2-160,highlightRect:null};const o=e.getBoundingClientRect();let r,i;switch(t){case"bottom":r=o.bottom+n,i=o.left+o.width/2-160;break;case"bottom-left":r=o.bottom+n,i=o.left,i+a>window.innerWidth-20&&(i=window.innerWidth-a-20);break;case"bottom-right":r=o.bottom+n,i=o.right-a;break;case"top":r=o.top-200-n,i=o.left+o.width/2-160;break;case"left":r=o.top+o.height/2-100,i=o.left-a-n;break;case"right":r=o.top+o.height/2-100,i=o.right+n;break;default:r=window.innerHeight/2-100,i=window.innerWidth/2-160}return i=Math.max(10,Math.min(i,window.innerWidth-a-10)),r=Math.max(10,Math.min(r,window.innerHeight-200-10)),{top:r,left:i,highlightRect:{top:o.top-5,left:o.left-5,width:o.width+10,height:o.height+10}}},[]),g=React.useCallback(e=>{if(!e.target)return null;let t=document.querySelector(e.target);return t?console.log("[Onboarding] Found element:",e.target,t):console.warn("[Onboarding] Element not found:",e.target),t},[]);React.useEffect(()=>{if(!a)return;const e=d[n],t=g(e),{top:o,left:r,highlightRect:s}=m(t,e.position);u(!0),i({top:o,left:r}),l(s),t&&t.scrollIntoView({behavior:"smooth",block:"center"});const c=setTimeout(()=>u(!1),300);return()=>clearTimeout(c)},[n,a,d,g,m]),React.useEffect(()=>{if(!a)return;const e=e=>{"Escape"===e.key?h():"ArrowRight"===e.key||"Enter"===e.key?p():"ArrowLeft"===e.key&&n>0&&o(e=>e-1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,n]);const p=()=>{n<d.length-1?o(e=>e+1):b()},h=()=>{b()},b=async()=>{try{const e=localStorage.getItem("authToken")||authToken;e&&await axios.put("/api/preferences/onboarding_completed",{value:!0},{headers:{Authorization:`Bearer ${e}`}}),localStorage.setItem("onboarding_completed","true")}catch(e){console.warn("Erreur sauvegarde onboarding:",e),localStorage.setItem("onboarding_completed","true")}t&&t()};if(!a)return null;const f=d[n];return React.createElement("div",{className:"fixed inset-0 z-[9999]",style:{pointerEvents:"auto"}},React.createElement("div",{className:"absolute inset-0 bg-black/60 transition-opacity duration-300",onClick:h}),s&&React.createElement("div",{className:"absolute border-2 border-blue-400 rounded-lg shadow-lg transition-all duration-300",style:{top:s.top,left:s.left,width:s.width,height:s.height,boxShadow:"0 0 0 9999px rgba(0,0,0,0.6), 0 0 20px rgba(59, 130, 246, 0.5)",pointerEvents:"none"}}),React.createElement("div",{className:"absolute bg-white rounded-xl shadow-2xl p-4 transition-all duration-300 "+(c?"opacity-90 scale-95":"opacity-100 scale-100"),style:{top:r.top,left:r.left,width:"320px",maxWidth:"calc(100vw - 40px)",pointerEvents:"auto",zIndex:1e4}},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"flex gap-1.5"},d.map((e,t)=>React.createElement("div",{key:t,className:"w-2 h-2 rounded-full transition-all "+(t===n?"bg-blue-500 w-4":t<n?"bg-blue-300":"bg-gray-200")}))),React.createElement("span",{className:"text-xs text-gray-400"},`${n+1}/${d.length}`)),React.createElement("h3",{className:"text-lg font-bold text-gray-800 mb-2"},f.title),React.createElement("p",{className:"text-sm text-gray-600 mb-4 leading-relaxed"},f.content),React.createElement("div",{className:"flex items-center justify-between"},React.createElement("button",{onClick:h,className:"text-sm text-gray-400 hover:text-gray-600 transition-colors"},"Passer"),React.createElement("div",{className:"flex gap-2"},n>0&&React.createElement("button",{onClick:()=>o(e=>e-1),className:"px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},"← Précédent"),React.createElement("button",{onClick:p,className:"px-4 py-1.5 text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors shadow-sm"},f.isFinal?"Terminer ✓":"Suivant →"))),React.createElement("div",{className:"mt-3 pt-3 border-t border-gray-100 text-center"},React.createElement("span",{className:"text-xs text-gray-400"},"↑↓ pour naviguer • Échap pour fermer"))))};window.OnboardingTour=OnboardingTour;