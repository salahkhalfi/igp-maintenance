const OnboardingTour=({currentUser:e,onComplete:t,isVisible:a})=>{const[n,r]=React.useState(0),[o,i]=React.useState({top:0,left:0}),[l,s]=React.useState(null),[c,u]=React.useState(!1),d=React.useMemo(()=>(()=>{const t="admin"===e?.role||"supervisor"===e?.role,a=[{target:'[data-tour="kanban"]',fallbackTarget:".kanban-container, .grid, main",title:"Votre tableau de bord",content:"Bienvenue ! Vos tickets de maintenance sont organisés par statut. Glissez-déposez pour changer leur état.",position:"center"},{target:'[data-tour="new-ticket"], button[title*="Nouveau"], .btn-new-ticket',fallbackTarget:"button.bg-blue-600, button.bg-blue-500",title:"Signaler un problème",content:"Cliquez ici pour créer un nouveau ticket de maintenance. Vous pouvez même ajouter des photos !",position:"bottom"},{target:'[data-tour="search"], input[placeholder*="Rechercher"], .search-input',fallbackTarget:'input[type="search"], input[type="text"]',title:"Recherche rapide",content:"Trouvez un ticket par machine, mot-clé ou numéro. Tapez au moins 2 caractères pour lancer la recherche.",position:"bottom"},{target:'[data-tour="menu"], .hamburger-menu, button[aria-label*="menu"]',fallbackTarget:"button svg.fa-bars, .fa-bars",title:"Menu principal",content:"Accédez à toutes les fonctionnalités depuis ce menu : statistiques, paramètres, gestion des utilisateurs...",position:"bottom-right"}];return t&&(a.push({target:'[data-tour="secretariat"], button[title*="Secrétariat"]',fallbackTarget:".secretariat-btn, button:has(.fa-file-alt)",title:"Secrétariat IA",content:"Générez automatiquement des lettres officielles, rapports, demandes de subvention et documents RH avec l'intelligence artificielle.",position:"bottom"}),a.push({target:'[data-tour="stats"], button[title*="Statistiques"]',fallbackTarget:".stats-btn, button:has(.fa-chart-bar)",title:"Tableau de bord",content:"Visualisez les performances de votre équipe, le temps de résolution moyen et les tendances.",position:"bottom"})),a.push({target:null,title:"Vous êtes prêt !",content:t?"Vous pouvez maintenant gérer votre équipe efficacement. Besoin d'aide ? Cliquez sur le menu pour accéder au support.":"Vous pouvez maintenant signaler des problèmes et suivre vos tickets. Bonne utilisation !",position:"center",isFinal:!0}),a})(),[e?.role]),m=React.useCallback((e,t)=>{if(!e)return{top:window.innerHeight/2-100,left:window.innerWidth/2-175,highlightRect:null};const a=e.getBoundingClientRect();let n,r;switch(t){case"bottom":n=a.bottom+15,r=a.left+a.width/2-175;break;case"bottom-right":n=a.bottom+15,r=a.right-350;break;case"top":n=a.top-180-15,r=a.left+a.width/2-175;break;case"left":n=a.top+a.height/2-90,r=a.left-350-15;break;case"right":n=a.top+a.height/2-90,r=a.right+15;break;default:n=window.innerHeight/2-90,r=window.innerWidth/2-175}return r=Math.max(10,Math.min(r,window.innerWidth-350-10)),n=Math.max(10,Math.min(n,window.innerHeight-180-10)),{top:n,left:r,highlightRect:{top:a.top-5,left:a.left-5,width:a.width+10,height:a.height+10}}},[]),b=React.useCallback(e=>{if(!e.target)return null;let t=document.querySelector(e.target);return!t&&e.fallbackTarget&&(t=document.querySelector(e.fallbackTarget)),t},[]);React.useEffect(()=>{if(!a)return;const e=d[n],t=b(e),{top:r,left:o,highlightRect:l}=m(t,e.position);u(!0),i({top:r,left:o}),s(l),t&&t.scrollIntoView({behavior:"smooth",block:"center"});const c=setTimeout(()=>u(!1),300);return()=>clearTimeout(c)},[n,a,d,b,m]),React.useEffect(()=>{if(!a)return;const e=e=>{"Escape"===e.key?p():"ArrowRight"===e.key||"Enter"===e.key?g():"ArrowLeft"===e.key&&n>0&&r(e=>e-1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,n]);const g=()=>{n<d.length-1?r(e=>e+1):h()},p=()=>{h()},h=async()=>{try{const e=localStorage.getItem("authToken")||authToken;e&&await axios.put("/api/preferences/onboarding_completed",{value:!0},{headers:{Authorization:`Bearer ${e}`}}),localStorage.setItem("onboarding_completed","true")}catch(e){console.warn("Erreur sauvegarde onboarding:",e),localStorage.setItem("onboarding_completed","true")}t&&t()};if(!a)return null;const f=d[n];return React.createElement("div",{className:"fixed inset-0 z-[9999]",style:{pointerEvents:"auto"}},React.createElement("div",{className:"absolute inset-0 bg-black/60 transition-opacity duration-300",onClick:p}),l&&React.createElement("div",{className:"absolute border-2 border-blue-400 rounded-lg shadow-lg transition-all duration-300",style:{top:l.top,left:l.left,width:l.width,height:l.height,boxShadow:"0 0 0 9999px rgba(0,0,0,0.6), 0 0 20px rgba(59, 130, 246, 0.5)",pointerEvents:"none"}}),React.createElement("div",{className:"absolute bg-white rounded-xl shadow-2xl p-5 w-[350px] transition-all duration-300 "+(c?"opacity-90 scale-95":"opacity-100 scale-100"),style:{top:o.top,left:o.left,pointerEvents:"auto"}},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"flex gap-1.5"},d.map((e,t)=>React.createElement("div",{key:t,className:"w-2 h-2 rounded-full transition-all "+(t===n?"bg-blue-500 w-4":t<n?"bg-blue-300":"bg-gray-200")}))),React.createElement("span",{className:"text-xs text-gray-400"},`${n+1}/${d.length}`)),React.createElement("h3",{className:"text-lg font-bold text-gray-800 mb-2"},f.title),React.createElement("p",{className:"text-sm text-gray-600 mb-4 leading-relaxed"},f.content),React.createElement("div",{className:"flex items-center justify-between"},React.createElement("button",{onClick:p,className:"text-sm text-gray-400 hover:text-gray-600 transition-colors"},"Passer"),React.createElement("div",{className:"flex gap-2"},n>0&&React.createElement("button",{onClick:()=>r(e=>e-1),className:"px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},"← Précédent"),React.createElement("button",{onClick:g,className:"px-4 py-1.5 text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors shadow-sm"},f.isFinal?"Terminer ✓":"Suivant →"))),React.createElement("div",{className:"mt-3 pt-3 border-t border-gray-100 text-center"},React.createElement("span",{className:"text-xs text-gray-400"},"↑↓ pour naviguer • Échap pour fermer"))))};window.OnboardingTour=OnboardingTour;