const RoleDropdown=({value:e,onChange:t,disabled:r,currentUserRole:n,variant:a="blue"})=>{const[o,l]=React.useState(!1),[c,s]=React.useState({top:0,left:0,width:0}),i=React.useRef(null),u=React.useRef(null),d=React.useRef(null),b=React.useMemo(()=>({blue:{button:"from-white/90 to-blue-50/80 border-blue-300 focus:ring-blue-500 focus:border-blue-500",chevron:"text-blue-500",shadow:"0 6px 20px rgba(59, 130, 246, 0.15), inset 0 1px 3px rgba(255, 255, 255, 0.5)",border:"border-blue-300"},green:{button:"from-white/90 to-green-50/80 border-green-300 focus:ring-green-500 focus:border-green-500",chevron:"text-green-500",shadow:"0 6px 20px rgba(34, 197, 94, 0.15), inset 0 1px 3px rgba(255, 255, 255, 0.5)",border:"border-green-300"}}),[])[a],[f,m]=React.useState([]),[p,h]=React.useState(!0),g=React.useMemo(()=>({director:"ðŸ“Š Direction",admin:"ðŸ“Š Direction",supervisor:"âš™ï¸ Management Maintenance",coordinator:"âš™ï¸ Management Maintenance",planner:"âš™ï¸ Management Maintenance",senior_technician:"ðŸ”§ Technique",technician:"ðŸ”§ Technique",team_leader:"ðŸ­ Production",furnace_operator:"ðŸ­ Production",operator:"ðŸ­ Production",safety_officer:"ðŸ›¡ï¸ Support",quality_inspector:"ðŸ›¡ï¸ Support",storekeeper:"ðŸ›¡ï¸ Support",viewer:"ðŸ‘ï¸ Transversal"}),[]);React.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("token"),t=await fetch("/api/roles",{headers:e?{Authorization:"Bearer "+e}:{}});if(!t.ok)throw new Error("Failed to fetch roles");const r=(await t.json()).roles||[],a={"ðŸ“Š Direction":[],"âš™ï¸ Management Maintenance":[],"ðŸ”§ Technique":[],"ðŸ­ Production":[],"ðŸ›¡ï¸ Support":[],"ðŸ‘ï¸ Transversal":[],Autres:[]};r.forEach(e=>{if("admin"===e.slug&&"admin"!==n)return;const t=g[e.slug]||"Autres";a[t]||(a[t]=[]),a[t].push({value:e.slug,label:e.name||e.slug})});const o=Object.entries(a).filter(([e,t])=>t.length>0).map(([e,t])=>({label:e,roles:t})),l=["ðŸ“Š Direction","âš™ï¸ Management Maintenance","ðŸ”§ Technique","ðŸ­ Production","ðŸ›¡ï¸ Support","ðŸ‘ï¸ Transversal","Autres"];o.sort((e,t)=>{const r=l.indexOf(e.label),n=l.indexOf(t.label);return(-1===r?999:r)-(-1===n?999:n)}),m(o)}catch(e){console.error("Error loading roles:",e),m([{label:"ðŸ“Š Direction",roles:[{value:"director",label:"Directeur GÃ©nÃ©ral"}]},{label:"ðŸ”§ Technique",roles:[{value:"technician",label:"Technicien"}]}])}finally{h(!1)}})()},[n,g]);const x=React.useCallback(()=>{if(p)return"Chargement...";for(const t of f){const r=t.roles.find(t=>t.value===e);if(r)return r.label}return e||"SÃ©lectionner un rÃ´le"},[f,e,p]),v=React.useCallback(()=>{if(u.current){const e=u.current.getBoundingClientRect();s({top:e.bottom+window.scrollY+8,left:e.left+window.scrollX,width:e.width})}},[]);React.useEffect(()=>{if(o)return v(),window.addEventListener("resize",v),window.addEventListener("scroll",v,!0),()=>{window.removeEventListener("resize",v),window.removeEventListener("scroll",v,!0)}},[o,v]);const w=React.useCallback(e=>{u.current&&u.current.contains(e.target)||i.current&&i.current.contains(e.target)||d.current&&d.current.contains(e.target)||l(!1)},[]);React.useEffect(()=>{if(o)return document.addEventListener("mousedown",w,!0),document.addEventListener("touchstart",w,!0),()=>{document.removeEventListener("mousedown",w,!0),document.removeEventListener("touchstart",w,!0)}},[o,w]);const R=React.useCallback(e=>{t({target:{value:e}}),l(!1)},[t]),y=o&&React.createElement("div",{ref:d,className:"fixed z-[10000] bg-white border-2 "+b.border+" rounded-xl shadow-2xl max-h-[60vh] overflow-y-auto",style:{top:c.top+"px",left:c.left+"px",width:c.width+"px",pointerEvents:"auto"}},f.map((t,r)=>t.roles.length>0&&React.createElement("div",{key:r},React.createElement("div",{className:"px-3 py-2 bg-gray-100 text-gray-700 font-bold text-xs sm:text-sm sticky top-0 z-[1]"},t.label),t.roles.map(t=>React.createElement("button",{key:t.value,type:"button",onClick:()=>R(t.value),className:"w-full px-4 py-3 text-left text-sm sm:text-base hover:bg-blue-50 transition-colors "+(e===t.value?"bg-blue-100 font-semibold text-blue-700":"text-gray-800")},t.label,e===t.value&&React.createElement("i",{className:"fas fa-check ml-2 text-blue-600"}))))));return React.createElement("div",{ref:i,className:"relative w-full"},React.createElement("button",{ref:u,type:"button",onClick:()=>!r&&l(!o),disabled:r,className:"w-full px-2 py-2 sm:px-4 sm:py-3 text-sm sm:text-base text-left bg-gradient-to-br "+b.button+" border-2 rounded-xl shadow-lg focus:outline-none focus:ring-2 transition-all hover:shadow-xl cursor-pointer font-medium sm:font-semibold "+(r?"opacity-50 cursor-not-allowed":"")+" flex justify-between items-center",style:{boxShadow:b.shadow}},React.createElement("span",{className:"truncate pr-2"},x()),React.createElement("i",{className:"fas fa-chevron-"+(o?"up":"down")+" "+b.chevron+" transition-transform text-xs sm:text-sm flex-shrink-0"})),o&&"undefined"!=typeof ReactDOM&&ReactDOM.createPortal?ReactDOM.createPortal(y,document.body):y)};