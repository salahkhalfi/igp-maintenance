const RoleDropdown=({value:e,onChange:t,disabled:r,currentUserRole:o,variant:n="blue"})=>{const[a,s]=React.useState(!1),[l,c]=React.useState({top:0,left:0,width:0}),i=React.useRef(null),u=React.useRef(null),d=React.useRef(null),p=React.useMemo(()=>({blue:{button:"from-white/90 to-blue-50/80 border-blue-300 focus:ring-blue-500 focus:border-blue-500",chevron:"text-blue-500",shadow:"0 6px 20px rgba(59, 130, 246, 0.15), inset 0 1px 3px rgba(255, 255, 255, 0.5)",border:"border-blue-300"},green:{button:"from-white/90 to-green-50/80 border-green-300 focus:ring-green-500 focus:border-green-500",chevron:"text-green-500",shadow:"0 6px 20px rgba(34, 197, 94, 0.15), inset 0 1px 3px rgba(255, 255, 255, 0.5)",border:"border-green-300"}}),[])[n],[f,m]=React.useState([]),[b,g]=React.useState(!0),h=React.useMemo(()=>({director:"ðŸ“Š Direction",admin:"ðŸ“Š Direction",supervisor:"âš™ï¸ Management Maintenance",coordinator:"âš™ï¸ Management Maintenance",planner:"âš™ï¸ Management Maintenance",senior_technician:"ðŸ”§ Technique",technician:"ðŸ”§ Technique",team_leader:"ðŸ­ Production",furnace_operator:"ðŸ­ Production",operator:"ðŸ­ Production",safety_officer:"ðŸ›¡ï¸ Support",quality_inspector:"ðŸ›¡ï¸ Support",storekeeper:"ðŸ›¡ï¸ Support",viewer:"ðŸ‘ï¸ Transversal"}),[]);React.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("token"),t=await fetch("/api/roles",{headers:e?{Authorization:"Bearer "+e}:{}});if(!t.ok)throw new Error("Failed to fetch roles");const r=(await t.json()).roles||[],n={"ðŸ“Š Direction":[],"âš™ï¸ Management Maintenance":[],"ðŸ”§ Technique":[],"ðŸ­ Production":[],"ðŸ›¡ï¸ Support":[],"ðŸ‘ï¸ Transversal":[],Autres:[]};r.forEach(e=>{if("admin"===e.slug&&"admin"!==o)return;const t=h[e.slug]||"Autres";n[t]||(n[t]=[]),n[t].push({value:e.slug,label:e.name||e.slug})});const a=Object.entries(n).filter(([e,t])=>t.length>0).map(([e,t])=>({label:e,roles:t})),s=["ðŸ“Š Direction","âš™ï¸ Management Maintenance","ðŸ”§ Technique","ðŸ­ Production","ðŸ›¡ï¸ Support","ðŸ‘ï¸ Transversal","Autres"];a.sort((e,t)=>{const r=s.indexOf(e.label),o=s.indexOf(t.label);return(-1===r?999:r)-(-1===o?999:o)}),m(a)}catch(e){console.error("Error loading roles:",e),m([{label:"ðŸ“Š Direction",roles:[{value:"director",label:"Directeur GÃ©nÃ©ral"}]},{label:"ðŸ”§ Technique",roles:[{value:"technician",label:"Technicien"}]}])}finally{g(!1)}})()},[o,h]);const w=React.useCallback(()=>{if(b)return"Chargement...";for(const t of f){const r=t.roles.find(t=>t.value===e);if(r)return r.label}return e||"SÃ©lectionner un rÃ´le"},[f,e,b]),x=React.useCallback(()=>{if(u.current){const e=u.current.getBoundingClientRect();c({top:e.bottom+window.scrollY+8,left:e.left+window.scrollX,width:e.width})}},[]);React.useEffect(()=>{if(a)return x(),window.addEventListener("resize",x),window.addEventListener("scroll",x,!0),()=>{window.removeEventListener("resize",x),window.removeEventListener("scroll",x,!0)}},[a,x]);const v=React.useCallback(e=>{setTimeout(()=>{const t=u.current&&u.current.contains(e.target),r=i.current&&i.current.contains(e.target),o=d.current&&d.current.contains(e.target),n=e.target.closest&&e.target.closest("[data-role-dropdown]");t||r||o||n||s(!1)},10)},[]);React.useEffect(()=>{if(a)return document.addEventListener("mousedown",v,!0),document.addEventListener("touchstart",v,!0),()=>{document.removeEventListener("mousedown",v,!0),document.removeEventListener("touchstart",v,!0)}},[a,v]);const R=React.useCallback(e=>{t({target:{value:e}}),s(!1)},[t]),y=a&&React.createElement("div",{ref:d,"data-role-dropdown":"true",className:"fixed z-[10000] bg-white border-2 "+p.border+" rounded-xl shadow-2xl max-h-[60vh] overflow-y-auto",style:{top:l.top+"px",left:l.left+"px",width:l.width+"px",pointerEvents:"auto"},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation()},f.map((t,r)=>t.roles.length>0&&React.createElement("div",{key:r},React.createElement("div",{className:"px-3 py-2 bg-gray-100 text-gray-700 font-bold text-xs sm:text-sm sticky top-0 z-[1]"},t.label),t.roles.map(t=>React.createElement("button",{key:t.value,type:"button",onClick:()=>R(t.value),className:"w-full px-4 py-3 text-left text-sm sm:text-base hover:bg-blue-50 transition-colors "+(e===t.value?"bg-blue-100 font-semibold text-blue-700":"text-gray-800")},t.label,e===t.value&&React.createElement("i",{className:"fas fa-check ml-2 text-blue-600"}))))));return React.createElement("div",{ref:i,className:"relative w-full"},React.createElement("button",{ref:u,type:"button","data-role-dropdown":"true",onClick:e=>{e.preventDefault(),e.stopPropagation(),r||s(e=>!e)},onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),disabled:r,className:"w-full px-2 py-2 sm:px-4 sm:py-3 text-sm sm:text-base text-left bg-gradient-to-br "+p.button+" border-2 rounded-xl shadow-lg focus:outline-none focus:ring-2 transition-all hover:shadow-xl cursor-pointer font-medium sm:font-semibold "+(r?"opacity-50 cursor-not-allowed":"")+" flex justify-between items-center",style:{boxShadow:p.shadow}},React.createElement("span",{className:"truncate pr-2"},w()),React.createElement("i",{className:"fas fa-chevron-"+(a?"up":"down")+" "+p.chevron+" transition-transform text-xs sm:text-sm flex-shrink-0"})),a&&"undefined"!=typeof ReactDOM&&ReactDOM.createPortal?ReactDOM.createPortal(y,document.body):y)};