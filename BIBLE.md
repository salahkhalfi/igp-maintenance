# âš¡ SYSTEM KERNEL : THE RULES OF ENGAGEMENT
> **VERSION:** 7.0 | **LIMIT:** < 600 lines | **STATUS:** IMMUTABLE SOURCE OF TRUTH

---

## ğŸ’€ MODULE -2: SANDBOX KILLER (LIRE EN PREMIER)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â›” COMMANDE INTERDITE - DÃ‰TRUIT LE SANDBOX DÃ‰FINITIVEMENT â›”      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                   â•‘
â•‘    â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—      â•‘
â•‘    â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘      â•‘
â•‘    â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘      â•‘
â•‘    â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘      â•‘
â•‘    â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•‘
â•‘    â•šâ•â•  â•šâ•â•â•â•â•šâ•â•     â•šâ•â•     â•šâ•â•    â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•â•â•â•â•â• â•‘
â•‘                                                                   â•‘
â•‘    âŒ npm run build                                               â•‘
â•‘    âŒ npm run dev (avec watch)                                    â•‘
â•‘    âŒ vite build                                                  â•‘
â•‘    âŒ Toute commande de build lourde                              â•‘
â•‘                                                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  CE QUI SE PASSE:                                                 â•‘
â•‘  1. Node.js consomme toute la RAM/CPU                             â•‘
â•‘  2. Process crash â†’ fichier "core" de 500MB+                      â•‘
â•‘  3. Disque plein â†’ sandbox freeze TOTAL                           â•‘
â•‘  4. ResetSandbox NE FONCTIONNE PAS                                â•‘
â•‘  5. SEULE SOLUTION: CrÃ©er un nouveau projet (perte de temps)      â•‘
â•‘                                                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  âœ… COMMENT DÃ‰PLOYER:                                             â•‘
â•‘                                                                   â•‘
â•‘    git add -A && git commit -m "..." && git push origin main      â•‘
â•‘                                                                   â•‘
â•‘  â†’ GitHub Actions fait le build (~2 min) EN SÃ‰CURITÃ‰              â•‘
â•‘                                                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  INCIDENT DU 28 DÃ‰C 2025:                                         â•‘
â•‘  - Agent prÃ©cÃ©dent a lancÃ© "npm run build"                        â•‘
â•‘  - Sandbox dÃ©truit dÃ©finitivement                                 â•‘
â•‘  - User a dÃ» crÃ©er nouveau projet = temps perdu                   â•‘
â•‘                                                                   â•‘
â•‘  NE JAMAIS RÃ‰PÃ‰TER CETTE ERREUR.                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸš¨ MODULE -1: ANTI-BULLSHIT GATE (EXECUTE FIRST)

```
AVANT DE PROPOSER QUOI QUE CE SOIT:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  0. RÃ‰FLÃ‰CHIR AVANT D'AGIR                              â”‚
â”‚     - STOP. Ne pas se prÃ©cipiter Ã  modifier le code     â”‚
â”‚     - Analyser les CONSÃ‰QUENCES de chaque changement    â”‚
â”‚     - Demander confirmation Ã  l'utilisateur si doute    â”‚
â”‚     - UN changement = UN effet. Penser aux effets       â”‚
â”‚       secondaires et aux rÃ©gressions potentielles       â”‚
â”‚                                                         â”‚
â”‚  1. VÃ‰RIFIER D'ABORD, PARLER APRÃˆS                      â”‚
â”‚     - Grep les dÃ©pendances                              â”‚
â”‚     - VÃ©rifier si l'infra existe (KV? DB? Config?)      â”‚
â”‚     - Compter les fichiers impactÃ©s                     â”‚
â”‚     - Mesurer le gain RÃ‰EL (pas supposÃ©)                â”‚
â”‚                                                         â”‚
â”‚  2. SI PAS VÃ‰RIFIÃ‰ â†’ NE PAS PROPOSER                    â”‚
â”‚     Dire: "Je dois vÃ©rifier avant de rÃ©pondre"          â”‚
â”‚                                                         â”‚
â”‚  3. FORMAT OBLIGATOIRE POUR TOUTE SUGGESTION:           â”‚
â”‚     - PrÃ©requis: [ce qui doit exister]                  â”‚
â”‚     - Impact: [fichiers touchÃ©s, dÃ©pendances]           â”‚
â”‚     - Risque: [ce qui peut casser]                      â”‚
â”‚     - Gain rÃ©el: [mesurÃ©, pas estimÃ©]                   â”‚
â”‚     - Verdict: [SAFE/UNSAFE/NEED MORE INFO]             â”‚
â”‚                                                         â”‚
â”‚  4. RÃ‰PONSES INTERDITES:                                â”‚
â”‚     âŒ "Tu pourrais faire X" (sans vÃ©rifier si faisable)â”‚
â”‚     âŒ "Une optimisation serait Y" (sans mesurer gain)  â”‚
â”‚     âŒ "C'est simple, il suffit de Z" (sans grep avant) â”‚
â”‚                                                         â”‚
â”‚  5. SI GAIN < 5% ET RISQUE > 0 â†’ NE PAS PROPOSER        â”‚
â”‚     Dire: "Rien Ã  faire, l'app fonctionne"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

VIOLATION = BULLSHIT = USER PERD CONFIANCE
```

---

## ğŸŸ¢ MODULE 0: META-PROTOCOL
*   **READ BEFORE WRITE**: `READ` â†’ `GREP` â†’ `PLAN` â†’ `EDIT`. No blind coding.
*   **SCOPE ISOLATION**: Don't burn the house to kill a spider. Revert > Reset.
*   **ALIGNMENT**: Generic SaaS (White Label). IGP = first tenant, NOT the product.
*   **ONE FILE**: Update THIS file only. Never create `bible_v2.md`.
*   **CHESTERTON'S FENCE**: Never delete code you don't fully understand.
*   **VERIFY BEFORE SUGGEST**: No suggestion without prior grep/check. Period.

---

## ğŸŸ¥ MODULE 1: THE CORE LOOP
1.  **SIMULATION**: Audit for Security, Performance (O(nÂ²)), Mobile (<44px), Edge Cases.
2.  **GLOBAL IMPACT**: "Does this fix disrupt active states (Audio, Scroll, Input)?"
3.  **VERIFICATION**: Use `grep` to ensure no conflicts globally.
4.  **LEGACY AWARENESS**: "Dead code" in `src/` might be "Alive" in `public/static/`.

---

## ğŸŸ§ MODULE 2: TECHNICAL AXIOMS

### [PLATFORM - CLOUDFLARE EDGE]
*   V8 Runtime. NO Node.js APIs (`fs`, `crypto`, `child_process`). Web Standards only.
*   DB (D1/R2) is the ONLY State. Workers are ephemeral.
*   Use external webhooks (cron-job.org) â†’ `/api/cron/*` with `CRON_SECRET`.

### [DATA & TIME]
*   **UTC STORAGE**: Storage = UTC. Display = User Local (`timezone_offset`).
*   **SOFT DELETE**: Use `deleted_at` timestamp. NEVER `DELETE FROM`.
*   **SQL SAFETY**: Use `COALESCE` for NULLs. Prepared statements only.

### [UX]
*   **MOBILE FIRST**: Touch target **44x44px MINIMUM**.
*   **ESCAPE HATCH**: Modals close on backdrop click.

### [CODE HYGIENE]
*   **ZERO HARDCODING**: Fetch values from DB (`system_settings`) or ENV.
*   **NO DEAD CODE**: Commented code = Deleted code.

### [ğŸš¨ HARDCODING FORBIDDEN]
```
âŒ app.igpglass.ca / igpglass.com / IGP Glass / admin@igpglass.* / sk-* / AKIA*
âœ… window.location.hostname, system_settings, getDomainFromRequest()
```

---

## ğŸŸ¨ MODULE 3: DEPLOYMENT

### [SANDBOX PROTECTION]
```
âŒ npm run build (crashes sandbox)
âœ… git push origin main (GitHub Actions builds ~2 min)
```

### [âš ï¸ CORE DUMP - CRASH SILENCIEUX]
```
SYMPTÃ”ME:
- Sandbox freeze total (commandes timeout)
- Fichier "core" de 500MB+ dans /home/user/webapp/
- Reset sandbox ne suffit pas â†’ freeze revient

CAUSE:
- Process Node.js crash (mÃ©moire, boucle infinie, etc.)
- GÃ©nÃ¨re un fichier core dump qui remplit le disque
- Sandbox devient inutilisable

DÃ‰TECTION:
ls -lh /home/user/webapp/core 2>/dev/null && echo "âš ï¸ CORE DUMP DÃ‰TECTÃ‰"

SOLUTION IMMÃ‰DIATE:
rm -f /home/user/webapp/core

PRÃ‰VENTION:
- AprÃ¨s ResetSandbox â†’ TOUJOURS vÃ©rifier: ls -la | grep core
- Si core existe â†’ supprimer AVANT toute autre action
- Build timeout > 2min â†’ kill processes, chercher core dump
```

### [LEGACY JS COMPONENTS - âš ï¸ PIÃˆGE FRÃ‰QUENT]
```
âš ï¸ CRITIQUE : Modifier public/static/js/components/*.js NE SUFFIT PAS
Le navigateur charge dist/*.min.js (pas components/*.js)

PROCÃ‰DURE OBLIGATOIRE (6 Ã©tapes, AUCUNE OPTIONNELLE) :

1. MODIFIER le fichier source
   public/static/js/components/FICHIER.js

2. MINIFIER (regÃ©nÃ¨re dist/*.min.js)
   npm run build:minify

3. VÃ‰RIFIER que le code est dans le minifiÃ©
   grep "MA_STRING" public/static/js/dist/FICHIER.min.js
   (chercher des strings, pas des variables - Terser les renomme)

4. GÃ‰NÃ‰RER nouveau hash
   md5sum public/static/js/dist/FICHIER.min.js | cut -c1-7

5. REMPLACER le hash dans home.ts
   sed -i 's/v=ANCIEN/v=NOUVEAU/g' src/views/home.ts

6. PUSH (GitHub Actions build + deploy)
   git add -A && git commit -m "..." && git push origin main

7. VÃ‰RIFIER en production (OBLIGATOIRE)
   curl -s "https://DOMAIN/" | grep "FICHIER.min.js"
   â†’ Doit afficher le NOUVEAU hash

âŒ ERREUR COMMUNE: Faire des commits "bump cache" sans vÃ©rifier
   que le hash a RÃ‰ELLEMENT changÃ© = modification invisible
```

### [ğŸš€ DÃ‰PLOIEMENT DIRECT DEPUIS SANDBOX - CACHE CLOUDFLARE]
```
DÃ‰COUVERTE (2024-12-28):
Wrangler utilise un cache intelligent basÃ© sur les hash SHA des fichiers.

FONCTIONNEMENT:
- Chaque fichier a un hash unique calculÃ© par Wrangler
- Si le hash existe dÃ©jÃ  chez Cloudflare â†’ pas de re-upload
- Seuls les fichiers MODIFIÃ‰S sont envoyÃ©s

EXEMPLE RÃ‰EL:
  Uploading... (350/350)
  âœ¨ Success! Uploaded 0 files (350 already uploaded) (0.51 sec)
  â†’ 350 fichiers, 0 uploadÃ©s, 14 sec total

QUAND C'EST RAPIDE (< 30 sec):
- DÃ©ploiements frÃ©quents (petits incrÃ©ments)
- Modifications lÃ©gÃ¨res (1-5 fichiers JS)
- Build rÃ©cent dÃ©jÃ  sur Cloudflare

QUAND C'EST LENT (> 3 min):
- Premier dÃ©ploiement (tous les fichiers)
- Gros changements (Vite regenere tous les chunks)
- Nouvelle dÃ©pendance NPM

STRATÃ‰GIE OPTIMALE:
âœ… DÃ©ployer souvent en petits incrÃ©ments
âœ… npm run build:minify (seul le .min.js change)
âœ… Utiliser wrangler pages deploy (pas GitHub Actions si urgent)
âŒ Attendre d'avoir 50 fichiers modifiÃ©s
```

### [DATABASE: maintenance-db]
*   **Prod**: `npx wrangler d1 migrations apply maintenance-db`
*   **Reset**: `rm -rf .wrangler/state/v3/d1 && npm run db:migrate:local`

---

## ğŸŸ© MODULE 4: ARCHITECTURE

### [STACK]
*   **Backend**: Hono + Cloudflare D1 + R2
*   **Frontend**: React 18 (CDN) - Legacy dashboard
*   **Push**: `@block65/webcrypto-web-push`

### [CRON EXTERNE]
```
URL: (domaine configurÃ© dans system_settings)
Auth: CRON_SECRET from .dev.vars/Cloudflare secrets (NO "Bearer" prefix)
Endpoint: /api/cron/*
Service: cron-job.org (external, not Cloudflare native)
```

### [TIMEZONE]
```
Storage: UTC | Display: Local | Helper: getTimezoneOffset()
```

---

## ğŸŸ¦ MODULE 5: COPILOT OATH

### [ğŸš¨ NO BULLSHIT - PRIORITY ZERO]
```
INTERDICTIONS:
âŒ "Excellent idea!" â†’ "ok" ou pointer le problÃ¨me
âŒ "You're right" si faux â†’ "Non, parce que..."
âŒ Tourner en rond â†’ "On tourne en rond, STOP"
âŒ 3+ tentatives Ã©chouÃ©es â†’ "Je n'y arrive pas"
âŒ Proposer une solution SANS rÃ©vÃ©ler les risques d'abord
âŒ Proposer sans avoir VÃ‰RIFIÃ‰ (grep, config, infra)
âŒ Estimer un gain sans le MESURER
âŒ Dire "tu pourrais" sans avoir confirmÃ© que c'est faisable

OBLIGATIONS:
âœ… Dire "Non" avec la raison
âœ… Dire "Je sais pas" si incertain
âœ… Admettre ses erreurs immÃ©diatement
âœ… AVANT toute solution: lister les rÃ©percussions nÃ©gatives possibles
âœ… VÃ‰RIFIER avant de SUGGÃ‰RER (grep, ls, cat config)
âœ… Si gain < 5% et risque > 0 â†’ dire "rien Ã  faire"
âœ… Si infra manquante â†’ dire "pas faisable sans X"

TRIGGER: User dit "bullshit" = reset comportement
```

### [ğŸ”’ CHECKLIST OBLIGATOIRE AVANT SUGGESTION]
```
Avant de proposer une optimisation/modification:

â–¡ J'ai grep les dÃ©pendances? (combien de fichiers impactÃ©s)
â–¡ J'ai vÃ©rifiÃ© la config? (wrangler.jsonc, package.json)
â–¡ J'ai mesurÃ© l'Ã©tat actuel? (pas estimÃ©)
â–¡ J'ai calculÃ© le gain rÃ©el? (en ms, KB, ou %)
â–¡ J'ai listÃ© ce qui peut casser?
â–¡ Le ratio gain/risque est > 5:1?

Si UNE case non cochÃ©e â†’ NE PAS PROPOSER
Dire: "Je dois vÃ©rifier X avant de rÃ©pondre"
```

### [TOKEN ECONOMY]
```
- <100 words unless complex
- Act first, summarize after
- No decoration, no filler
- No re-read files already read
```

---

## ğŸŸ« MODULE 6: SANCTUARIZED CODE

### [DO NOT TOUCH WITHOUT VALIDATION]
| Function | File |
|----------|------|
| Voice Ticket | `ai.ts` L135-400 |
| Push Notifications | `push.ts` L197-450 |
| Expert IA | `ai.ts` L480-700 |
| Service Worker | `service-worker.js` ALL |
| Voice UI | `VoiceTicketFab.js` ALL |

### [MANDATORY TESTS AFTER CHANGES]
1. Voice: Record â†’ Analyze â†’ Pre-fill modal
2. Push: Create ticket â†’ Receive notification
3. Expert IA: Send message â†’ Get response

### [HONO TRAP]
```
âš ï¸ FIRST declared route wins (unlike Express LAST wins)
Duplicate routes: First = ACTIVE, Second = DEAD CODE
```

---

## ğŸ”µ MODULE 7: AI STACK
*   **Audio**: Groq Whisper â†’ OpenAI (fallback)
*   **Logic**: DeepSeek â†’ GPT-4o-mini (fallback)
*   **Vision**: GPT-4o-mini only

---

## ğŸŸ¤ MODULE 8: REACT ISOLATION
*   Dashboard = Legacy (CDN), Messenger = Modern (Vite). NEVER mix.

---

## âš« MODULE 9: SESSION HYGIENE
```
RÃˆGLES:
- 1 objectif clair = 1 session
- Session > 30 interactions â†’ Proposer nouvelle session
- AI tourne en rond â†’ User dit "nouvelle session"
- Avant opÃ©ration risquÃ©e â†’ Relire la bible

SYMPTÃ”MES DE DÃ‰GRADATION:
- RÃ©pÃ©titions, oublis, erreurs en cascade
- Fix qui casse autre chose
- RÃ©ponses de plus en plus longues

ACTION: RÃ©sumer en 3 lignes + nouvelle session
```

---

## â¬› MODULE 10: IMPACT ANALYSIS PROTOCOL

```
AVANT TOUTE MODIFICATION:

1. GREP GLOBAL
   grep -rn "fonction\|variable" src/ public/
   â†’ Identifier dÃ©pendances + hardcoding cachÃ©

2. SIMULATION: "Si je change X â†’ Y continue?"
   - Tickets, AI, Push, Cache sync fonctionnent?

3. RISQUE > 30% â†’ STOP, lister risques, attendre validation

TRIGGER: >3 fichiers touchÃ©s OU fonction sanctuarisÃ©e
```

---

## ğŸ’€ MODULE 11: LESSONS FROM FAILURES

```
ERREUR DU 26 DÃ‰C 2025 - "Les 3 optimisations bidons"

CE QUI S'EST PASSÃ‰:
- User demande des optimisations
- AI propose: Cache KV, Pagination cursor, CDN
- AI n'a PAS vÃ©rifiÃ© avant de proposer
- RÃ©sultat: KV pas configurÃ©, Pagination casse tout, CDN dÃ©jÃ  actif

POURQUOI C'EST ARRIVÃ‰:
- AI voulait "Ãªtre utile" â†’ a inventÃ© des solutions
- AI n'a pas dit "je vÃ©rifie d'abord"
- AI a traitÃ© la BIBLE comme doc, pas comme ordres

CE QUE Ã‡A A COÃ›TÃ‰:
- Temps perdu
- Confiance perdue
- User doit maintenant vÃ©rifier chaque suggestion AI

LEÃ‡ON:
"Une suggestion non vÃ©rifiÃ©e est un mensonge poli"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ERREUR DU 30 DÃ‰C 2025 - "Suppression bÃ¢clÃ©e de l'onboarding"

CE QUI S'EST PASSÃ‰:
- User demande de supprimer une fonctionnalitÃ© (onboarding)
- AI supprime les fichiers Ã©vidents
- AI commit sans vÃ©rifier que tout est propre
- User demande "tu es sÃ»r qu'il n'y a pas de poubelle?"
- AI cherche APRÃˆS et trouve des restes (endpoint API, attributs data-tour)

POURQUOI C'EST ARRIVÃ‰:
- AI a voulu aller vite
- AI n'a pas fait de grep AVANT le commit
- AI a supposÃ© que supprimer le fichier principal suffisait

CE QUE Ã‡A A COÃ›TÃ‰:
- 2 commits au lieu de 1
- User doit vÃ©rifier le travail de l'AI
- Confiance perdue

LEÃ‡ON:
"Supprimer une fonctionnalitÃ© = grep TOUTES les rÃ©fÃ©rences AVANT de commit"

PROCÃ‰DURE OBLIGATOIRE POUR SUPPRESSION:
1. grep -rn "nom_feature" --include="*.js" --include="*.ts" .
2. Lister TOUS les fichiers impactÃ©s
3. Tout supprimer
4. grep Ã  nouveau pour confirmer = 0 rÃ©sultats
5. PUIS commit (un seul)
```

---

## ğŸ”´ MODULE 12: AUDIT CODE MORT - PRUDENCE EXTRÃŠME

```
âš ï¸ RÃˆGLE D'OR: NE JAMAIS SUPPRIMER DU CODE SANS CERTITUDE 100%

SCRIPT D'AUDIT DISPONIBLE:
npm run audit   # ou ./scripts/audit-dead-code.sh

CE QUE L'AUDIT DÃ‰TECTE:
- Erreurs syntaxe JS
- RÃ©fÃ©rences window.* potentiellement non dÃ©finies
- Ã‰tats React utilisÃ©s peu de fois
- Fichiers JS non rÃ©fÃ©rencÃ©s dans home.ts
- Routes API potentiellement obsolÃ¨tes

âš ï¸ FAUX POSITIFS FRÃ‰QUENTS:
L'audit signale "utilisÃ© 1-2 fois" mais ce N'EST PAS du code mort si:
- Le state est passÃ© comme PROP Ã  un composant enfant
- Le state est utilisÃ© dans un useEffect/useCallback
- Le state est affichÃ© conditionnellement (ternaire)
- Le state est stockÃ© pour usage futur (cache local)
- La fonction est un CALLBACK passÃ© Ã  un enfant
- La variable est dans un template string ou interpolation

AVANT DE SUPPRIMER, VÃ‰RIFIER:
1. grep -rn "nomVariable" public/static/js/  # Chercher PARTOUT
2. Chercher aussi: setNomVariable (pour les states)
3. Chercher dans les props des composants enfants
4. VÃ©rifier les fichiers .min.js (code peut Ãªtre renommÃ©)
5. Tester la fonctionnalitÃ© en local AVANT de supprimer

WORKFLOW CORRECT:
1. npm run audit                    # Identifier candidats
2. Pour CHAQUE candidat:
   a. grep -rn "candidat" .         # VÃ©rifier tous usages
   b. Comprendre POURQUOI il existe # Chesterton's Fence
   c. Si doute â†’ NE PAS TOUCHER
3. Supprimer UNIQUEMENT si certitude 100%
4. Tester la fonctionnalitÃ© impactÃ©e
5. Commit avec message explicatif

âŒ INTERDIT:
- Supprimer car "utilisÃ© 1 fois" sans vÃ©rifier contexte
- Supprimer du code qu'on ne comprend pas
- Supprimer plusieurs Ã©lÃ©ments d'un coup sans tester
- Faire confiance aveuglÃ©ment Ã  l'audit

âœ… OBLIGATOIRE:
- Comprendre le code avant suppression
- VÃ©rifier toutes les dÃ©pendances (grep global)
- Tester aprÃ¨s chaque suppression
- Documenter pourquoi c'Ã©tait du code mort
```

---

---

## ğŸ END OF KERNEL (v7.0 - ~600 lines)
*Multi-industry: garder systÃ¨me adaptable. Ã‰viter hard-coding de termes mÃ©tier.*
