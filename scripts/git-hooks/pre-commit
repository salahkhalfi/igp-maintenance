#!/bin/bash
# Pre-commit hook - V√©rifie que dist/ est synchronis√©
# Installation: cp scripts/git-hooks/pre-commit .git/hooks/pre-commit

# V√©rifier si des composants ont √©t√© modifi√©s
if git diff --cached --name-only | grep -q "public/static/js/components/"; then
    echo "üîç Composants modifi√©s d√©tect√©s..."
    echo ""
    
    # V√©rifier dist/_worker.js
    if [[ ! -f "dist/_worker.js" ]]; then
        echo "‚ùå ERREUR: dist/_worker.js manquant"
        echo ""
        echo "Ex√©cutez:"
        echo "  npm run build:full"
        echo ""
        exit 1
    fi
    
    # V√©rifier si dist/ est r√©cent (< 5 minutes)
    WORKER_AGE=$(($(date +%s) - $(stat -c %Y dist/_worker.js)))
    
    if [[ $WORKER_AGE -gt 300 ]]; then
        echo "‚ö†Ô∏è  ATTENTION: dist/_worker.js a plus de 5 minutes"
        echo ""
        echo "Vous avez modifi√© des composants mais dist/ n'a pas √©t√© rebuill."
        echo ""
        echo "Ex√©cutez:"
        echo "  npm run build:full"
        echo ""
        echo "Ou pour bypass:"
        echo "  git commit --no-verify"
        echo ""
        exit 1
    fi
    
    echo "‚úÖ dist/ semble √† jour"
fi

exit 0
